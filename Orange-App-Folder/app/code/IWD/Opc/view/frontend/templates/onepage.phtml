<?php
$om = \Magento\Framework\App\ObjectManager::getInstance();
$quote = $om->create('Magento\Checkout\Model\Cart')->getQuote();
$carttotalQuantity = (int)$quote->getItemsQty();
$bposthide = 0;
$iewProduct= 0;
$address = "" ;
$title =  "";
$sessionValue = "";
$shipping = $quote->getShippingAddress();
$productViewblock = $block->getLayout()->createBlock('Orange\Catalog\Block\Product\CustomView');
$customerType = $productViewblock->getCustomerTypeName();
$virtualProducthidden = 0;
$onepageBlock = $block->getLayout()->createBlock('IWD\Opc\Block\Onepage');
$variableModel = $om->get('Magento\Variable\Model\Variable');
$secondSubscription = $variableModel->loadByCode('second_subscription')->getPlainValue();
$storeManager = $om->get('Magento\Store\Model\StoreManagerInterface');
$crossellObj = $block->getLayout()->createBlock('Orange\Crossellorange\Block\Crossellorange');
$productObj = $om->get('Magento\Catalog\Model\Product');
$_cataloghelper = $this->helper('Orange\Catalog\Helper\CatalogUrl');
$scopeConfig = $om->create('Magento\Framework\App\Config\ScopeConfigInterface');
$tealiumStatus = $scopeConfig->getValue('tags/general/enabled', \Magento\Store\Model\ScopeInterface::SCOPE_STORE);
$storeScope = \Magento\Store\Model\ScopeInterface::SCOPE_STORE;
if($customerType == 'SOHO'):
	$discountFullTotalPrice = $scopeConfig->getValue('subsidy/subsidy_configuration/amount_subsidy_soho', $storeScope);
else:
	$discountFullTotalPrice = $scopeConfig->getValue('subsidy/subsidy_configuration/amount_subsidy', $storeScope);
endif;

$postpaidSubSidyConfig = $scopeConfig->getValue('common/subsidy_config/postpaid_subsidy_config', $storeScope);
$specialCharacter = "A-Za-zA-ÿŒŸœĲ'._\s-";
$bpostToggle = $scopeConfig->getValue('carriers/bpost/active', $storeScope);
if(!($bpostToggle))
{
	$bposthide = 1;
}
$checkstepstatfinal = '';
$abandonFinalStep = $om->create('Orange\Abandonexport\Model\Items');
$abandonFinalStepKey = $abandonFinalStep->getCollection()->addFieldToFilter('quote_id',$quote->getId());
if ($abandonFinalStepKey->count() > 0 ) {
	$abandonFinalStepid = $abandonFinalStepKey->getFirstItem()->getId();
	$abandonFinalStepKey = $om->create('Orange\Abandonexport\Model\Items')->load($abandonFinalStepid);
	$checkstepstatfinal = $abandonFinalStepKey->getCheckStepStat();
}
$store   = $storeManager->getStore()->getCode();
$storeID = $storeManager->getStore()->getId();
$spaceColon = ":";
if ($store == "fr"):
$spaceColon = " :";
endif;

/**Quote Items**/
$subsTotal = $quote->getSubscriptionTotal();
$subsidyDiscount = $quote->getSubsidyDiscount();
$quoteitems = $quote->getAllVisibleItems();
$iwequoteitems = $quote->getAllItems();
$attributeSet = $om->create('Magento\Eav\Api\AttributeSetRepositoryInterface');
$postpaidproductAttributeSet = array();
$imageBlock = $block->getLayout()->createBlock('Magento\Catalog\Block\Product\ListProduct');

$totalItemCount = count( $quoteitems );
$paymentBasedContent = array();
$itemIds = array();
$payItems = array();
$listOfItemIds = '';
$designSimNumber = 1;
$designSimNumberValue = 1;
$postpaidproductAttributeSets = array();
$showIew = false;
$otherItems = false;
$iewItems = array();
$hscount = '0';
$handsetCount = '';
$prepaidCount = "";
$scoringNumberScreenPost = '';
$scoringNumberScreenBundle = '';
$onlyPostpaid = true;
$onlyPrepaid = true;
$onlyPrepaidCustnumberVal = 1;
$prePaidbir = 0;
$virtualProductSimple = 1;
foreach ($quoteitems as $item) :
     $attributeSetRepository = $attributeSet->get($item->getProduct()->getAttributeSetId());
     $attrName = $attributeSetRepository->getAttributeSetName();
     $postpaidModel = $om->create('Orange\Checkout\Model\Postpaid');
	 $postpaidModelCollections = $postpaidModel->getCollection()->addFieldToFilter('quote_id',$quote->getId())->addFieldToFilter('item_id',$item->getId());

	// Multiple post paid product
    if ($item->getProduct()->getTypeId() == 'bundle') {
	    $postpaidModel = $om->create('Orange\Checkout\Model\Postpaid');
		$postpaidModelCollections = $postpaidModel->getCollection()
		                                            ->addFieldToFilter('quote_id',$quote->getId())
		                                            ->addFieldToFilter('item_id',$item->getId());
		$childrenItems = $item->getChildren();
		foreach($childrenItems as $childrenItem) {
			$attributeSetRepository = $attributeSet->get($childrenItem->getProduct()->getAttributeSetId());
			$attributeSetName = $attributeSetRepository->getAttributeSetName();
			if(strtolower($attributeSetName) == "handset") {
				$hscount++;
				$handsetCount = $hscount;

			}
			if(strtolower($attributeSetName) == "iew") {
				$showIew = true;
			}
			else if(strtolower($attributeSetName) == "postpaid") {
				$otherItems = true;
			}
					if((strtolower($attributeSetName) == "iew") && $totalItemCount == 1 )
			{
			$iewProduct   =  1;
			}
			if (strtolower($attributeSetName) == "postpaid" || strtolower($attributeSetName) == "iew") {
				$postpaidproductAttributeSet[$item->getId()]['type'] = $attributeSetName;
				$itemProduct = $productObj->load($childrenItem->getProductId());
				$postpaidproductAttributeSet[$item->getId()]['name'] = $itemProduct->getName();
				$totalNumberCount = 0;
				foreach($postpaidModelCollections as $postpaidModelCollection) {
				    $totalNumberCount++;
					$postpaidproductAttributeSets[$item->getId().'_'.$totalNumberCount]['design_sim_number'] = $postpaidModelCollection->getDesignSimNumber();
					$postpaidproductAttributeSets[$item->getId().'_'.$totalNumberCount]['design_te_existing_number'] = $postpaidModelCollection->getDesignTeExistingNumber();
					$postpaidproductAttributeSets[$item->getId().'_'.$totalNumberCount]['design_sim_number'] = $postpaidModelCollection->getDesignSimNumber();
					$postpaidproductAttributeSets[$item->getId().'_'.$totalNumberCount]['design_te_existing_number'] = $postpaidModelCollection->getDesignTeExistingNumber();
					$postpaidproductAttributeSets[$item->getId().'_'.$totalNumberCount]['subscription_type'] = $postpaidModelCollection->getSubscriptionType();
					$postpaidproductAttributeSets[$item->getId().'_'.$totalNumberCount]['current_operator'] = $postpaidModelCollection->getCurrentOperator();
					$postpaidproductAttributeSets[$item->getId().'_'.$totalNumberCount]['network_customer_number'] = $postpaidModelCollection->getNetworkCustomerNumber();
					$postpaidproductAttributeSets[$item->getId().'_'.$totalNumberCount]['simcard_number'] = $postpaidModelCollection->getSimcardNumber();
					$postpaidproductAttributeSets[$item->getId().'_'.$totalNumberCount]['bill_in_name'] = $postpaidModelCollection->getBillInName();
					$postpaidproductAttributeSets[$item->getId().'_'.$totalNumberCount]['holders_name'] = $postpaidModelCollection->getHoldersName();
					$postpaidproductAttributeSets[$item->getId().'_'.$totalNumberCount]['holder_name'] = $postpaidModelCollection->getHolderFirstname();
					$postpaidproductAttributeSets[$item->getId().'_'.$totalNumberCount]['design_te_existing_number_final_validation'] = $postpaidModelCollection->getDesignTeExistingNumberFinalValidation();
				}
				$postpaidproductAttributeSet[$item->getId()]['design_sim_number'] = $item->getDesignSimNumber();
				$postpaidproductAttributeSet[$item->getId()]['design_te_existing_number'] = $item->getDesignTeExistingNumber();
				$postpaidproductAttributeSet[$item->getId()]['subscription_type'] = $item->getSubscriptionType();
				$postpaidproductAttributeSet[$item->getId()]['current_operator'] = $item->getCurrentOperator();
				$postpaidproductAttributeSet[$item->getId()]['network_customer_number'] = $item->getNetworkCustomerNumber();
				$postpaidproductAttributeSet[$item->getId()]['simcard_number'] = $item->getSimcardNumber();
				$postpaidproductAttributeSet[$item->getId()]['bill_in_name'] = $item->getBillInName();
				$postpaidproductAttributeSet[$item->getId()]['holders_name'] = $item->getHoldersName();
				$postpaidproductAttributeSet[$item->getId()]['holder_name'] = $item->getHolderFirstname();
				$postpaidproductAttributeSet[$item->getId()]['design_te_existing_number_final_validation'] = $item->getDesignTeExistingNumberFinalValidation();
				$postpaidproductAttributeSet[$item->getId()]['qty'] = $item->getQty();
				if(strtolower($attributeSetName) == "iew" || $postpaidSubSidyConfig !="1") {
					$postpaidproductAttributeSet[$item->getId()]['bundle'] = 2;
				} else {
					$postpaidproductAttributeSet[$item->getId()]['bundle'] = 1;
				}
				$postpaidproductAttributeSet[$item->getId()]['eagle_type'] = $childrenItem->getEagleType();
				if ($postpaidModelCollections->Count() != $item->getQty()) {
					$designSimNumberValue = '';
				}
				/** IEW PARAMS **/
				$postpaidproductAttributeSet[$item->getId()]['iew_is_teneuro'] = $item->getIewIsTeneuro();
				$postpaidproductAttributeSet[$item->getId()]['iew_telephone'] = $item->getIewTelephone();
				$postpaidproductAttributeSet[$item->getId()]['iew_contract'] = $item->getIewContract();
				$postpaidproductAttributeSet[$item->getId()]['iew_firstname'] = $item->getIewFirstname();
				$postpaidproductAttributeSet[$item->getId()]['iew_lastname'] = $item->getIewLastname();
				$postpaidproductAttributeSet[$item->getId()]['iew_dob'] = $item->getIewDob();
				if(strtolower($attributeSetName) == "iew" && !$iewItems) {
					$showIew = true;
					$iewItems [] = $item->getId();
				}
				else if(strtolower($attributeSetName) == "postpaid") {
					$otherItems = true;
				}
				/** EOF IEW PARAMS **/
				for ($x = 1; $x <= $item->getQty(); $x++) {
					$itemIds[] = $item->getId()."_".$x;
				}
				$payItems[]  = $item->getId();
			}
		}
	} else {

	        $postpaidModel = $om->create('Orange\Checkout\Model\Postpaid');
			$postpaidModelCollections = $postpaidModel->getCollection()
		                                            ->addFieldToFilter('quote_id',$quote->getId())
		                                            ->addFieldToFilter('item_id',$item->getId());
		    $attributeSetRepository = $attributeSet->get($item->getProduct()->getAttributeSetId());
			$attributeSetName = $attributeSetRepository->getAttributeSetName();
			if(strtolower($attributeSetName) == "iew") {
				$showIew = true;
			}
			else if(strtolower($attributeSetName) == "postpaid") {
				$otherItems = true;
			}
			if (strtolower($attributeSetName) == "postpaid" || strtolower($attributeSetName) == "iew") {
				$postpaidproductAttributeSet[$item->getId()]['type'] = $attributeSetName;
				$itemProduct = $productObj->load($item->getProductId());
				$postpaidproductAttributeSet[$item->getId()]['name'] = $itemProduct->getName();

				$totalNumberCount = 0;

				foreach($postpaidModelCollections as $postpaidModelCollection) {
				    $totalNumberCount++;
					$postpaidproductAttributeSets[$item->getId().'_'.$totalNumberCount]['design_sim_number'] = $postpaidModelCollection->getDesignSimNumber();
					$postpaidproductAttributeSets[$item->getId().'_'.$totalNumberCount]['design_te_existing_number'] = $postpaidModelCollection->getDesignTeExistingNumber();
					$postpaidproductAttributeSets[$item->getId().'_'.$totalNumberCount]['design_sim_number'] = $postpaidModelCollection->getDesignSimNumber();
					$postpaidproductAttributeSets[$item->getId().'_'.$totalNumberCount]['design_te_existing_number'] = $postpaidModelCollection->getDesignTeExistingNumber();
					$postpaidproductAttributeSets[$item->getId().'_'.$totalNumberCount]['subscription_type'] = $postpaidModelCollection->getSubscriptionType();
					$postpaidproductAttributeSets[$item->getId().'_'.$totalNumberCount]['current_operator'] = $postpaidModelCollection->getCurrentOperator();
					$postpaidproductAttributeSets[$item->getId().'_'.$totalNumberCount]['network_customer_number'] = $postpaidModelCollection->getNetworkCustomerNumber();
					$postpaidproductAttributeSets[$item->getId().'_'.$totalNumberCount]['simcard_number'] = $postpaidModelCollection->getSimcardNumber();
					$postpaidproductAttributeSets[$item->getId().'_'.$totalNumberCount]['bill_in_name'] = $postpaidModelCollection->getBillInName();
					$postpaidproductAttributeSets[$item->getId().'_'.$totalNumberCount]['holders_name'] = $postpaidModelCollection->getHoldersName();
					$postpaidproductAttributeSets[$item->getId().'_'.$totalNumberCount]['holder_name'] = $postpaidModelCollection->getHolderFirstname();
					$postpaidproductAttributeSets[$item->getId().'_'.$totalNumberCount]['design_te_existing_number_final_validation'] = $postpaidModelCollection->getDesignTeExistingNumberFinalValidation();

				}

				$postpaidproductAttributeSet[$item->getId()]['design_sim_number'] = $item->getDesignSimNumber();
				$postpaidproductAttributeSet[$item->getId()]['design_te_existing_number'] = $item->getDesignTeExistingNumber();
				$postpaidproductAttributeSet[$item->getId()]['subscription_type'] = $item->getSubscriptionType();
				$postpaidproductAttributeSet[$item->getId()]['current_operator'] = $item->getCurrentOperator();
				$postpaidproductAttributeSet[$item->getId()]['network_customer_number'] = $item->getNetworkCustomerNumber();
				$postpaidproductAttributeSet[$item->getId()]['simcard_number'] = $item->getSimcardNumber();
				$postpaidproductAttributeSet[$item->getId()]['bill_in_name'] = $item->getBillInName();
				$postpaidproductAttributeSet[$item->getId()]['holders_name'] = $item->getHoldersName();
				$postpaidproductAttributeSet[$item->getId()]['holder_name'] = $item->getHolderFirstname();
				$postpaidproductAttributeSet[$item->getId()]['design_te_existing_number_final_validation'] = $item->getDesignTeExistingNumberFinalValidation();
				$postpaidproductAttributeSet[$item->getId()]['qty'] = $item->getQty();
				$postpaidproductAttributeSet[$item->getId()]['eagle_type'] = $item->getEagleType();
				$postpaidproductAttributeSet[$item->getId()]['bundle'] = 2;
				if ($postpaidModelCollections->Count() != $item->getQty()) {
					$designSimNumberValue = '';
				}
				/** IEW PARAMS **/
				$postpaidproductAttributeSet[$item->getId()]['iew_is_teneuro'] = $item->getIewIsTeneuro();
				$postpaidproductAttributeSet[$item->getId()]['iew_telephone'] = $item->getIewTelephone();
				$postpaidproductAttributeSet[$item->getId()]['iew_contract'] = $item->getIewContract();
				$postpaidproductAttributeSet[$item->getId()]['iew_firstname'] = $item->getIewFirstname();
				$postpaidproductAttributeSet[$item->getId()]['iew_lastname'] = $item->getIewLastname();
				$postpaidproductAttributeSet[$item->getId()]['iew_dob'] = $item->getIewDob();
				if(strtolower($attributeSetName) == "iew" && !$iewItems) {
					$showIew = true;
					$iewItems [] = $item->getId();
				}
				else if(strtolower($attributeSetName) == "postpaid")  {
					$otherItems = true;
				}
				/** EOF IEW PARAMS **/
				for ($x = 1; $x <= $item->getQty(); $x++) {
					$itemIds[] = $item->getId()."_".$x;
				}
				$payItems[]  = $item->getId();
			}
			if($attributeSetName == 'Prepaid' ){
				$prepaidCount = 1;
			}
	}
	if($item->getProductType() == 'bundle' || $item->getProductType() == 'virtual') {
		$bposthide = 1;
	}
	$paymentBasedContent [] = $item->getProductType();
	$productAttributeSet[] = $item->getProduct()->getAttributeSetId();
	$attributeSetRepository = $attributeSet->get($item->getProduct()->getAttributeSetId());
	$attributeSetName = $attributeSetRepository->getAttributeSetName();
	if(($item->getProduct()->getAttributeSetId() == 11) || ($item->getProduct()->getTypeId() == 'bundle') ||(strtolower($attributeSetName) == 'iew')):
		$numberScreen  =1;
	endif;

	if((strtolower($attributeSetName) == 'postpaid') || (strtolower($attributeSetName) == 'iew')){
		$scoringNumberScreenPost  = 1;
	}
	if(($item->getProduct()->getTypeId() == 'bundle')) {
		$scoringNumberScreenBundle  = 1;
	}
	if($attributeSetName != "Postpaid") {
		$onlyPostpaid = false;
	}
	if($attributeSetName != "Simcard") {
		$onlyPrepaid = false;
		$onlyPrepaidCustnumberVal = 0;
	}
	if($attributeSetName == "Simcard") {
		$prePaidbir = 1;
	}

	if ($item->getProductType() != 'virtual') {
		$virtualProductSimple = 2;
	}
endforeach;
$tempSession = $om->get('Magento\Checkout\Model\Session')->getNewcheckout();
if(isset($tempSession )):
	$previousStep = $tempSession['step'];
else:
	$previousStep = "";
endif;
$scoringType = '';
if($scoringNumberScreenBundle == 1) {
	$scoringType = 1;
} else if($scoringNumberScreenPost == 1) {
	$scoringType = 2;
}
/** Unset nationality and registed from session it is applicable only for postpaid and nintendo **/
if(count($postpaidproductAttributeSet) == 0) {
	unset($tempSession['nationality']);
}
if ($itemIds) {
	$listOfItemIds = implode(',',$itemIds);
}
if (count($paymentBasedContent) > 0) {
    if (in_array("bundle", $paymentBasedContent)) {
        $paymentContent = 1;
    } else if (in_array("virtual", $paymentBasedContent)) {
        $paymentContent = 2;
    } else if (in_array("simple", $paymentBasedContent)) {
        $paymentContent = 0;
    }
}
if(count(array_unique($productAttributeSet)) == 1 && $productAttributeSet[0] == 14 && !$showIew):
	$prepaid_check        = 1;
	$profile_div          = 'disable_div';
else:
	$profile_div   = '';
	$prepaid_check = 0;
	$virtualsimpleprepaidthidden = 0;
endif;

if($prepaid_check != 1 && isset($tempSession['cust_telephone']) && $tempSession['cust_telephone']=="9999999999") {
	$tempSession['cust_telephone'] = '';
	$checkstepstatfinal = '';
}


if(isset($tempSession ) && $checkstepstatfinal == 'final' ) {
 	$sessionValue = "final";
}
else
{
  	$sessionValue = "step2";
}
if(!$designSimNumberValue) {
 	$previousStep = "";
	$sessionValue = "";
}


if($prePaidbir == 1)
{
//$prepaid_check        = 1;
}
/**Hide Screen based on Caddy***/
if(isset($numberScreen) && ($numberScreen == 1)):
	$Step1Number        =  1;
	$Step2Number        =  2;
	$Step3Number        =  3;
	$Step1NumberClass   = "";
	$StepidentificationClass= "";
	$nationalitydiv = "";
	if(isset($previousStep) && $previousStep == 'step2'){
		$step1DivClass = "disable_div";
		$step2DivClass = "";
		$step3DivClass = "disable_div";
		$step1TabClass = "first done";
		$step2TabClass = "active";
		$step3TabClass = "last";
		$stepvalue     = 'step3';

	}
	else if(isset($previousStep) && $previousStep == 'step3'){
		$step1DivClass = "disable_div";
		$step2DivClass = "";
		$step3DivClass = "disable_div";
		$step1TabClass = "first done";
		$step2TabClass = "active";
		$step3TabClass = "last";
		$stepvalue     = 'step3';

	}
	else{
		$step1DivClass = "";
		$step2DivClass = "disable_div";
		$step2DivClass = "disable_div";
		$step1TabClass = "first active";
		$step2TabClass = "";
		$step3TabClass = "last";
		$stepvalue = 'step2';

	}
else:
	$step1DivClass      = "disable_div";
	$Step1Number        =  0;
	$Step2Number        =  1;
	$Step3Number        =  2;
	$Step1NumberClass        = "disable_div";
	$StepidentificationClass = "disable_div";
	$nationalitydiv = "disable_div";
	if(isset($prepaid_check) && ($prepaid_check == 1)){
		$dobdiv  = "";
	}
	else{
		$dobdiv  = "disable_div";
	}
	if(isset($previousStep) && ($previousStep == 'step3') ){
		$step2DivClass  = "";
		$step3DivClass = "disable_div";
		$step1TabClass = "first done";
		$step2TabClass = "first active";
		$step3TabClass = "last";
		$stepvalue = 'step3';

	}
	else{
		$step2DivClass  = "";
		$step3DivClass = "disable_div";
		$step1TabClass = "first done";
		$step2TabClass = "first active";
		$step3TabClass = "last";
		$stepvalue = 'step3';

	}
endif;

?>

<?php if (in_array("bundle", $paymentBasedContent)) { ?>
<input type='hidden' id='bundle-error' value=1 />
<?php } else { ?>
<input type='hidden' id='bundle-error' value=0 />
<?php } ?>
<?php
	$accountId = $onepageBlock->getBpostAccountId();
	$passphrase = $onepageBlock->getBpostPassphrase();
	$orderReference = rand(1000,9999);
	$requestInterface = $om->get('Magento\Framework\App\RequestInterface');
	$currentUrl = $om->get('Magento\Framework\UrlInterface')->getCurrentUrl();
	$res = $requestInterface->getParams();

	$lang = $storeManager->getStore()->getCode();
	$orderTotalPrice = $quote->getGrandTotal()*100;
	if(isset($res['customerPostalLocation']) && $res['customerPostalLocation']!=""){
		$om->create('Magento\Checkout\Model\Session')->setCustomerPostalLocation($res['customerPostalLocation']);
	}
	if(isset($res['customerPhoneNumber']) && $res['customerPhoneNumber']!=""){
		$om->create('Magento\Checkout\Model\Session')->setCustomerPhoneNumber($res['customerPhoneNumber']);
	}
	if(isset($res['customerRcCode']) && $res['customerRcCode']!=""){
		$om->create('Magento\Checkout\Model\Session')->setCustomerRcCode($res['customerRcCode']);
	}
	if(isset($res['customerStreet']) && $res['customerStreet']!=""){
		$om->create('Magento\Checkout\Model\Session')->setCustomerStreet($res['customerStreet']);
	}
	if(isset($res['customerStreetNumber']) && $res['customerStreetNumber']!=""){
		$om->create('Magento\Checkout\Model\Session')->setCustomerStreetNumber($res['customerStreetNumber']);
	}
	if(isset($res['customerPostalCode']) && $res['customerPostalCode']!=""){
		$om->create('Magento\Checkout\Model\Session')->setCustomerPostalCode($res['customerPostalCode']);
	}
	if(isset($res['customerCity']) && $res['customerCity']!=""){
		$om->create('Magento\Checkout\Model\Session')->setCustomerCity($res['customerCity']);
	}
	if(isset($res['pugoKeepMeInformedViaNotificationType']) && $res['pugoKeepMeInformedViaNotificationType']!=""){
		$om->create('Magento\Checkout\Model\Session')->setNotificationType($res['pugoKeepMeInformedViaNotificationType']);
	}

	$customerPostalLocation=$om->get('Magento\Checkout\Model\Session')->getCustomerPostalLocation();

	if($bposthide > 0){
           $customerPostalLocation = '';
    }

	$customerStreet=$om->get('Magento\Checkout\Model\Session')->getCustomerStreet();
	$customerPhoneNumber=$om->get('Magento\Checkout\Model\Session')->getCustomerPhoneNumber();
	$customerRcCode=$om->get('Magento\Checkout\Model\Session')->getCustomerRcCode();
	$customerStreetNumber=$om->get('Magento\Checkout\Model\Session')->getCustomerStreetNumber();
	$customerPostalCode=$om->get('Magento\Checkout\Model\Session')->getCustomerPostalCode();
	$customerCity= $om->get('Magento\Checkout\Model\Session')->getCustomerCity();
	if(isset($res['pugoKeepMeInformedViaNotificationType']) && $res['pugoKeepMeInformedViaNotificationType']!=""){
	$pugoKeepMeInformedViaNotificationType= $om->get('Magento\Checkout\Model\Session')->getNotificationType();
	}
	else
	{
	$pugoKeepMeInformedViaNotificationType= "";
	}
?>
	<input type="hidden" id="lang" name="lang" value="<?php echo $lang; ?>"/>
	<input type="hidden" id="accountId" name="accountId" value="<?php echo $accountId; ?>"/>
	<input type="hidden" id="returnUrl" name="returnUrl" value="<?php echo $currentUrl; ?>"/>
	<input type="hidden" id="orderReference" name="orderReference" value="<?php echo $orderReference; ?>"/>
	<input type="hidden" id="orderTotalPrice" name="orderTotalPrice" value="<?php echo $orderTotalPrice; ?>"/>
	<input type="hidden" name="customerCountry" value="BE"/>
	<input type="hidden" id="thridsteppaymentshow" name="thridsteppaymentshow" value="2"/>
	<input type="hidden" id="thridsteppaymentshowtimingId" name="thridsteppaymentshowtimingId" value="1"/>
	<input type="hidden" id="prepaidshippingMethodId" name="prepaidshippingMethodId" value="1"/>
	<input type="hidden" id="sessionShippingmethodend" name="sessionShippingmethodend" value="1"/>

<?php
	$hash = hash("sha256", "accountId=".$accountId."&customerCountry=BE&orderReference=".$orderReference."&".$passphrase);
	$hasShippingInfo = false;
	$hideFreedelivery = 1;
	foreach($quote->getAllItems() as $quoteItem):
		/* Shipping Info display logic */
			$product = $quoteItem->getProduct();
			$attributeSetRepository = $attributeSet->get($product->getAttributeSetId());
			$attributeSetName = $attributeSetRepository->getAttributeSetName();
			//Dont show shipping info for Prepaid,Postpaid,IEW and Simcard
			if($quoteItem->getProductType() == 'simple' && $attributeSetName!='Simcard') {
				$hasShippingInfo = true;
			}
			/* EOF shipping info logic */
	endforeach;
	foreach($quote->getAllVisibleItems() as $quoteItem):
		if ($quoteItem->getProductType() == 'simple') {
			$hideFreedelivery = 2;
		}
	endforeach;
?>

<form enctype="multipart/form-data" autocomplete="on" action="/" method="post" id="checkout_form" >
<input type="hidden" id="i_ind_copm_hidden" name="i_ind_copm_hidden" value="<?php if(isset($tempSession['i_ind_copm_hidden'])) { echo $tempSession['i_ind_copm_hidden']; }?>">
<input type="hidden" id="hidefreedelivery" value="<?php echo $hideFreedelivery; ?>">
<input type="hidden" id="grandtotalfinalval" value="<?php echo $quote->getGrandTotal(); ?>">
<input type="hidden" id="checksum" name="checksum" value="<?php echo $hash;?>"/>
<input type="hidden" id="customerPostalLocation" name="customerPostalLocation" value="<?php if(isset($customerPostalLocation)){echo $customerPostalLocation;} ?>" />
<input type="hidden" id="customerStreet" name="customerStreet" value="<?php if(isset($customerStreet)){echo $customerStreet;} ?>" />
<input type="hidden" id="customerStreetNumber" name="customerStreetNumber" value="<?php if(isset($customerStreetNumber)){
	echo $customerStreetNumber;} ?>" />
<input type="hidden" id="customerPhoneNumber" name="customerPhoneNumber" value="<?php if(isset($customerPhoneNumber)){
	echo $customerPhoneNumber;} ?>" />
<input type="hidden" id="customerRcCode" name="customerRcCode" value="<?php if(isset($customerRcCode)){
	echo $customerRcCode;} ?>" />
	<input type="hidden" id="pugoKeepMeInformedViaNotificationType" name="pugoKeepMeInformedViaNotificationType" value="<?php if(isset($pugoKeepMeInformedViaNotificationType)){
	echo $pugoKeepMeInformedViaNotificationType;} ?>" />
<input type="hidden" id="customerPostalCode" name="customerPostalCode" value="<?php if(isset($customerPostalCode)){echo $customerPostalCode;} ?>" />
<input type="hidden" id="customerCity" name="customerCity" value="<?php if(isset($customerCity)){echo $customerCity;} ?>" />
<input type="hidden" id="deliveryMethod" name="deliveryMethod" value="" />
<input type="hidden" id="road65url" name="road65url" value="<?php echo $this->getUrl('road/roadsixtyfive/roadsixtyfive'); ?>" />
<?php /* payment_button_value is a button value used on payment details page,
submit button value. */ ?>
<input type="hidden" id="payment_button_value" value="<?php echo __('Commander') ?>">
<input type="hidden" id="isdeliveryMethod" name="isdeliveryMethod" value="" />
<input type="hidden" id="customerLastName" name="customerLastName" value="" />
<input type="hidden" id="customerFirstName" name="customerFirstName" value="" />
<input type="hidden" id="customerEmail" name="customerEmail" value="" />
<input type="hidden" id="cu_ex_invoice_cust_number_hidden" name="cu_ex_invoice_cust_number_hidden" value="<?php if(isset($tempSession['cu_ex_invoice_cust_number_hidden'])) { echo $tempSession['cu_ex_invoice_cust_number_hidden']; }?>" />
<?php
if($res && $res['customerPostalCode'] && $res['customerPostalLocation'] && $res['customerStreet'] && $res['customerStreetNumber'] && $res['customerCity']):

if($lang=="fr"):?>
<?php $address = "Vous avez choisi" ;
$title = "Modifier le point de collecte";?>
<?php else:?>
<?php $address = "Je koos voor";
$title = "Afhaalpunt wijzigen";?>
<?php endif;?>
<?php
	$address .= ":<br>".$res['customerPostalLocation'].", ".$res['customerStreet']." ".$res['customerStreetNumber'].", ".$res['customerPostalCode']." ".$res['customerCity']."<br>";
	$address .= "<a id ='bpost-change-button' onclick ='openchangepopup()' class='orange cursor'>$title</a>";
?>

	<script type="text/javascript">
		parent.document.getElementById("bpost-address").innerHTML="<?php echo $address; ?>";
		parent.document.getElementById("bpost-address").classList.remove("disable_div");
		parent.document.getElementById("bpost-button").style.display = 'none';
		parent.document.getElementById("c_delivery_address_bpost-error").style.display = 'none';
		parent.document.getElementById("customerPostalLocation").value='<?php echo $res['customerPostalLocation']; ?>';
		parent.document.getElementById("customerStreet").value='<?php echo $res['customerStreet']; ?>';
		parent.document.getElementById("customerStreetNumber").value='<?php echo $res['customerStreetNumber']; ?>';
		parent.document.getElementById("customerPostalCode").value='<?php echo $res['customerPostalCode']; ?>';
		parent.document.getElementById("customerRcCode").value='<?php echo $res['customerRcCode']; ?>';
		<?php if(isset($res['pugoKeepMeInformedViaNotificationType']) && $res['pugoKeepMeInformedViaNotificationType']!=""){ ?>
		parent.document.getElementById("pugoKeepMeInformedViaNotificationType").value='<?php echo $res['pugoKeepMeInformedViaNotificationType']; ?>';
		<?php } ?>
		parent.document.getElementById("customerPhoneNumber").value='<?php echo $res['customerPhoneNumber']; ?>';
		parent.document.getElementById("customerCity").value='<?php echo $res['customerCity']; ?>';
		parent.document.getElementById("deliveryMethod").value='<?php echo $res['deliveryMethod']; ?>';
		parent.document.getElementById("isdeliveryMethod").value='<?php if ($res['deliveryMethod']) { echo "1";} else {echo "0";} ?>';
		parent.document.getElementById("customerFirstName").value='<?php echo $res['customerFirstName']; ?>';
		parent.document.getElementById("customerLastName").value='<?php echo $res['customerLastName']; ?>';
		parent.document.getElementById("customerEmail").value='<?php echo $res['customerEmail']; ?>';
		SHM.close();
	</script>

<?php else: ?>
	<script type="text/javascript">
		SHM.close();
	</script>
<?php endif; ?>

<div class="main-container">

	<input type="hidden" name="step" id="step" value="<?php if(isset($stepvalue)) { echo $stepvalue; }?>">
	<input type="hidden" name="pre_onepage" id="pre_onepage" value="<?php if(isset($tempSession['pre_onepage'])) { echo $tempSession['pre_onepage']; }?>">
	<input type="hidden" name="pre_onepage_trigger" id="pre_onepage_trigger" value="<?php if(isset($tempSession['pre_onepage_trigger'])) { echo $tempSession['pre_onepage_trigger']; }?>">
	<!-- updated account number and bank type from Quote insead of session for P3 – 39196493 – information not retained when hitting Back on Ogone page -->
	<input type="hidden" name="v_bank_transfer_type" id="v_bank_transfer_type" value="<?php if($quote->getBankTransferType()) { echo $quote->getBankTransferType(); }?>">
    <input type="hidden" name="v_account_number" id="v_account_number" value="<?php if($quote->getAccountNumber()) { echo $quote->getAccountNumber(); }?>">
	<input type="hidden" name="session_step" id="session_step" value="<?php if(isset($sessionValue)) { echo $sessionValue; }?>">
	<input type="hidden" name="scoringResponse" id="scoringResponse" value="<?php if(isset($tempSession['scoringResponse'])) { echo $tempSession['scoringResponse']; }?>">
	<input type="hidden" name="iewbundle" id="iewbundle" value="<?php if(isset($iewProduct)) { echo $iewProduct; }?>">
	<?php
	$sessionURL = $_cataloghelper->getFormattedUrl($this->getUrl('checkout/index/session'));
	$updateSessionURL = $_cataloghelper->getFormattedUrl($this->getUrl('checkout/index/updatesession'));
	?>
	<input type="hidden" name="prepaidbir" id="prepaidbir" value="<?php echo $prePaidbir ;?>">
	<input type="hidden" name="session_url" id="session_url" value="<?php echo $sessionURL ;?>">
    <input type="hidden" name="chk_step_stat" id="chk_step_stat" value="<?php  echo $checkstepstatfinal; ?>">
  <input type="hidden" name="tealium_status" id="tealium_status" value="<?php echo $tealiumStatus?>">
	<input type="hidden" name="update_session_url" id="update_session_url" value="<?php echo $updateSessionURL ;?>">
	<input type="hidden" name="number_url" id="number_url" value="	<?php echo $this->getUrl('numbervalidation/index/index') ;?>">
	<input type="hidden" name="customernumber_url" id="customernumber_url" value=" <?php echo $this->getUrl('numbervalidation/index/Customernumber') ;?>">
	<input type="hidden" name="coupon_subscription_url" id="coupon_subscription_url" value="<?php echo $this->getUrl('checkout/cart/CouponSubscription') ;?>">
	<input type="hidden" name="number_screen" id="number_screen" value="<?php if(isset($numberScreen)) { echo $numberScreen; }?>">
	<input type="hidden" name="scoring_type" id="scoring_type" value="<?php if(isset($scoringType)) { echo $scoringType; }?>">
	<input type="hidden" name="scoring_redirect" id="scoring_redirect" value="<?php echo $_cataloghelper->getFormattedUrl($this->getUrl('checkout/index/OrderRefusePage'));?>">
	<input type="hidden" name="scoring_handset_count" id="scoring_handset_count" value="<?php echo $handsetCount; ?>">
	<input type="hidden" name="scoring_url" id="scoring_url" value="<?php echo $this->getUrl('road/scoring/scoring'); ?>">
	<input type="hidden" name="simcard_url" id="simcard_url" value="<?php echo $this->getUrl('checkout/index/simcard'); ?>">
	<input type="hidden" name="vatnumber_url" id="vatnumber_url" value="<?php echo $this->getUrl('checkout/index/vatnumber'); ?>">
	<input type="hidden" name="quoteexpire_url" id="quoteexpire_url" value="<?php echo $this->getUrl('checkout/index/quoteexpire'); ?>">
	<input type="hidden" name="cart_url" id="cart_url" value="<?php echo $_cataloghelper->getFormattedUrl($this->getUrl('checkout/cart')); ?>">
	<input type="hidden" name="prepaid_check" id="prepaid_check" value="<?php if(isset($prepaid_check)) { echo $prepaid_check; }?>">
	<input type="hidden" name="only_prepaid_custnumber_val" id="only_prepaid_custnumber_val" value="<?php echo $onlyPrepaidCustnumberVal;?>">
	<input type="hidden" name="subs_result" id="subs_result" value="">
	<input type="hidden" name="customer_type" id= "customer_type" value="<?php if(isset($customerType)) { echo $customerType; }?>">
	<input type="hidden" name="tealium_current_operator" id="tealium_current_operator" value="">
	<input type="hidden" name="virtualProductSimple" id="virtualProductSimple" value="<?php echo $virtualProductSimple;?>">
	<?php $formattedCartURL = $_cataloghelper->getFormattedUrl($this->getUrl('checkout/cart', ['_secure' => true]));?>
    <input type="hidden" name="formatCartUrl" id="formatCartUrl" value="<?php echo $formattedCartURL;?>">
	<div class="container">
		<div class="row">
			<div class="col-xs-12 col-sm-8">
				<h1><?php echo __('Votre commande') ?></h1>
			</div>
			<div class="col-xs-12 col-sm-4 padding-xs-t-n padding-sm-t-m">
				<?php $formattedCartURL = $_cataloghelper->getFormattedUrl($this->getUrl('checkout/cart', ['_secure' => true]));?>
				<a href="javascript:void(0)" style="display:none;" class="newpayment-cart orange pull-right mobile-realign margin-xs-t-n margin-sm-t-l cart_bttn"><i class="oi oi-caddy"></i><?php echo __('Modifier mon panier') ?> </a>
<a href="javascript:void(0)" class="removepayment-cart orange pull-right mobile-realign margin-xs-t-n margin-sm-t-l cart_bttn"><i class="oi oi-caddy"></i><?php echo __('Voir mon panier') ?> </a>

			</div>
			<div class="col-xs-12">
				<div class="row item-list">

				<?php if($tempSession['pre_onepage'] == 1 && $prepaid_check  == 1):
				?>

					<div class="<?php if($Step1NumberClass == 'disable_div'): ?>col-xs-12<?php else: ?>col-xs-4<?php endif; ?> padding-xs-h-n item-step">
						<div class="first active" id="step3_tab"><span class="hidden-xs"> <?php echo __('Paiement') ?></span></div>
					</div>
          <?php else: ?>
         		   <div id="number_tab" class="col-xs-4 padding-xs-h-n item-step <?php echo $Step1NumberClass; ?>">
						<div class="<?php if(isset($step1TabClass)) {  echo $step1TabClass; } ?>" id="step1_tab"><?php if(isset($Step1Number)) {  echo $Step1Number; } ?>.<span class="hidden-xs"> <?php echo __('Numero') ?></span></div>
					</div>
					<div class="<?php if($Step1NumberClass == 'disable_div'): ?>col-xs-6<?php else: ?>col-xs-4<?php endif; ?> padding-xs-h-n item-step">
						<div class="<?php if(isset($step2TabClass)) { echo $step2TabClass; } ?>" id="step2_tab"><?php if(isset($Step2Number)) {  echo $Step2Number; } ?>.<span class="hidden-xs"> <?php echo __('Informations') ?></span></div>
					</div>
					<div class="<?php if($Step1NumberClass == 'disable_div'): ?>col-xs-6<?php else: ?>col-xs-4<?php endif; ?> padding-xs-h-n item-step">
						<div class="<?php if(isset($step3TabClass)) { echo $step3TabClass; } ?>" id="step3_tab"><?php if(isset($Step3Number)) {  echo $Step3Number; } ?>.<span class="hidden-xs"> <?php echo __('Paiement') ?></span></div>
					</div>
          <?php endif; ?>
				</div>
			</div>

		</div>
        <div class="step-mage-error" style="display:none"><span><i class="glyphicon glyphicon-info-sign"></i> <?php echo __('Please correct below invalid fields') ?></span></div>
		<?php
		if(isset($tempSession ))
		{
			//////////////////////Step1 Calculation///////////////////////////////
			if(isset($tempSession['bill_in_name']) && $tempSession['bill_in_name'] ==1 )
			{
				$bill_in_name_yes =  "checked";
			}
			else if(isset($tempSession['bill_in_name']) && $tempSession['bill_in_name'] ==1 )
			{
				$bill_in_name_no =  "checked";
			}
			else
			{
				$bill_in_name_yes =  "checked";
			}
			if(isset($tempSession['current_operator']) && $tempSession['current_operator'] == 1)
			{
				$current_operator_yes =  "checked";
			}
			else  if(isset($tempSession['current_operator']) && $tempSession['current_operator'] ==2 )
			{
				$current_operator_no =  "checked";
			}
			else
			{
				$current_operator_yes =  "checked";
			}
			if(isset($tempSession['design_sim_number']) && $tempSession['design_sim_number'] == 1)
			{
				$design_sim_number_ex =  "checked";
			}
				else  if(isset($tempSession['design_sim_number']) && $tempSession['design_sim_number'] ==2 )
			{
				$design_sim_number_new =  "checked";
			}
			else
			{
				$design_sim_number_new =  "checked";
			}
		}
		else
		{
			$current_operator_yes =  "checked";
			$bill_in_name_yes =  "checked";
			$design_sim_number_ex =  "checked";
		}
		/* Assign disable_dive if page refreshed */
		if(isset($sessionValue) && $sessionValue == 'final')
		{
		$step1DivClass = 'disable_div';
		}

		?>
		<div id="step1_number" class="<?php if(isset($step1DivClass)) { echo $step1DivClass;  }?>" >
			<div id="step1_exiting_num">
				<input type="hidden" class="subsidybank" name='subsidybank' value="<?php if($subsTotal || $subsidyDiscount ): echo 1; endif; ?>" />
				<input type="hidden" class="paymentBasedContent" name='paymentBasedContent' value="<?php echo $paymentContent; ?>" />

<?php foreach ($quoteitems as $item) : ?>
<?php
if ($item->getProduct()->getTypeId() != 'virtual' && $item->getProduct()->getTypeId() != 'bundle') {
	continue;
}
/** @var $block \Magento\Checkout\Block\Cart\Item\Renderer */
$_item = $item;
$childrenItems = $_item->getChildren();
foreach($childrenItems as $childrenItem):
	if($childrenItem->getProductType() == 'virtual'):
		$quoteSubscriptionAmount = $childrenItem->getOriSubscriptionAmount();
	endif;
endforeach;
$product = $_item->getProduct();
$TypeId = $product->getTypeId();
$isVisibleProduct = $product->isVisibleInSiteVisibility();
/** @var \Magento\Msrp\Helper\Data $helper */
$helper = $this->helper('Magento\Msrp\Helper\Data');
$canApplyMsrp = $helper->isShowBeforeOrderConfirm($product) && $helper->isMinimalPriceLessMsrp($product);
$cartRender= $block->getLayout()->createBlock('Magento\Checkout\Block\Cart\Item\Renderer');
$crosSellCollection = $_item->getProduct()->getCrossSellProductCollection();
if($onlyPostpaid && $item->getProduct()->getTypeId() == 'virtual' && $item->getParentItemId() == "")
{
	$virtualProducthidden=1;
}
?>
<?php endforeach;?>


				<input type="hidden" name="virtualproductonepage" id="virtualproductonepage" value='<?php if(isset($virtualProducthidden)) { echo $virtualProducthidden; }?>' class='virtualproductonepage'>
				<input type="hidden" name="virtualproductonepage_one" id="virtualproductonepage_one" value='1' class='virtualproductonepage_one'>

				<div class="container">

				   <input type="hidden" name='totalvirtualproduct' id="totalvirtualproduct" value='<?php echo $listOfItemIds; ?>'>
				   <?php foreach($postpaidproductAttributeSet as $key=>$value): ?>
					<?php $loopQty = $value['qty']; ?>
					<?php $subsidyPostpaidHide = $value['bundle']; ?>
					<input type="hidden" name="totalqty-<?php echo $key?>" id='totalqty_<?php echo $key; ?>_<?php echo $x;?>' value="<?php echo $loopQty; ?>" >
					<?php $values = array();?>
					<?php for ($x = 1; $x <= $value['qty']; $x++):?>
					<?php $values = array();?>
					<?php if(isset($postpaidproductAttributeSets[$key.'_'.$x]) && $postpaidproductAttributeSets):?>
					<?php $values = $postpaidproductAttributeSets[$key.'_'.$x];?>
					<?php endif;?>
					<div class="row">
						<div class="col-xs-12">
							<h3 class="margin-xs-b-m"><?php echo __('Configurez votre numéro pour ') ?><?php echo __($value['name']);?> <?php if($value['qty'] > 1):?>(<?php echo $x?>)<?php endif;?></h3>
						</div>
					</div>
					<div class="row">
						<div class="col-xs-12 col-sm-8" id="">
							<div class="form-item form-item-gender form-type-radio radio">
								<label for="designsimfirst_<?php echo $key ?>_<?php echo $x;?>" class="<?php if($subsidyPostpaidHide==1):?>subsidy-label-padding<?php endif;?>"><input type="radio" data-itemid="<?php echo $key?>_<?php echo $x;?>" class="form-radio design_sim_number <?php if($subsidyPostpaidHide==1):?>disable_div<?php endif;?> <?php if($value['type']=='IEW'): ?>iew_sim<?php endif;?>" id="designsimfirst_<?php echo $key ?>_<?php echo $x;?>" name="design_sim_number-<?php echo $key?>_<?php echo $x;?>"  class="form-radio" value="1" <?php if(!isset($tempSession['design_sim_number-'.$key.'_'.$x])|| $tempSession['design_sim_number-'.$key.'_'.$x] == 1 || (!$tempSession['design_sim_number-'.$key.'_'.$x] && $value['type']!='IEW')) { echo "checked"; }?>  ><?php if($subsidyPostpaidHide==1):?><?php echo __('Veuillez introduire le numéro que vous souhaitez garder') ?><?php else:?><?php echo __('Récupérer un numéro existant') ?><?php endif;?></label>
							</div>
							<?php if($value['type']!='IEW'): ?>
								<input class="form-control validation_check design_te_existing_number session-form"  type="tel" id="designteexistingnumber_<?php echo $key ?>_<?php echo $x;?>" name="design_te_existing_number-<?php echo $key?>_<?php echo $x;?>" autocomplete="design_te_existing_number" value="<?php if(isset($tempSession['design_te_existing_number-'.$key.'_'.$x])) {  echo $tempSession['design_te_existing_number-'.$key.'_'.$x]; }?>" size="60"  placeholder="<?php echo __('Numéro de GSM');?>" data-validate="{'custom-required':true,'validate-orangenumber-step1':true,'validate-orangenumber-total':true,'restriction-postpaid-number':true}">
								<input  type="hidden" id="design_te_existing_number_final_validation_<?php echo $key?>_<?php echo $x;?>" name="design_te_existing_number_final_validation-<?php echo $key?>_<?php echo $x;?>"  value="<?php if(isset($tempSession['design_te_existing_number_final_validation-'.$key.'_'.$x])) {  echo $tempSession['design_te_existing_number_final_validation-'.$key.'_'.$x]; } else {echo "0"; }?>">
								<input type="hidden" id="existing_number_<?php echo $key?>_<?php echo $x;?>" value="<?php if(isset($tempSession['design_te_existing_number-'.$key.'_'.$x])) {  echo $tempSession['design_te_existing_number-'.$key.'_'.$x]; }?>">
							<?php else:?>
								<input  type="hidden" id="design_te_existing_number_final_validation_<?php echo $key?>_<?php echo $x;?>" name="design_te_existing_number_final_validation-<?php echo $key?>_<?php echo $x;?>"  value="<?php if(isset($tempSession['design_te_existing_number_final_validation-'.$key.'_'.$x])) {  echo $tempSession['design_te_existing_number_final_validation-'.$key.'_'.$x]; } else {echo "0"; }?>">
							<?php endif; ?>
							<div class="form-item form-item-gender form-type-radio radio margin-xs-t-m <?php if($subsidyPostpaidHide==1):?>disable_div<?php endif;?>">
								<label for="designsimsecond_<?php echo $key ?>_<?php echo $x;?>"><input type="radio" id="designsimsecond_<?php echo $key ?>_<?php echo $x;?>" name="design_sim_number-<?php echo $key?>_<?php echo $x;?>"   class="form-radio design_sim_number <?php if($value['type']=='IEW'): ?>iew_sim_new<?php endif;?>" value="2" <?php if((!isset($tempSession['design_sim_number-'.$key.'_'.$x]) && $value['type']=='IEW') || isset($tempSession['design_sim_number-'.$key.'_'.$x]) && $tempSession['design_sim_number-'.$key.'_'.$x] == 2) { echo "checked"; }?> ><?php echo __('Obtenir un nouveau numéro') ?></label>
							</div>
						</div>
					</div>
					<?php endfor; ?>
					<?php endforeach; ?>
						<div class="row">
					    <div class="col-xs-12 col-sm-8" id="">
						    <div class="margin-xs-t-m margin-xs-b-m disable_div" id="step1_continue_div">
								<a class="btn btn-primary " href="javascript:void(0);" id="step_1" ><?php echo __('Continuer') ?></a>
								<span class="or-separator" id="span_ext_number" ><?php echo __('ou') ?></span>
								<a class="btn btn-default margin-xs-t-n" href="<?php echo __($secondSubscription); ?>" id="a_ext_number"><?php echo __('Ajouter un abonnement') ?></a>
							</div>
							<div class="margin-xs-t-m margin-xs-b-m" id="step1_continue_div_exiting">
										<a class="btn btn-primary" href="javascript:void(0);" id="step_1_exisitng" ><?php echo __('Continuer') ?></a>
									</div>
									<div class="margin-xs-t-m" id="existing_number_postpaid_div" style="display:none">
										<p id="customer-zone-des"><?php echo __("Pour changer votre abonnement Orange, rendez-vous dans votre Espace client.") ?></p>
											<?php
												//getting current store id
												$storeCode = $storeManager->getStore()->getName();
												$url = $onepageBlock->getCustomerZoneURL();
											?>
										<a class="btn btn-primary" id="customer-zone-button" href="<?php echo $url;?>" target="_blank"><?php echo __('Espace client') ?></a>
										<p id='continue-delete-button-top' style="display:none">
                                                                                    <?php
                                                                                        echo __("Pour changer votre abonnement Orange, vous devez vous rendre dans votre Espace client.Finalisez d'abord votre commande sans ce produit, puis rendez-vous dans votre Espace client pour changer de plan tarifaire.")
                                                                                    ?>
                                                                                </p>
										<a class="btn btn-primary" id='continue-delete-button' style="display:none" href="javascript:void(0)" ><?php echo __('Continuer votre commande') ?></a>

							</div>
						</div>
					</div>
				</div>

			</div>
			<div class="disable_div" id="transfer_number">
				<div class="container"  >
				     <?php
						$model = $variableModel->loadByCode('subscription_type');
						$plain_value = $model->getPlainValue();
						$subscription_variable = explode(',',$plain_value);
					?>
				    <?php foreach($postpaidproductAttributeSet as $key=>$value): ?>
					<?php $loopQty = $value['qty']; ?>
					<?php for ($x = 1; $x <= $value['qty']; $x++):?>
					<?php $values = array();?>
					<?php if(isset($postpaidproductAttributeSets[$key.'_'.$x]) && $postpaidproductAttributeSets):?>
					<?php $values = $postpaidproductAttributeSets[$key.'_'.$x];?>
					<?php endif; ?>
					<div class="row" id='transfernumber_<?php echo $key; ?>_<?php echo $x;?>' style='display:none;'>
						<div class="col-xs-12">
							<h3 class="margin-xs-b-m"><?php echo __('Transfert de votre numéro :') ?> <span id="display_div_number_<?php echo $key?>_<?php echo $x;?>"></span></h3>
							<p class="pull-left margin-xs-t-s margin-xs-r-m" title="<?php echo __('Ce champ est obligatoire.') ?>"><?php echo __('Quel est votre opérateur actuel ? *') ?></p>
							<div class="row col-sm-6">
								<select class="dropdown-menu-form validation_check_dropdown simcard_type_custom_value" name="subscription_type-<?php echo $key?>_<?php echo $x;?>" id="subscription_type_<?php echo $key?>_<?php echo $x;?>" data-validate="{'validate-select-newrule':true}" >
								<option value=""><?php echo __('Sélectionnez').'&nbsp'; ?></option>
								<?php foreach($subscription_variable as $subs_variable):?>
									<option value="<?php echo $subs_variable; ?>" <?php if(isset($tempSession['subscription_type-'.$key.'_'.$x]) && $tempSession['subscription_type-'.$key.'_'.$x] == $subs_variable) { echo 'selected'; }?>><?php echo __($subs_variable); ?></option>
								<?php endforeach;?>
								</select>
							</div>
						</div>
						<div class="col-xs-12 margin-xs-t-m">
							<div class="row">
								<div class="col-xs-12">
									<p class="pull-left margin-xs-r-m" title="<?php echo __('Ce champ est obligatoire.') ?>"><?php echo __('Quel est votre type de carte ? *') ?></p>
									<div class="form-item form-item-gender form-type-radio radio pull-left">
							<label for="currentfirst_<?php echo $key?>_<?php echo $x;?>"><input type="radio" id="currentfirst_<?php echo $key?>_<?php echo $x;?>" name="current_operator-<?php echo $key?>_<?php echo $x;?>" value="1" class="form-radio current_operator" <?php if(isset($tempSession['current_operator-'.$key.'_'.$x]) && $tempSession['current_operator-'.$key.'_'.$x] == 1 || !isset($tempSession['current_operator-'.$key.'_'.$x]) ) { echo 'checked'; }?>  ><?php echo __("Abonnement") ?></label>
									</div>
									<div class="form-item form-item-gender form-type-radio radio pull-left">
							<label for="current_<?php echo $key?>_<?php echo $x;?>"><input type="radio" id="current_<?php echo $key?>_<?php echo $x;?>" name="current_operator-<?php echo $key?>_<?php echo $x;?>" value="2" class="form-radio current_operator" <?php if(isset($tempSession['current_operator-'.$key.'_'.$x]) && $tempSession['current_operator-'.$key.'_'.$x] == 2) { echo 'checked'; }?> ><?php echo __('Carte prépayée') ?></label>
									</div>
								</div>
							</div>
							<div class="row margin-xs-t-m">
								<div class="col-xs-12 col-sm-6 cuoperator <?php if(isset($tempSession['current_operator-'.$key.'_'.$x]) && $tempSession['current_operator-'.$key.'_'.$x] != 1) { echo 'disable_div'; }?>" id="div_network_customer_number_<?php echo $key?>_<?php echo $x;?>">
									<label for="edit-client"><?php echo __('N° de client actuel *') ?>  <a type="button" data-toggle="tooltip" data-placement="right" title="" data-original-title="<?php echo __("Vous trouverez votre numéro de client sur l'une de vos factures.")?>" class="orange">?</a></label>
									<input class="form-control validation_check sim_custom_number"  autocomplete="network_customer_number" type="search" id="network_customer_number_<?php echo $key?>_<?php echo $x;?>" name="network_customer_number-<?php echo $key?>_<?php echo $x;?>" value="<?php if(isset($tempSession['network_customer_number-'.$key.'_'.$x])) { echo $tempSession['network_customer_number-'.$key.'_'.$x]; }?>" onkeyup="if (/[^a-zA-Z0-9'.-]/g.test(this.value)) this.value = this.value.replace(/[^a-zA-Z0-9'.-]/g,'')" size="60" maxlength="50"  data-validate="{'custom-required':true,'min-lenth-validation-newmessage':true}">
								</div>
								<div class="col-xs-12 col-sm-6 margin-xs-t-s margin-sm-t-n cusimcard">
									<label for="edit-sim"><?php echo __('N° de carte SIM actuel *') ?> <a type="button" data-toggle="tooltip" data-placement="right" title="" data-original-title="<?php echo __("Ce numéro se situe sur votre carte SIM.")?>" class="orange">?</a></label>

									<input class="form-control validation_check simcard_number"  autocomplete="simcard_number" type="search" id="simcard_number_<?php echo $key?>_<?php echo $x;?>" name="simcard_number-<?php echo $key?>_<?php echo $x;?>"  value="<?php if(isset($tempSession['simcard_number-'.$key.'_'.$x])) { echo $tempSession['simcard_number-'.$key.'_'.$x]; }?>" size="60" maxlength="20" data-validate="{'custom-required':true, 'simcard-number':true}" data-myAttri="">
									<div for="simcard_number-<?php echo $key?>_<?php echo $x;?>" generated="true" class="mage-error" id="simcard_number-<?php echo $key?>_<?php echo $x;?>-error" style="display: none;"></div>
								</div>
							</div>
							<div class="row margin-xs-t-m <?php if(isset($tempSession['current_operator-'.$key.'_'.$x]) && $tempSession['current_operator-'.$key.'_'.$x] != 1) { echo 'disable_div'; }?>" id="div_bill_in_name_<?php echo $key?>_<?php echo $x;?>">
								<div class="col-xs-12">
									<p title="<?php echo __('Ce champ est obligatoire.') ?>"><?php echo __('La facture est-elle à votre nom ? *') ?></p>
									<div class="form-item form-item-gender form-type-radio radio pull-left">
										<label for="bill_<?php echo $key?>_<?php echo $x;?>"><input type="radio" id="bill_<?php echo $key?>_<?php echo $x;?>" class='form-radio bill_in_name' name="bill_in_name-<?php echo $key?>_<?php echo $x;?>" value="1" <?php if(isset($tempSession['bill_in_name-'.$key.'_'.$x]) && $tempSession['bill_in_name-'.$key.'_'.$x] == 1 || !isset($tempSession['bill_in_name-'.$key.'_'.$x])) { echo 'checked'; }?>  class="form-radio"><?php echo __('Oui') ?> </label>
									</div>
									<div class="form-item form-item-gender form-type-radio radio pull-left">
										<label for="billsecond_<?php echo $key?>_<?php echo $x;?>"><input type="radio" id="billsecond_<?php echo $key?>_<?php echo $x;?>" class='form-radio bill_in_name' name="bill_in_name-<?php echo $key?>_<?php echo $x;?>" value="0" <?php if(isset($tempSession['bill_in_name-'.$key.'_'.$x]) && $tempSession['bill_in_name-'.$key.'_'.$x] == 0) { echo 'checked'; }?>  class="form-radio" ><?php echo __('Non') ?></label>
									</div>
								</div>
							</div>
							<div class="row margin-xs-t-s <?php if(isset($tempSession['current_operator-'.$key.'_'.$x]) && $tempSession['current_operator-'.$key.'_'.$x] != 1) { echo 'disable_div '; }?> <?php if(isset($tempSession['bill_in_name-'.$key.'_'.$x]) && $tempSession['bill_in_name-'.$key.'_'.$x] == 1 || !isset($tempSession['bill_in_name-'.$key.'_'.$x])) { echo 'disable_div'; } ?>" id="div_holders_name_<?php echo $key?>_<?php echo $x;?>" id="div_holders_name_<?php echo $key?>_<?php echo $x;?>">
								<div class="col-xs-12 col-sm-6">
									<label for="edit-first-name" class=""><?php echo __('Nom du titulaire') ?> <span class="form-required" title="<?php echo __('Ce champ est obligatoire.') ?>" >*</span></label>
									<input class="form-control validation_check" autocomplete="holders_name" type="text" id="holders_name_<?php echo $key?>_<?php echo $x;?>" name="holders_name-<?php echo $key?>_<?php echo $x;?>" value="<?php if(isset($tempSession['holders_name-'.$key.'_'.$x])) { echo $tempSession['holders_name-'.$key.'_'.$x]; }?>" size="60" maxlength="35" data-validate="{'custom-required':true, 'validate-novalidation':true, 'min-lenth-validation':true,'validate-slash':true,'holders-name':true}">
								</div>
								<div class="col-xs-12 col-sm-6 margin-xs-t-s margin-sm-t-n">
									<label for="edit-first-name" class=""><?php echo __('Prénom du titulaire') ?> <span class="form-required" title="<?php echo __('Ce champ est obligatoire.') ?>">*</span></label>
									<input class="form-control validation_check disabled" id="holder_name_<?php echo $key?>_<?php echo $x;?>" type="text" name="holder_name-<?php echo $key?>_<?php echo $x;?>" value="<?php if(isset($tempSession['holder_name-'.$key.'_'.$x])) { echo $tempSession['holder_name-'.$key.'_'.$x]; }?>" size="60" maxlength="35" data-validate="{'custom-required':true, 'validate-novalidation':true, 'min-lenth-validation':true,'validate-slash':true,'holders-name':true}">
								</div>
							</div>

						</div>
					</div>
					<?php endfor; ?>
					<?php endforeach; ?>
					<div class="row">
						 <div class="col-xs-12 margin-xs-t-s">

								<div class="margin-xs-t-m margin-xs-b-m">
										<a class="btn btn-primary" href="javascript:void(0);" id="step_1_number" ><?php echo __('Continuer') ?></a>
									<span class="or-separator"><?php echo __('ou') ?></span>
									<!-- Fixes for P3 – 39162709 – Add another subscription linking to Checkout issue -->
									<a class="btn btn-default margin-xs-t-n" href="<?php echo __($secondSubscription); ?>" ><?php echo __('Ajouter un abonnement') ?></a>
								</div>
							</div>
					</div>
				</div>

			</div>
		</div>
		<?php
		if(isset($tempSession))
		{
			/**Nationality Check**/
			if(isset($tempSession['nationality']) && ($tempSession['nationality'] =='belgian') )
			{
				$nationality_bl_checked  =  'checked';
				$residence_div_st        =  'col-xs-12 col-sm-6 col-sm-offset-6 disable_div';
				$q_registerd_div_st      = 'col-xs-12 col-sm-6 margin-xs-t-s disable_div';
				$client_code_div         = 'row margin-xs-t-l';
			}
			else if(isset($tempSession['nationality'])  && ($tempSession['nationality'] =='other'))
			{
				$nationality_other_checked  =  'checked';
				$residence_div_st           =  'col-xs-12 col-sm-6 col-sm-offset-6';
				$q_registerd_div_st         = 'col-xs-12 col-sm-6 margin-xs-t-s ';
				$client_code_div         = 'row margin-xs-t-l disable_div';
			}
			else
			{
				$nationality_bl_checked  =  'checked';
				$nationality_other_checked  =  '';
				$residence_div_st        =  'col-xs-12 col-sm-6 col-sm-offset-6 disable_div';
				$q_registerd_div_st         = 'col-xs-12 col-sm-6 margin-xs-t-s disable_div';
				$client_code_div         = 'row margin-xs-t-l';
			}
			////Exinvoice/////////////////
			if(isset($tempSession['ex_invoice']) && ($tempSession['ex_invoice'] =='yes') )
			{
				$ex_invoice_yes_checked  =  'checked';
			}
			else if(isset($tempSession['ex_invoice'])  && ($tempSession['ex_invoice'] =='no'))
			{
				$ex_invoice_no_checked  =  'checked';
			}
			else
			{
				$ex_invoice_no_checked  =  'checked';
			}
			////Disocunt/////////////////
			if(isset($tempSession['discount_f']) && ($tempSession['discount_f'] =='yes') )
			{
				$discount_f_yes_checked  =  'checked';
			}
			else if(isset($tempSession['discount_f'])  && ($tempSession['discount_f'] =='no'))
			{
				$discount_f_no_checked  =  'checked';
			}
			else
			{
				$discount_f_yes_checked  =  'checked';
			}
			////Gender/////////////////
			if(isset($tempSession['gender']) && ($tempSession['gender'] =='1') )
			{
				$gender_male_checked  =  'checked';
			}
			else if(isset($tempSession['gender'])  && ($tempSession['gender'] =='2'))
			{
				$gender_female_checked  =  'checked';
			}
			else
			{
				$gender_male_checked  =  'checked';
			}
			////terms_condition/////////////////
			if(isset($tempSession['terms_condition']))
			{
				$terms_condition_checked  =  'checked';
			}
			/*Profile Switch Case*/
			if(isset($tempSession['tx_profile_dropdown']) && ($tempSession['tx_profile_dropdown'] == 1))
			{
				$legal_status_div = "row margin-sm-b-s disable_div";
				$company_div      = "row margin-sm-b-s disable_div";
				$vat_number_div   = "row margin-sm-b-s";
			}
			else if(isset($tempSession['tx_profile_dropdown']) && ($tempSession['tx_profile_dropdown'] == 2))
			{
				$legal_status_div = "row margin-sm-b-s disable_div";
				$company_div      = "row margin-sm-b-s disable_div";
				$vat_number_div   = "row margin-sm-b-s disable_div";
			}
			else if(isset($tempSession['tx_profile_dropdown']) && ($tempSession['tx_profile_dropdown'] == 3))
			{
				$legal_status_div = "row margin-sm-b-s ";
				$company_div      = "row margin-sm-b-s ";
				$vat_number_div   = "row margin-sm-b-s ";
			}
			else if(isset($tempSession['tx_profile_dropdown']) && ($tempSession['tx_profile_dropdown'] == 4))
			{
				$legal_status_div = "row margin-sm-b-s disable_div";
				$company_div      = "row margin-sm-b-s disable_div";
				$vat_number_div   = "row margin-sm-b-s";
			}
			else
			{
				$legal_status_div = "row margin-sm-b-s disable_div";
				$company_div      = "row margin-sm-b-s disable_div";
				$vat_number_div   = "row margin-sm-b-s disable_div";
			}
			/*** IEW **/
			if(isset($tempSession['is_teneuro']))
			{
				if($tempSession['is_teneuro'] =='yes') {
					$ten_euro_yes_checked  =  'checked';
				}
				else {
					$ten_euro_no_checked  =  'checked';
				}
			}
			else
			{
				$ten_euro_yes_checked  =  'checked';
			}
			/** EOF IEW **/
		}
		else
		{
			$step3DivClass = "disable_div";
			$legal_status_div = "row margin-sm-b-s disable_div";
			$company_div      = "row margin-sm-b-s disable_div";
			$vat_number_div   = "row margin-sm-b-s disable_div";
			$nationality_bl_checked = "checked";
			$nationality_other_checked  =  '';
			$residence_div_st        =  'col-xs-12 col-sm-6 col-sm-offset-6 disable_div';
			$q_registerd_div_st         = 'col-xs-12 col-sm-6 margin-xs-t-s disable_div';
			$legal_status_div = "row margin-sm-b-s disable_div";
			$company_div      = "row margin-sm-b-s disable_div";
			$vat_number_div   = "row margin-sm-b-s disable_div";
			$ex_invoice_yes_checked  =  '';
			$ex_invoice_no_checked  =  'checked';
			$discount_f_yes_checked  =  '';
			$discount_f_no_checked  =  'checked';
			$terms_condition_checked  =  'checked';
			$client_code_div         = 'row margin-xs-t-l';
			$gender_male_checked  =  'checked';
			$ten_euro_yes_checked  =  'checked'; // IEW
		}

    if(isset($sessionValue) && $sessionValue == 'final')
		{
		$step2DivClass = 'disable_div';
		}

		?>
	<div id="step2_information" class="<?php if(isset($step2DivClass)) {  echo $step2DivClass; } ?>">
		<div class="container">
		<div class="row">
			<div class="col-xs-12 <?php echo $StepidentificationClass; ?>">
				<h3> <?php echo __('Informations') ?></h3>
			</div>
			<div class="col-xs-12">
                            <!-- added tooltip data-delay parameter -->
			<?php if($otherItems): ?>
				<div class="row">
					<div class="col-xs-12 <?php echo $StepidentificationClass; ?>">
						<p class="tooltip_help"><?php echo __("Voulez-vous ajouter cet ou ces abonnement(s) a votre facture") ?><span class="form-required" title="<?php echo __('Ce champ est obligatoire.') ?>">&nbsp;*</span> <a type="button" data-delay='{"show":"0"}' data-toggle="tooltip" data-placement="right" title="" data-original-title="<?php echo __('Vous pouvez choisir de rassembler vos abonnements sur une meme facture deja existante. Les communications entre ces numeros seront gratuites grace a Orange Circle.')?>"  class="orange">?</a></p>
					</div>
					<div class="col-xs-12 margin-xs-t-m <?php echo $StepidentificationClass; ?>">
						<div class="form-item form-item-gender form-type-radio radio pull-left">
							<label for="ex_invoice_yes"><input type="radio" id="ex_invoice_yes" name="ex_invoice" value="yes" class="form-radio" <?php if(isset($ex_invoice_yes_checked)) { echo $ex_invoice_yes_checked; }?> ><?php echo __('Oui') ?></label>
						</div>
						<div class="form-item form-item-gender form-type-radio radio pull-left">
							<label for="ex_invoice_no"><input type="radio" id="ex_invoice_no" name="ex_invoice" value="no" class="form-radio" <?php if(isset($ex_invoice_no_checked)) { echo $ex_invoice_no_checked; }?>><?php echo __('Non') ?></label>
						</div>
					</div>
				</div>
				<div class="row margin-xs-t-m <?php if(isset($ex_invoice_no_checked)) { ?>disable_div <?php } ?>" id="div_ex_invoice_cust_number">
						<div class="col-xs-12 col-sm-6">
						<label for="cu_ex_invoice_cust_number" class=""><?php echo __('Numero de client') ?>
              <span class="form-required" title="<?php echo __('Ce champ est obligatoire.') ?>">*</span> <a type="button" data-toggle="tooltip" data-placement="right" title="" data-original-title="<?php echo __('Vous trouverez votre numéro de client Orange sur la première page de votre facture. Ex : 1.9876543.')?>" class="orange">?</a></label>
					<input type="text" name="dummy-name" style="display:none;">
                                <label for="cu_ex_invoice_cust_number" style="display:none;">shipping country</label>
					<input class="form-control" type="text" autocomplete="cu_ex_invoice_cust_number" id="cu_ex_invoice_cust_number" name="cu_ex_invoice_cust_number" value="<?php if(isset($tempSession['cu_ex_invoice_cust_number'])) { echo $tempSession['cu_ex_invoice_cust_number']; }?>" size="60" onkeyup="if (/[^0-9.]/g.test(this.value)) this.value = this.value.replace(/[^0-9.]/g,'')" data-validate="{'custom-required':true,'min-lenth-validation-newmessage':true}" maxlength="20">
						<div  generated="true" class="mage-error" id="cust_number_validation_error" style="display:none"><?php echo __("Veuillez introduire un numéro de client valide.");?></div>
						</div>
				</div>
              	<div class="row margin-xs-t-m <?php if(isset($ex_invoice_no_checked)) { ?> disable_div <?php } ?>" id="div_ex_invoice_bill_in_name">

					<div class="col-xs-12">
						<p><?php echo __('La facture est-elle à votre nom') ?></p>
						<div class="form-item form-item-gender form-type-radio radio pull-left">
							<label for="cu_ex_invoice_bill_in_name_yes"><input type="radio" id="cu_ex_invoice_bill_in_name_yes" name="cu_ex_invoice_bill_in_name" value="1" <?php if((isset($tempSession['cu_ex_invoice_bill_in_name']) &&  $tempSession['cu_ex_invoice_bill_in_name']==1) || (!isset($tempSession['cu_ex_invoice_bill_in_name']))) { echo "checked"; }?>  class="form-radio"><?php echo __('Oui') ?> </label>
						</div>
						<div class="form-item form-item-gender form-type-radio radio pull-left">
							<label for="cu_ex_invoice_bill_in_name_no"><input type="radio" id="cu_ex_invoice_bill_in_name_no" name="cu_ex_invoice_bill_in_name" value="0" <?php if(isset($tempSession['cu_ex_invoice_bill_in_name']) &&  $tempSession['cu_ex_invoice_bill_in_name']==0 ) { echo "checked"; }?>  class="form-radio" ><?php echo __('Non') ?></label>
						</div>
					</div>
				</div>
				<div class="row margin-xs-t-m <?php if(isset($tempSession['cu_ex_invoice_bill_in_name']) &&  $tempSession['cu_ex_invoice_bill_in_name']==0 ) { }else{ echo "disable_div"; }?>" id="div_ex_invoice_cust_details">
						<div class="col-xs-12 col-sm-6">
						<label for="edit-first-name" class=""><?php echo __('Nom du titulaire') ?> <span class="form-required" title="<?php echo __('Ce champ est obligatoire.') ?>">*</span> </label>
						<input class="form-control validation_check" type="text" autocomplete="cu_ex_invoice_cust_surname" id="cu_ex_invoice_cust_surname" name="cu_ex_invoice_cust_surname" value="<?php if(isset($tempSession['cu_ex_invoice_cust_surname'])) { echo $tempSession['cu_ex_invoice_cust_surname']; }?>" size="60" maxlength="35" data-validate="{'custom-required':true, 'validate-novalidation':true,'min-lenth-validation':true,'validate-slash':true,'cu_ex_invoice_cust_surname':true}">
					</div>
							<div class="col-xs-12 col-sm-6">
						<label for="edit-first-name" class=""><?php echo __('Prénom du titulaire') ?> <span class="form-required" title="<?php echo __('Ce champ est obligatoire.') ?>">*</span> </label>
						<input class="form-control validation_check" type="text" autocomplete="cu_ex_invoice_cust_firstname" id="cu_ex_invoice_cust_firstname" name="cu_ex_invoice_cust_firstname" value="<?php if(isset($tempSession['cu_ex_invoice_cust_firstname'])) { echo $tempSession['cu_ex_invoice_cust_firstname']; }?>" size="60" maxlength="35" data-validate="{'custom-required':true, 'validate-novalidation':true,'min-lenth-validation':true,'validate-slash':true,'cu_ex_invoice_cust_firstname':true}">
					</div>
					<div class="clearfix"></div>
							<div class="col-xs-12 col-sm-6">
						<label for="edit-first-name" class=""><?php echo __('Date de naissance du titulaire') ?> <span class="form-required" title="<?php echo __('Ce champ est obligatoire.') ?>">*</span></label>
						<input class="form-control validation_check" type="text" autocomplete="cu_ex_invoice_cust_dob" id="cu_ex_invoice_cust_dob" name="cu_ex_invoice_cust_dob" value="<?php if(isset($tempSession['cu_ex_invoice_cust_dob'])) { echo $tempSession['cu_ex_invoice_cust_dob']; }?>" size="60" maxlength="35" data-validate="{'custom-required':true,'validate-dob-date':true, 'validate-dob-month':true,'dob-date-validation':true}">
					</div>
				</div>
				<div class="row">
					<div class="col-xs-12 margin-xs-t-m disable_div">
						<p><?php echo __("Si vous etes deja abonne chez Orange, vous beneficiez d'une reduction de 5 €/mois.") ?><br>
						<?php echo __("Avez-vous un abonnement mobile d'au moins 10 €/mois ? *") ?></p>
					</div>
					<div class="col-xs-12 margin-xs-t-m disable_div">
						<div class="form-item form-item-gender form-type-radio radio pull-left">
							<label for="discount_f_yes"><input type="radio" id="discount_f_yes" name="discount_f" value="yes" class="form-radio" <?php if(isset($discount_f_yes_checked)) { echo $discount_f_yes_checked; }?> ><?php echo __('Oui') ?></label>
						</div>
						<div class="form-item form-item-gender form-type-radio radio pull-left">
							<label for="discount_f_no"><input type="radio" id="discount_f_no" name="discount_f" value="no" class="form-radio" <?php if(isset($discount_f_no_checked)) { echo $discount_f_no_checked; }?>><?php echo __('Non') ?></label>
						</div>
					</div>
				</div>
				<div class="row margin-xs-t-m disable_div" id="div_discount_cust_number">
						<div class="col-xs-12 col-sm-6">
						<label for="edit-first-name" class=""><?php echo __('Numero de client') ?> <a type="button" data-toggle="tooltip" data-placement="right" title="" data-original-title="<?php echo __('Vous trouverez votre numéro de client Orange sur la première page de votre facture. Ex : 1.9876543.')?>" data-trigger="click" class="orange">?</a></label>
						<input class="form-control" type="text" id="cu_discount_f_cust_number" name="cu_discount_f_cust_number" value="<?php if(isset($tempSession['cu_discount_f_cust_number'])) { echo $tempSession['cu_discount_f_cust_number']; }?>" size="60" maxlength="35">
					</div>
				</div>
				<div class="row margin-xs-t-m disable_div" id="div_discount_bill_in_name">
					<div class="col-xs-12">
						<p><?php echo __('La facture est-elle à votre nom') ?></p>
						<div class="form-item form-item-gender form-type-radio radio pull-left">
							<label for="cu_discount_f_bill_in_name_yes"><input type="radio" id="cu_discount_f_bill_in_name_yes" name="cu_discount_f_bill_in_name" value="1" <?php if(isset($bill_in_name_yes)) { echo $bill_in_name_yes; }?>  class="form-radio"><?php echo __('Oui') ?> </label>
						</div>
						<div class="form-item form-item-gender form-type-radio radio pull-left">
							<label for="cu_discount_f_bill_in_name_no"><input type="radio" id="cu_discount_f_bill_in_name_no" name="cu_discount_f_bill_in_name" value="0" <?php if(isset($bill_in_name_no)  ) { echo $bill_in_name_no; }?>  class="form-radio" ><?php echo __('Non') ?></label>
						</div>
					</div>
				</div>
				<div class="row margin-xs-t-m disable_div" id="div_discount_cust_details">
					<div class="col-xs-12 col-sm-6">
						<label for="edit-first-name" class=""><?php echo __('Nom du titulaire') ?></label>
						<input class="form-control" autocomplete="cu_discount_f_cust_surname" type="text" id="cu_discount_f_cust_surname" name="cu_discount_f_cust_surname" value="<?php if(isset($tempSession['cu_discount_f_cust_surname'])) { echo $tempSession['cu_discount_f_cust_surname']; }?>" size="60" maxlength="35">
					</div>
					<div class="col-xs-12 col-sm-6">
						<label for="edit-first-name" class=""><?php echo __('Prénom du titulaire') ?></label>
						<input class="form-control" type="text" id="cu_discount_f_cust_firstname" name="cu_discount_f_cust_firstname" value="<?php if(isset($tempSession['cu_discount_f_cust_firstname'])) { echo $tempSession['cu_discount_f_cust_firstname']; }?>" size="60" maxlength="35">
					</div>
					<div class="clearfix"></div>
					<div class="col-xs-12 col-sm-6">
						<label for="edit-first-name" class=""><?php echo __('Date de naissance du titulaire') ?></label>
						<input class="form-control _has-datepicker" type="text" id="cu_discount_f_cust_dob" name="cu_discount_f_cust_dob" value="<?php if(isset($tempSession['cu_discount_f_cust_dob'])) { echo $tempSession['cu_discount_f_cust_dob']; }?>" data-validate="{'validate-dob-date':true, 'validate-dob-month':true,'dob-date-validation':true}" size="60" maxlength="35">
					</div>
				</div>
			<?php endif; ?>
				<!-- IEW -->
				<?php if(count($iewItems) > 0): $iewItemIds = implode(",",$iewItems);?>
					<input type="hidden" value="<?php echo $iewItemIds; ?>" name="iew_items" />
				<?php else: ?>
					<input type="hidden" value="<?php echo ''; ?>" name="iew_items" />
				<?php endif; ?>
				<?php if($showIew): ?>
					<?php foreach($postpaidproductAttributeSet as $itemId=>$itemData): ?>
						<?php
							$hasIewTenEuro = (!isset($tempSession['iew_is_teneuro']) || $tempSession['iew_is_teneuro'] == 'yes' ? 'checked' : '');
							$hasIewTenEuroNo = ($itemData['iew_is_teneuro'] == 'no' || (isset($tempSession['iew_is_teneuro']) && $tempSession['iew_is_teneuro'] == 'no')? 'checked' : '');
							$hasIewTelephone = $itemData['iew_telephone'];
							$hasIewContract = ((isset($tempSession['iew_contract']) && $tempSession['iew_contract'] == '1') ? 'checked' : '');
							$hasIewContractNo = ((isset($tempSession['iew_contract']) && $tempSession['iew_contract'] == '0') ? 'checked' : '');
							$hasIewFname = $itemData['iew_firstname'];
							$hasIewLname = $itemData['iew_lastname'];
							$hasIewDob = $itemData['iew_dob'];
						?>
						<?php if($itemData['type'] == 'IEW' && in_array($itemId, $iewItems)): ?>
							<div class="row">
								<div class="col-xs-12 margin-xs-t-m">

									<p><?php echo __("Si vous etes deja abonne chez Orange, vous beneficiez d'une reduction de 5 €/mois.") ?></p>
								</div>
								<div class="col-xs-12">
									<p><?php echo __("Avez-vous un abonnement mobile d'au moins 10 €/mois ? *") ?></p>
									<div class="form-item form-item-gender form-type-radio radio pull-left">
										<label for="is_teneuro_yes<?php echo $itemId ?>"><input type="radio" data-itemid="<?php echo $itemId ?>" id="is_teneuro_yes<?php echo $itemId ?>" name="is_teneuro_<?php echo $itemId ?>" value="yes" <?php if(isset($tempSession['is_teneuro_'.$itemId]) && $tempSession['is_teneuro_'.$itemId] == 'yes' ) {echo 'checked'; } ?>  class="form-radio is_teneuro"><?php echo __('Oui') ?> </label>
									</div>
									<div class="form-item form-item-gender form-type-radio radio pull-left">
										<label for="is_teneuro_no<?php echo $itemId ?>">
                                                                                <input type="radio" data-itemid="<?php echo $itemId ?>" id="is_teneuro_no<?php echo $itemId ?>" name="is_teneuro_<?php echo $itemId ?>" value="no" <?php if(isset($tempSession['is_teneuro_'.$itemId]) && $tempSession['is_teneuro_'.$itemId] == 'no' || !isset($tempSession['is_teneuro_'.$itemId])) {echo 'checked'; } ?>  class="form-radio is_teneuro" ><?php echo __('Non') ?></label>
									</div>
                                                                        <div class="clearfix"></div>
																		<?php if(isset($tempSession['is_teneuro_'.$itemId]) && $tempSession['is_teneuro_'.$itemId] == 'no' || !isset($tempSession['is_teneuro_'.$itemId])) {$showiewContact = false; }else{$showiewContact = true;} ?>
                                                                        <div class="row col-xs-12 col-sm-6 margin-xs-t-s iew_cont_<?php echo $itemId ?> <?php if(!$showiewContact) { ?>disable_div<?php } ?>" >
                                                                            <label for="iew_telephone_<?php echo $itemId ?>"><?php echo __('Numero de client') ?> <span class="form-required" title="<?php echo __('Ce champ est obligatoire.') ?>">*</span><a type="button" data-toggle="tooltip" data-placement="right" title="" data-original-title="<?php echo __('Vous trouverez votre numéro de client Orange sur la première page de votre facture. Ex : 1.9876543.')?>" class="orange">?</a></label>
                                                                            <input class="form-control validation_check iew_customer_number" type="text" data-itemid="<?php echo $itemId ?>" id="iew_telephone_<?php echo $itemId ?>" name="iew_telephone_<?php echo $itemId ?>" value="<?php if(isset($tempSession['iew_telephone_'.$itemId])) { echo $tempSession['iew_telephone_'.$itemId]; }?>" size="60" maxlength="10" onkeyup="if (/[^0-9.]/g.test(this.value)) this.value = this.value.replace(/[^0-9.]/g,'')" data-validate="{'custom-required':true,'min-lenth-validation-newmessage':true}" autocomplete="off" maxlength="20">
                                                                            <div  generated="true" class="mage-error" id="iew_telephone_<?php echo $itemId ?>_error" style="display:none"><?php echo __("Veuillez introduire un numéro de client valide.");?></div>
                                                                        </div>
                                                                        <input type="hidden" id="iew_telephone_<?php echo $itemId ?>_hidden" class="form-control" name="iew_telephone_<?php echo $itemId ?>_hidden" value="<?php if(isset($tempSession['iew_telephone_'.$itemId.'_hidden'])) { echo $tempSession['iew_telephone_'.$itemId.'_hidden']; }?>" />
								</div>
							</div>
							<div class="row margin-xs-t-m iew_cont_<?php echo $itemId ?> <?php if($showiewContact == false) { ?>disable_div<?php } ?>" id="iew_contract">
								<div class="col-xs-12">
									<p><?php echo __('Are you a contract owner') ?></p>
									<div class="form-item form-item-gender form-type-radio radio pull-left">
										<label for="iew_contract_yes_<?php echo $itemId ?>"><input type="radio" data-itemid="<?php echo $itemId ?>" id="iew_contract_yes_<?php echo $itemId ?>" name="iew_contract_<?php echo $itemId ?>" value="1" <?php if((isset($tempSession['iew_contract_'.$itemId]) && $tempSession['iew_contract_'.$itemId] == '1') || !isset($tempSession['iew_contract_'.$itemId])) {echo 'checked'; }?>  class="form-radio iew_contract"><?php echo __('Oui') ?> </label>
									</div>
									<div class="form-item form-item-gender form-type-radio radio pull-left">
										<label for="iew_contract_no_<?php echo $itemId ?>"><input type="radio" data-itemid="<?php echo $itemId ?>" id="iew_contract_no_<?php echo $itemId ?>" name="iew_contract_<?php echo $itemId ?>" value="0" <?php if(isset($tempSession['iew_contract_'.$itemId]) && $tempSession['iew_contract_'.$itemId] == '0'){echo 'checked'; }?>  class="form-radio iew_contract" ><?php echo __('Non') ?></label>
									</div>
								</div>
							</div>
							<?php if(isset($tempSession['iew_contract_'.$itemId]) && $tempSession['iew_contract_'.$itemId] == '0'){$showiewform = true; }else {$showiewform = false;}?>
							<div class="row margin-xs-t-s iew_cont_<?php echo $itemId ?> iew_contract_form_<?php echo $itemId ?> <?php if(!$showiewform): echo 'disable_div'; endif;?>">
								<div class="col-xs-12 col-sm-6">
									<label for="iew-first-name_<?php echo $itemId ?>"><?php echo __('Prénom du titulaire') ?> <span class="form-required" title="<?php echo __('Ce champ est obligatoire.') ?>">*</span></label>
									<input  class="form-control validation_check iew_first_name" type="text" id="iew_first_name_<?php echo $itemId ?>" name="iew_first_name_<?php echo $itemId ?>" value="<?php if(isset($tempSession['iew_first_name_'.$itemId])) { echo $tempSession['iew_first_name_'.$itemId]; }?>" size="60" maxlength="35" data-validate="{'custom-required':true, 'validate-novalidation':true,'min-lenth-validation':true,'iew_first_name':true}">
								</div>
								<div class="col-xs-12 col-sm-6 margin-xs-t-s margin-sm-t-n">
									<label for="iew-edit-name_<?php echo $itemId ?>"><?php echo __('Nom du titulaire') ?><span class="form-required" title="Ce champ est requis.">*</span></label>
									<input class="form-control validation_check iew_last_name  disabled" id="iew_last_name_<?php echo $itemId ?>" type="text" name="iew_last_name_<?php echo $itemId ?>" value="<?php if(isset($tempSession['iew_last_name_'.$itemId])) { echo $tempSession['iew_last_name_'.$itemId]; }?>" size="60" maxlength="35" data-validate="{'custom-required':true, 'validate-novalidation':true,'min-lenth-validation':true,'iew_last_name':true}">
								</div>
								<div class="clearfix"></div>
								<div class="col-xs-12 col-sm-6 margin-xs-t-s">
									<label for="iew-edit-date_<?php echo $itemId ?>">
									<?php echo __('Date de naissance du titulaire') ?> <span class="form-required" title="<?php echo __('Ce champ est obligatoire.') ?>">*</span>
									<a type="button" data-delay='{"show":"0"}' data-toggle="tooltip" data-placement="right" title="" data-original-title="<?php echo __("Vous devez être majeur pour passer votre commande.")?>" class="orange">?</a></label>
									<input class="form-control validation_check " type="text" autocomplete="off" id="iew_dob_<?php echo $itemId ?>" name="iew_dob_<?php echo $itemId ?>"  value="<?php if(isset($tempSession['iew_dob_'.$itemId])) { echo $tempSession['iew_dob_'.$itemId]; }?>" size="60" maxlength="20" data-validate="{'custom-required':true}">
									<div for="iew_dob" generated="true" class="mage-error" id="iew_dob-error" style="display: none;"></div>
								</div>
								<script type="text/javascript">
									require([
										'jquery',
										'mage/calendar',
										'js/maskedinput'
										], function ($) {
										$("#iew_dob_"+<?php echo $itemId ?>).datepicker({
											maxDate: new Date(),
											yearRange: "-100:+0",
											changeMonth: true,
											changeYear: true
										});
										var MAGE_STORE_ID = '<?php echo $storeManager->getStore()->getCode();?>';
										if (MAGE_STORE_ID == 'nl') {
											$("#iew_dob_"+<?php echo $itemId ?>).mask("00/00/0000", {placeholder: "DD/MM/JJJJ",clearIfNotMatch: true});
										} else {
											$("#iew_dob_"+<?php echo $itemId ?>).mask("00/00/0000", {placeholder: "JJ/MM/AAAA",clearIfNotMatch: true});
										}
										$("#iew_telephone_"+<?php echo $itemId ?>).mask("1.9999999999999999999",{placeholder:"1."});
									});
								</script>
							</div>
						<?php endif; ?>
					<?php endforeach; ?>
				<?php endif; ?>
				<!-- EOF IEW -->
				<?php if($customerType=='SOHO'): ?>
					<?php $proPacks = explode(",",$onepageBlock->getPropacks());?>
						<?php
							$smartPack = '';
							$reductionPack = '';
							$surfPack = '';
							if(isset($tempSession['Smartphone ProPack'])):
								$smartPack = trim($tempSession['Smartphone ProPack'],",");
								$smartPack = trim($smartPack,",");
								$smartPack = explode(",",$smartPack);
								$smartPack = array_unique($smartPack);
								$smartPack = array_filter($smartPack);
								$smartPack = implode(",",$smartPack);
							endif;
							if(isset($tempSession['Reduction ProPack'])):
								$reductionPack = trim($tempSession['Reduction ProPack'],",");
								$reductionPack = trim($reductionPack,",");
								$reductionPack = explode(",",$reductionPack);
								$reductionPack = array_unique($reductionPack);
								$reductionPack = array_filter($reductionPack);
								$reductionPack = implode(",",$reductionPack);
							endif;
							if(isset($tempSession['Surf ProPack'])):
								$surfPack = trim($tempSession['Surf ProPack'],",");
								$surfPack = trim($surfPack,",");
								$surfPack = explode(",",$surfPack);
								$surfPack = array_unique($surfPack);
								$surfPack = array_filter($surfPack);
								$surfPack = implode(",",$surfPack);
							endif;
						?>
						<input type="hidden" name="Smartphone ProPack" class="smartphone_propack" value="<?php if(isset($tempSession['Smartphone ProPack'])) { echo $smartPack; }?>" />
						<input type="hidden" name="Reduction ProPack" class="reduction_propack" value="<?php if(isset($tempSession['Reduction ProPack'])) { echo $reductionPack; }?>"/>
						<input type="hidden" name="Surf ProPack" class="surf_propack" value="<?php if(isset($tempSession['Surf ProPack'])) { echo $surfPack; }?>" />
						<?php $pro = 1; ?>
						<?php foreach ($postpaidproductAttributeSet as $key=>$value):?>
							<?php
								$prdname = $postpaidproductAttributeSet[$key]['name'];
								$prdqty =  $postpaidproductAttributeSet[$key]['qty'];
							?>
							<?php $loopQty = $value['qty']; ?>
							<?php for ($x = 1; $x <= $value['qty']; $x++):?>
								<?php $values = array();?>
									<?php
									 	$eagleType = $postpaidproductAttributeSet[$key]['eagle_type'];
									 ?>
									<?php if(count($proPacks) > 0): ?>
										<div class="row">
											<?php if($eagleType == 'Eagle' || $eagleType == 'Eagle Smartphone'): ?>
												<div class="col-xs-12 margin-xs-t-m">
													<?php if($prdqty > 1) : ?>
													<p><?php echo $prdname.' ('.$x.')'.$spaceColon; ?><?php echo __(' Choisissez votre ProPack inclus dans votre abonnement') ?>	</p>
													<?php else: ?>
													<p><?php echo $prdname.$spaceColon; ?><?php echo __(' Choisissez votre ProPack inclus dans votre abonnement') ?>	</p>
													<?php endif; ?>
												</div>
												<div class="col-xs-12 margin-xs-t-m">
												<?php foreach($proPacks as $proPackId => $proPack):?>
													<div class="form-item form-item-gender form-type-radio radio pull-left">
														<label for="edit_<?php echo $key.'_'.$x?>">
															<input type="radio" id="edit_<?php echo $key.'_'.$x?>" data-itemid="<?php echo $key.'_'.$x?>" data-propack="<?php echo $proPack ?>" name="propack_<?php echo $key.'_'.$x?>[]" value="<?php echo $proPack?>" class="propack_item form-radio eagle_<?php echo $key.'_'.$x?>">
															<?php echo __($proPack) ?>
														</label>
													</div>
													<div class="clearfix"></div>
												<?php endforeach; ?>
												</div>
											<?php elseif($eagleType == 'Eagle premium'): ?>
												<div class="col-xs-12 margin-xs-t-m">
													<?php if($prdqty > 1) : ?>
													<p><?php echo $prdname.' ('.$x.')'.$spaceColon; ?><?php echo __(' Choisissez vos deux ProPack inclus dans votre abonnement') ?>	</p>
													<?php else: ?>
													<p><?php echo $prdname.$spaceColon; ?><?php echo __(' Choisissez vos deux ProPack inclus dans votre abonnement') ?>	</p>
													<?php endif; ?>
												</div>
												<div class="col-xs-12 margin-xs-t-m">
													<?php foreach($proPacks as $proPackId => $proPack):?>
														<label class="" for="edit-submitted-test-checkbox-1">
															<input type="checkbox" data-itemid="<?php echo $key.'_'.$x?>" data-propack="<?php echo $proPack ?>" name="propack_<?php echo $key.'_'.$x ?>[]" value="<?php echo $proPack?>" class="premium_pack propack_item form-checkbox pull-left margin-xs-b-m eagle_<?php echo $key.'_'.$x?>">
															<span class=""><?php echo __($proPack) ?></span>
														</label>
														<div class="clearfix"></div>
													<?php endforeach; ?>
												</div>
											<?php elseif($eagleType == 'Eagle premium Smartphone'): ?>
												<div class="col-xs-12 margin-xs-t-m">
													<?php if($prdqty > 1) : ?>
													<p><?php echo $prdname.' ('.$x.')'.$spaceColon; ?><?php echo __(' Vos ProPacks') ?></p>
													<?php else: ?>
													<p><?php echo $prdname.$spaceColon; ?><?php echo __(' Vos ProPacks') ?></p>
													<?php endif; ?>
												</div>
												<div class="col-xs-12 margin-xs-t-m">
													<p class="tooltip_help"><?php echo __('Vous bénéficiez des trois ProPacks grâce à votre abonnement.') ?></p>
												</div>
												<div class="col-xs-12 margin-xs-t-m">
													<?php foreach($proPacks as $proPackId => $proPack):?>
														<label class="" for="edit-submitted-test-checkbox-1">
															<input type="checkbox" data-itemid="<?php echo $key.'_'.$x?>" data-propack="<?php echo $proPack ?>" checked="checked" name="propack_<?php echo $key.'_'.$x?>[]" value="<?php echo $proPack?>" class="form-checkbox eagle_premium propack_item pull-left margin-xs-b-m eagle_<?php echo $key.'_'.$x?>">
															<span class=""><?php echo __($proPack) ?></span>
														</label>
													<div class="clearfix"></div>
													<?php endforeach; ?>
												</div>
												 <script type="text/javascript">
													require([
														'jquery',
													], function ($) {
														$('.smartphone_propack').val($('.smartphone_propack').val().replace("<?php echo $key.'_'.$x ?>",""));
														$('.reduction_propack').val($('.reduction_propack').val().replace("<?php echo $key.'_'.$x ?>",""));
														$('.surf_propack').val($('.surf_propack').val().replace("<?php echo $key.'_'.$x ?>",""));
														$('.smartphone_propack').val($('.smartphone_propack').val()+"<?php echo ",".$key.'_'.$x ?>");
														$('.reduction_propack').val($('.reduction_propack').val()+"<?php echo ",".$key.'_'.$x ?>");
														$('.surf_propack').val($('.surf_propack').val()+"<?php echo ",".$key.'_'.$x ?>");
													});
												</script>
											<?php endif; ?>
										</div>
										<?php $pro++; ?>
									<?php endif; ?>
							<?php endfor; ?>
							<?php //endif; ?>
						<?php endforeach; ?>
				<?php endif;?>
				<div class="row">
					<div class="col-xs-12">
						<div class="row margin-xs-t-s <?php echo $profile_div ; ?>">
							<div class="col-xs-12">
								  <?php

									$secondData = $onepageBlock->quoteItemsProductSecondStepShowCase();
                                    $prodChecking = $onepageBlock->checkOnlySimpleProducts();
									?>

								<h3 class="margin-xs-b-m"><?php echo __('Données personnelles') ?></h3>
								<label class="" for="edit-submitted-test-checkbox-1"><input type="checkbox" id="i_ind_copm" name="i_ind_copm" value="1" class="form-checkbox pull-left margin-xs-b-m " <?php if(isset($tempSession['i_ind_copm_hidden']) && ($tempSession['i_ind_copm_hidden']=="1" || $tempSession['i_ind_copm_hidden']=="2")) { if(isset($tempSession['i_ind_copm'])) {echo "checked";}} else { if ($customerType == 'SOHO' && $prepaid_check == "" ) { echo "checked"; }} ?>> <span class=""><?php echo __('Indépendant ou société') ?></span></label>
								<div class="clearfix margin-xs-b-s"></div>
								<div for="i_ind_copm_error" generated="true" class="mage-error" id="i_ind_copm-error" style="display:none"><?php echo __("This is a required fields.");?></div>
								<div class="row margin-xs-b-s" id="checkbox_based_dropdown" <?php if(isset($tempSession['i_ind_copm_hidden']) && ($tempSession['i_ind_copm_hidden']=="1" || $tempSession['i_ind_copm_hidden']=="2")) { if(isset($tempSession['i_ind_copm'])) {echo "style=display:block";} else { echo "style=display:none"; } } else { if ($customerType == 'SOHO' && $prepaid_check == "" ) { echo "style=display:block";  } else { echo "style=display:none"; } }  ?>>
									<div class="col-xs-12 col-sm-6 col-md-6">
										<p class="pull-left margin-xs-t-s margin-xs-r-m"><?php echo __('Profil') ?><span id="profile_mandatory"> *</span></p>
										<div class="dropdown drowpdown-full-width margin-sm-b-s">
										<select class="dropdown-menu-form validation_check" name="tx_profile_dropdown" id="tx_profile_dropdown" data-validate="{'custom-required':true}">
										<option value=""  ><?php echo __('Selectionnez') ?></option>
										<option value="3" <?php if(isset($tempSession['tx_profile_dropdown']) && ($tempSession['tx_profile_dropdown'] == 3))
												{
												echo 'selected';
												} ?> ><?php echo __('Entreprise') ?></option>
										<option value="4" <?php if(isset($tempSession['tx_profile_dropdown']) && ($tempSession['tx_profile_dropdown'] == 4))
												{
												echo 'selected';
												} ?> ><?php echo __('Indépendant') ?></option>
										<option value="2" <?php if(isset($tempSession['tx_profile_dropdown']) && ($tempSession['tx_profile_dropdown'] == 2))
												{
												echo 'selected';
												} ?>  ><?php echo __('Profession libérale sans numéro de TVA') ?></option>
										<option value="1" <?php if(isset($tempSession['tx_profile_dropdown']) && ($tempSession['tx_profile_dropdown'] == 1))
												{
												echo 'selected';
												} ?>  ><?php echo __('Profession libérale avec numéro de TVA') ?></option>

				                        </select>
										</div>
									</div>
									<div class="col-xs-12 col-md-6 margintop43" id="checkbox_based_dropdown1">
										<div class="<?php if(isset($legal_status_div)) { echo $legal_status_div ; } ?>" id="legal_status_div">
											<div class="col-xs-12 col-sm-5">
												<p class="pull-left margin-xs-t-s margin-xs-b-s margin-xs-r-m"><?php echo __('Statut juridique') ?> <span class="form-required" title="<?php echo __('Ce champ est obligatoire.') ?>">*</span></p>
											</div>
											<div class="col-xs-12 col-sm-7">
												<div class="dropdown drowpdown-full-width margin-sm-b-s">
													<?php
														$model = $variableModel->loadByCode('legal_status');
														$legal_plain_value = $model->getPlainValue();
														$legal_status_variable = explode(',',$legal_plain_value);
													?>
													<select class="dropdown-menu-form validation_check_dropdown" name="legal_status" id="legal_status" >
														<option value=""  ><?php echo __('Sélectionnez').'&nbsp'; ?></option>
														<?php foreach($legal_status_variable as $legal_variable): ?>
														<option value="<?php echo $legal_variable; ?>" <?php if(isset($tempSession['legal_status']) && $tempSession['legal_status'] == $legal_variable) { echo 'selected'; }?>><?php echo __($legal_variable);?></option>
														<?php endforeach;?>
													</select>
												</div>
											</div>
										</div>
										<div class="<?php if(isset($company_div)) { echo $company_div ; } ?>" id="company_div">
											<div class="col-xs-12 col-sm-5">
												<p class="pull-left margin-xs-t-s margin-xs-b-s margin-xs-r-m"><?php if($store=="fr"):?><?php echo __('Nom de la société') ?><?php else:?><?php echo __('Naam van de onderneming') ?><?php endif;?><span class="form-required" title="<?php echo __('Ce champ est obligatoire.') ?>"> *</span></p>
											</div>
											<div class="col-xs-12 col-sm-7">
												<input class="form-control validation_check  pull-left" type="text" id="company_name" autocomplete="organization" name="company_name" value="<?php if(isset($tempSession['company_name'])) { echo $tempSession['company_name']; }?>" size="60" maxlength="100" data-validate="{'custom-required':true}">
											</div>
										</div>
										<div class="<?php if(isset($vat_number_div)) { echo $vat_number_div ; } ?>" id="vat_number_div" >
											<div class="col-xs-12 col-sm-5">
												<p class="pull-left margin-xs-t-s margin-xs-b-s margin-xs-r-m"> <?php echo __('N° de TVA') ?><span class="form-required" title="<?php echo __('Ce champ est obligatoire.') ?>"> *</span></p>
											<input type="text" name="dummy-vat" style="display:none;" class="hidden">
											</div>

											<p class="hidden" style="display:none;">dummy name</p>
											<div class="col-xs-12 col-sm-7">
												<input class="form-control pull-left" type="text" autocomplete="vat_number" id="vat_number" name="vat_number" value="<?php if(isset($tempSession['vat_number'])) { echo $tempSession['vat_number']; }?>" size="60" maxlength="50" data-validate="{'custom-required':true, 'validate-new-alphanum':true,'vat-number-min-max-lenth-validation':true}">
											    <div  generated="true" class="mage-error" id="vat_number_validation_error" style=""></div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>


						<div class="row">
						<?php if($onlyPrepaid) { ?>
							<h3 class="personal_info_head"><?php echo __('Données personnelles') ?></h3>
							<?php } ?>
							<div class="col-xs-12">
								<div class="margin-xs-t-m">
									<div class="form-item form-item-gender form-type-radio radio pull-left">
										<label for="edit-gender-mr"><input type="radio" id="edit-gender-mr" name="gender" value="1" class="form-radio" <?php if(isset($gender_male_checked)) {  echo $gender_male_checked; } ?> ><?php echo __('Mr.') ?></label>
									</div>
									<div class="form-item form-item-gender form-type-radio radio pull-left">
										<label for="edit-gender-mme"><input type="radio" id="edit-gender-mme" name="gender" value="2" class="form-radio" <?php if(isset($gender_female_checked)) {  echo $gender_female_checked; } ?>><?php echo __('Mme.') ?></label>
									</div>
								</div>
							</div>
						</div>

						<div class="row margin-xs-t-s">
							<div class="col-xs-12 col-sm-6">
								<label for="edit-first-name"><?php echo __('Prénom') ?> <span class="form-required" title="<?php echo __('Ce champ est obligatoire.') ?>">*</span></label>
                                <input type="text" name="dummy-name" id="input" style="display:none;">
								<input class="form-control validation_check"  type="text" id="first_name" autocomplete="given-name" name="first_name"  value="<?php if(isset($tempSession['first_name'])) { echo $tempSession['first_name']; }?>" size="60" maxlength="35" data-validate="{'custom-required':true, 'validate-novalidation':true,'min-lenth-validation':true,'validate-slash':true,'first-name':true}">
							</div>
							<div class="col-xs-12 col-sm-6 margin-xs-t-s margin-sm-t-n">
								<label for="edit-name"><?php echo __('Nom') ?> <span class="form-required"
								title="<?php echo __('Ce champ est obligatoire.') ?>">*</span></label>
								<input class="form-control validation_check disabled"  id="last_name" type="text" autocomplete="family-name" name="last_name" value="<?php if(isset($tempSession['last_name'])) { echo $tempSession['last_name']; }?>" size="60" maxlength="35" data-validate="{'custom-required':true, 'validate-novalidation':true,'min-lenth-validation':true,'validate-slash':true,'last-name':true}" >
							</div>
							<div class="clearfix"></div>
							<div class="col-xs-12 col-sm-6 margin-xs-t-s">
								<label for="edit-mail"><?php echo __('Mail') ?> <span class="form-required"
								title="<?php echo __('Ce champ est obligatoire.') ?>">*</span></label>
								<input class="form-control validation_check" type="text" autocomplete="email" id="email" name="email" value="<?php if(isset($tempSession['email'])) { echo $tempSession['email']; }?>" size="60" maxlength="50" data-validate="{'custom-required':true, 'validate-new-email':true}">
							</div>
							<div class="col-xs-12 col-sm-6 margin-xs-t-s <?php if($onlyPrepaid) { ?>disable_div<?php } ?>">

								<label for="edit-mail"><?php echo __('N de contact') ?> <span class="form-required" title="<?php echo __('Ce champ est obligatoire.') ?>">*</span> <a type="button" data-toggle="tooltip" data-delay='{"show":"0"}' data-placement="right" title="" data-original-title="<?php echo __("Ce numéro peut être utilisé pour vous tenir informé ou pour toute question au sujet de votre commande. Il ne sera pas utilisé à d'autres fins et ne sera pas conservé.")?>" class="orange">?</a></label>
								<input class="form-control validation_check" type="tel" autocomplete="tel" id="cust_telephone" name="cust_telephone" value="<?php if(isset($tempSession['cust_telephone'])) { echo $tempSession['cust_telephone']; }?>" data-mask-clearifnotmatch="true" size="60" data-validate="{'custom-required':true,'validate-orangenumber':true,'validate-contactno':true}" autocomplete="off">

							</div>
							<div class="clearfix"></div>
							<div class="col-xs-12 col-sm-6 margin-xs-t-s <?php if(isset($dobdiv)) { echo $dobdiv; } ?> ">
                        <label for="edit-date">
						<?php echo __('Date de naissance') ?> <span class="form-required" title="<?php echo __('Ce champ est obligatoire.') ?>">*</span>
						<?php if($prePaidbir == 1){ ?>
						<a type="button" data-toggle="tooltip" data-placement="right" title="" data-original-title="<?php echo __("En raison de la nouvelle législation belge sur l'enregistrement des cartes SIM, les données concernant votre date de naissance sont obligatoires.")?>" class="orange">?</a>
						<?php } else { ?>
						<a type="button" data-toggle="tooltip" data-placement="right" title="" data-original-title="<?php echo __("Vous devez être majeur pour passer votre commande.")?>" class="orange">?</a>
						<?php  }?>

						</label>						 
						<input class="form-control validation_check" type="text" id="c_dob" name="c_dob" value="<?php if(isset($tempSession['c_dob'])) { echo $tempSession['c_dob']; }?>" size="60" maxlength="20" <?php if($onlyPostpaid) { ?> data-validate="{'custom-required':true,'validate-dobpostpaid-date':true, 'validate-dobpostpaid-month':true,'dob-date-validation':true, 'validate-nid':true}" <?php  } else if($prePaidbir == 1) { ?> data-validate="{'custom-required':true,'validate-dob-date':true, 'validate-dob-month':true,'dob-prepaid-validation':true, 'validate-nid':true}" <?php }else { ?> data-validate="{'custom-required':true,'validate-dobpostpaid-date':true, 'validate-dobpostpaid-month':true,'dob-date-validation':true, 'validate-nid':true}" <?php } ?> >
			            <div for="c_dob" generated="true" class="mage-error" id="c_dob-error" style="display: none;"></div> 

								<input class="form-control " type="hidden" id="date_day" name="date_day" value="12" size="60" maxlength="2" placeholder="Jour" data-validate="{'custom-required':true, 'validate-number':true}">
								<input class="form-control " type="hidden" id="date_month" name="date_month" value="11" size="60" maxlength="2" placeholder="Mois" data-validate="{'custom-required':true, 'validate-number':true}">
								<input class="form-control " type="hidden" id="date_year" name="date_year" value="2016" size="60" maxlength="4" placeholder="Année" data-validate="{'custom-required':true, 'validate-number':true}">
							</div>
							<?php if($prePaidbir == 1){ ?>
							<div class="col-xs-12 col-sm-6 margin-xs-t-s"  id="div_birth_place">
								<label for="edit-mail"><?php echo __('Lieu de naissance') ?> <span class="form-required" title="<?php echo __('Ce champ est obligatoire.') ?>">*</span><a type="button" data-toggle="tooltip" data-placement="right" title="" data-original-title="<?php echo __("Lieu de naissance")?>" data-trigger="click" class="orange"></a></label>
								<input class="form-control validation_check" type="text" id="cust_birthplace" name="cust_birthplace" value="<?php if(isset($tempSession['cust_birthplace'])) { echo $tempSession['cust_birthplace']; }?>" size="60" maxlength="35"  data-validate="{'custom-required':true, 'validate-namefiled':true,'min-lenth-validation-three':true}">
							</div>
							<?php } else { ?>
								<div class="col-xs-12 col-sm-6 margin-xs-t-s <?php if($prePaidbir != 1) { ?>disable_div<?php } ?>"  id="div_birth_place">
								<label for="edit-mail"><?php echo __('Lieu de naissance') ?> <span class="form-required" title="<?php echo __('Ce champ est obligatoire.') ?>">*</span>
								<a data-original-title="Selecteer je geboorteplaats in de voorgestelde lijst." type="button" data-toggle="tooltip" data-placement="right" title="" class="orange">?</a>
								</label>
								<input class="form-control validation_check" type="text" id="cust_birthplace" name="cust_birthplace" value="<?php if(isset($tempSession['cust_birthplace'])) { echo $tempSession['cust_birthplace']; }?>" size="60" maxlength="35"  data-validate="{'custom-required':true, 'validate-namefiled':true,'min-lenth-validation-three':true}">
							</div>
							<?php } ?>

							<div class="clearfix"></div> 
							<div class="col-xs-12 margin-xs-t-s <?php echo $nationalitydiv; ?>">
								<label for="edit-nationality"><?php echo __("Do you have an identity document issued by the Belgian authorities?") ?>  <span class="form-required" title="<?php echo __('This is a required field.') ?>">*</span> 
								<a type="button" data-delay='{"show":"0"}' data-toggle="tooltip" data-placement="right" title="" data-original-title="<?php echo __("Seuls les documents d'identité électroniques sont acceptés.")?>" class="orange largescreen">?</a>
								<a type="button" data-delay='{"show":"0"}' data-toggle="tooltip" data-placement="top" title="" data-original-title="<?php echo __("Seuls les documents d'identité électroniques sont acceptés.")?>" class="orange smallscreen">?</a>
								</label>
					
								<br>
								<div class="margin-xs-t-s">
									<div class="form-item form-item-gender form-type-radio radio pull-left"> 
										<label for="nationality"><input type="radio" id="nationality" name="nationality" value="belgian" class="form-radio" <?php  if(isset($nationality_bl_checked)) { echo $nationality_bl_checked; } ?>><?php echo __('Oui') ?> </label>
									</div>
									<div class="form-item form-item-gender form-type-radio radio pull-left"> 
										<label for="nationality_other"><input type="radio" id="nationality_other" name="nationality" value="other" class="form-radio" <?php  if(isset($nationality_other_checked)) { echo $nationality_other_checked; } ?>><?php echo __('Non') ?></label>
									</div>
									<div class="clearfix"></div>
								</div>
							</div>
							<div class="clearfix"></div>
							<!-- Start National Id implementation -->
							<div class="col-xs-12 col-sm-6 <?php echo $nationalitydiv; if(isset($tempSession['nationality']) && $tempSession['nationality'] != 'belgian') { echo ' disable_div'; } ?>" id="id_number_div">
								<div class="margin-xs-t-s">

									<label for="label_idnumber_div" id="label_idnumber_div"><?php echo __("N° du document d'identité") ?> <span class="form-required" title="<?php echo __('Ce champ est obligatoire.') ?>">*</span><a style="float:right;" type="button" data-delay='{"show":"0"}' data-toggle="tooltip" data-placement="right" title="" data-original-title="<?php echo __("Seuls les cartes d'identité belges ou les titres de séjour belges sont acceptés.")?>" class="orange visible-lg visible-md visible-sm">&nbsp;?</a><a style="float:right;" type="button" data-toggle="tooltip" data-placement="top" title="" data-original-title="<?php echo __("Seuls les cartes d'identité belges ou les titres de séjour belges sont acceptés.")?>" class="orange visible-xs">&nbsp;?</a></label>
									<input class="form-control validation_check" type="tel" value="<?php if(isset($tempSession['id_number'])) { echo $tempSession['id_number']; }?>" id="id_number" name="id_number" size="60" maxlength="14" data-validate="{'custom-required':true,'id-number':true}">
								 <div for="id_number_new" generated="true" class="mage-error" style="display:none" id="id_number_new_error"><?php echo __("Votre numéro de document d'identité n'est pas reconnu. Veuillez vérifier qu'il soit correct.")?></div>
								<div for="residence_number" generated="true" class="mage-error" id="residence_error" style="display:none" ><?php echo __("Votre numéro de document d'identité n'est pas reconnu. Veuillez vérifier qu'il soit correct.")?></div>
								</div>
							</div>
							<div class="col-xs-12 col-sm-6 <?php echo $nationalitydiv; if(isset($tempSession['nationality']) && $tempSession['nationality'] != 'belgian') { echo ' disable_div'; } ?>" id="national_id_number_div">
								<div class="margin-xs-t-s">
									<label for="national_id_number" id="label_national_idnumber_div"><?php echo __("N° de Registre national") ?> <span class="form-required" title="<?php echo __('Ce champ est obligatoire.') ?>">*</span><a style="float:right;" type="button" data-delay='{"show":"0"}' data-toggle="tooltip" data-placement="right" title="" data-original-title="<?php echo __("Ce numéro est disponible sur votre document d'identité.")?>" class="orange visible-lg visible-md visible-sm">&nbsp;?</a><a style="float:right;" type="button" data-toggle="tooltip" data-placement="top" title="" data-original-title="<?php echo __("Ce numéro est disponible sur votre document d'identité.")?>" class="orange visible-xs">&nbsp;?</a></label>
									<input class="form-control validation_check" type="tel" value="<?php if(isset($tempSession['national_id_number'])) { echo $tempSession['national_id_number']; }?>" id="national_id_number" name="national_id_number" size="60" maxlength="13" data-validate="{'custom-required':true,'dob-required':true,'national-id-number':true}">
								</div>
							</div>
							<div class="col-xs-12 <?php if(isset($tempSession['nationality']) && $tempSession['nationality'] != 'belgian') { } else {echo ' disable_div'; } ?>" id="error_div">
								<div class="margin-xs-t-s mage-error">
								<?php echo $block->getLayout()->createBlock('Magento\Cms\Block\Block')->setBlockId('nid_error_message')->toHtml(); ?>
								</div>
							</div>
							<div class="clearfix"></div>
							<!-- End National Id implementation -->
						<div class="row margin-xs-t-m bundle-hide <?php if(isset($tempSession['nationality']) && $tempSession['nationality'] != 'belgian') { echo 'disable_div'; }?>">
							<div class="col-xs-12">
							<div class="col-xs-12 margin-xs-b-s">
								<h3><?php echo __('Adresse de facturation') ?></h3>
							</div>
							<div class="col-xs-12 col-sm-6 margin_xs_bottom">
                                <label for="b_edit-postcode"><?php echo __('Code postal') ?> <span class="form-required" title="<?php echo __('Ce champ est obligatoire.') ?>">*</span>  <a type="button" data-delay={"show":"0"} data-toggle="tooltip" data-placement="right" title="" data-original-title="<?php echo __("Veuillez sélectionner votre code postal dans la liste proposée.")?>" class="orange">?</a></label>
                                <input class="form-control validation_check" type="text" autocomplete="postal-code" id="b_postcode_city"  name="b_postcode_city" value="<?php if (isset($tempSession['b_postcode_city'])) {
                                        echo $tempSession['b_postcode_city'];
                                    } ?>" size="60" maxlength="4" onkeyup="if (/\D/g.test(this.value)) this.value = this.value.replace(/\D/g,'')" data-validate="{'custom-required':true}"  style="text-transform:uppercase" >
                                <div id="zipcodesList"></div>
                                <span id="b_zip_validation" style="color:#e02b27; font-size: 1.2rem;" ></span>
								<input type="hidden" name="b_zipcode_validation" id="b_zipcode_validation" value="<?php if (isset($tempSession['b_zipcode_validation'])) {echo $tempSession['b_zipcode_validation'];} ?>">
							</div>
                              <div class="col-xs-12 col-sm-6">
                                <label class="" for="b_city"><?php echo __('Ville') ?> <span class="form-required" title="<?php echo __('Ce champ est obligatoire.') ?>">*</span> <a type="button" data-delay={"show":"0"} data-toggle="tooltip" data-placement="right" title="" data-original-title="<?php echo __("Veuillez sélectionner votre city dans la liste proposée.")?>" class="orange">?</a></label>
                                <input class="form-control validation_check" spellcheck="false" type="text"  id="b_city" name="b_city" value="<?php if(isset($tempSession['b_city'])) { echo $tempSession['b_city']; }?>" size="60" maxlength="25" data-validate="{'custom-required':true}"  style="text-transform:uppercase" >
                                  <div id="cityList"></div>
								<span id="b_city_validation"  style="color:#e02b27; font-size: 1.2rem;"></span>
								<input type="hidden" name="b_zipcode_city_validation" id="b_zipcode_city_validation" value="<?php if (isset($tempSession['b_zipcode_city_validation'])) {echo $tempSession['b_zipcode_city_validation'];} ?>">
							</div>
							<div class="clearfix"></div>
							<div class="col-xs-12 col-sm-6 margin-xs-t-s">
								<label for="edit-street"><?php echo __('Rue') ?>  <span class="form-required" title="<?php echo __('Ce champ est obligatoire.') ?>">*</span> <a type="button" data-delay={"show":"0"} data-toggle="tooltip" data-placement="right" title="" data-original-title="<?php echo __("Veuillez sélectionner votre rue dans la liste proposée.")?>" class="orange">?</a></label>
								<input class="form-control validation_check" autocomplete="street-address" spellcheck="false" type="text" id="b_street" name="b_street" value="<?php if(isset($tempSession['b_street'])) { echo $tempSession['b_street']; }?>" size="60" maxlength="100" data-validate="{'custom-required':true}"   style="text-transform:uppercase" >
								 <div id="streetList"></div>
								<span id="street_validation" style="color:#e02b27; font-size: 1.2rem;"></span>
								<input type="hidden" name="b_street_validation" id="b_street_validation" value="<?php if (isset($tempSession['b_street_validation'])) {echo $tempSession['b_street_validation'];} ?>" >
							</div>


							<div class="col-xs-12 col-sm-6 margin-xs-t-s">
								<label for="edit-number"><?php echo __('Numero') ?>  <span class="form-required" title="<?php echo __('Ce champ est obligatoire.') ?>">*</span></label>
								<input class="form-control validation_check" type="text" id="b_number" name="b_number" value="<?php if(isset($tempSession['b_number'])) { echo $tempSession['b_number']; }?>" size="60" maxlength="10" data-validate="{'custom-required':true,'validate-street-valid':true}">
							</div>
							<div class="clearfix"></div>
							<div class="col-xs-12 col-sm-6 margin-xs-t-s">
								<label for="edit-box"><?php echo __('Boite') ?> </label>
								<input class="form-control" type="text" id="b_box" name="b_box" value="<?php if(isset($tempSession['b_box'])) { echo $tempSession['b_box']; }?>" size="60" onkeyup="if (/[^a-zA-Z0-9]/g.test(this.value)) this.value = this.value.replace(/[^a-zA-Z0-9]/g,'')" maxlength="10">
							</div>
							<div class="col-xs-12 col-sm-6 margin-xs-t-s">
								<label for="edit-country"><?php echo __('Pays : Belgique') ?> </label>
							</div>
							</div>
						</div>
<?php
/*Hide Delivery Address For Virtual Product in Caddy*/

      if($hasShippingInfo):
?>
						<div class="col-xs-12 margin-xs-t-m bundle-hide <?php if(isset($tempSession['nationality']) && $tempSession['nationality'] != 'belgian') { echo 'disable_div'; }?>">
							<div class="">
								<h3><?php echo __('Adresse de livraison') ?></h3>

								<div class="margin-xs-t-m">
									<div class="form-item form-item-gender form-type-radio radio pull-left">
										<label for="c_delivery_address_1">
										<input type="radio" id="c_delivery_address_1" name="c_delivery_address"  value="1" checked class="form-radio"><?php echo __("Utiliser la même adresse que l'adresse de facturation") ?></label>
									</div>
									<div class="clearfix"></div>
									<div class="form-item form-item-gender form-type-radio radio pull-left">
									<label for="c_delivery_address_2">
										<input type="radio" id="c_delivery_address_2" name="c_delivery_address" <?php if (isset($tempSession['c_delivery_address']) && $tempSession['c_delivery_address'] == 2): echo "checked"; endif;  ?> value="2" class="form-radio"><?php echo __('Utiliser une autre adresse pour la livraison') ?></label>
									</div>
									<div class="clearfix"></div>
									<div class="row margin-xs-b-m padding-xs-l-n <?php if (isset($tempSession['c_delivery_address']) && $tempSession['c_delivery_address'] == 2): echo ""; else: echo "disable_div";  endif;  ?>" id="div_shipping_address">
										<div class="col-xs-12 col-sm-6 margin-xs-t-s margin-sm-t-n">
											<label for="edit-first-name"><?php echo __('Prenom') ?> <span class="form-required" title="<?php echo __('Ce champ est obligatoire.') ?>">*</span></label>
											<input class="form-control validation_check" autocomplete="given-name" type="text" id="s_firstname" name="s_firstname" value="<?php if(isset($tempSession['s_firstname'])) { echo $tempSession['s_firstname']; }?>" size="60" maxlength="35" data-validate="{'custom-required':true, 'validate-namefiled':true,'validate-novalidation':true,'validate-slash':true,'min-lenth-validation':true,'s_firstname':true}"  >
										</div>
										<div class="col-xs-12 col-sm-6 margin-xs-t-s margin-sm-t-n">
											<label for="edit-name"><?php echo __('Nom') ?> <span class="form-required" title="<?php echo __('Ce champ est obligatoire.') ?>">*</span></label>
											<input class="form-control validation_check" type="text" autocomplete="family-name" id="s_name" name="s_name" value="<?php if(isset($tempSession['s_name'])) { echo $tempSession['s_name']; }?>" size="60" maxlength="35" data-validate="{'custom-required':true, 'validate-namefiled':true,'validate-novalidation':true,'validate-slash':true,'min-lenth-validation':true,'s_name':true}" >
										</div>
										<div class="clearfix"></div>
										<div class="col-xs-12 col-sm-6 margin-xs-t-s margin-sm-t-n margin_xs_bottom">
											<label for="edit-attention-to"><?php echo __('A l’attention de') ?></label>
											<input class="form-control disabled" id="s_attention_n" type="text" name="s_attention_n" value="<?php if(isset($tempSession['s_attention_n'])) { echo $tempSession['s_attention_n']; }?>" size="60" maxlength="35" data-validate="{'validate-namefiled':true,'validate-novalidation':true}">
										</div>
										<div class="clearfix"></div>
										<div class="col-xs-12 col-sm-6 margin_xs_bottom">
                                            <label for="s_edit-postcode"><?php echo __('Code postal') ?> <span class="form-required" title="<?php echo __('Ce champ est obligatoire.') ?>">*</span>  <a type="button" data-toggle="tooltip" data-placement="right" title="" data-original-title="<?php echo __("Veuillez sélectionner votre code postal dans la liste proposée.")?>" class="orange">?</a></label>
                                            <input class="form-control validation_check" type="text" id="s_postcode_city" name="s_postcode_city"  style="text-transform:uppercase"  value="<?php if (isset($tempSession['s_postcode_city'])) {
                                        echo $tempSession['s_postcode_city'];
                                    } ?>" size="60" maxlength="4" onkeyup="if (/\D/g.test(this.value)) this.value = this.value.replace(/\D/g,'')" data-validate="{'custom-required':true}">
											<span id="s_zip_validation" style="color:#e02b27; font-size: 1.2rem;" ></span>
											<input type="hidden" name="s_zipcode_validation" id="s_zipcode_validation" value="<?php if (isset($tempSession['s_zipcode_validation'])) {echo $tempSession['s_zipcode_validation'];} ?>" >
										</div>
                                      <div class="col-xs-12 col-sm-6">
                                            <label class="" for="s_city"><?php echo __('Ville') ?> <span class="form-required" title="<?php echo __('Ce champ est obligatoire.') ?>">*</span> <a type="button" data-toggle="tooltip" data-placement="right" title="" data-original-title="<?php echo __("Veuillez sélectionner votre ville dans la liste proposée.")?>"  class="orange">?</a></label>
                                            <input class="form-control validation_check" spellcheck="false" type="text" id="s_edit_city" name="s_city"  style="text-transform:uppercase"  value="<?php if(isset($tempSession['s_city'])) { echo $tempSession['s_city']; }?>" size="60" maxlength="25" data-validate="{'custom-required':true}">
                                              <span id="s_city_validation"  style="color:#e02b27; font-size: 1.2rem;"></span>
											<input type="hidden" name="s_zipcode_city_validation" id="s_zipcode_city_validation" value="<?php if (isset($tempSession['s_zipcode_city_validation'])) {echo $tempSession['s_zipcode_city_validation'];} ?>" >
                                        </div>
										<div class="clearfix"></div>
										<div class="col-xs-12 col-sm-6 margin-xs-t-s">
											<label for="edit-street"><?php echo __('Rue') ?> <span class="form-required" title="<?php echo __('Ce champ est obligatoire.') ?>">*</span> <a type="button" data-toggle="tooltip" data-placement="right" title="" data-original-title="<?php echo __("Veuillez sélectionner votre rue dans la liste proposée.")?>"  class="orange">?</a></label>
											<input class="form-control validation_check" type="text"  autocomplete="street-address" id="s_street" name="s_street" spellcheck="false" value="<?php if(isset($tempSession['s_street'])) { echo $tempSession['s_street']; }?>"  style="text-transform:uppercase"  size="60" maxlength="50"  data-validate="{'custom-required':true}">
												<span id="street_validation_s" style="color:#e02b27; font-size: 1.2rem;"></span>
												<input type="hidden" name="s_street_validation" id="s_street_validation" value="<?php if (isset($tempSession['s_street_validation'])) {echo $tempSession['s_street_validation'];} ?>" >
										</div>

										<div class="col-xs-12 col-sm-6 margin-xs-t-s">
											<label for="edit-number"><?php echo __('Numero') ?> <span class="form-required" title="<?php echo __('Ce champ est obligatoire.') ?>">*</span></label>
                                                                                        <input class="form-control validation_check" type="text" id="s_number"  name="s_number" value="<?php if(isset($tempSession['s_number'])) { echo $tempSession['s_number']; }?>" size="60" maxlength="10" data-validate="{'custom-required':true,'validate-street-valid':true}" >
										</div>
										<div class="clearfix"></div>
										<div class="col-xs-12 col-sm-6 margin-xs-t-s">
											<label for="edit-box"><?php echo __('Boite') ?> </label>
											<input class="form-control" type="text" id="s_box" name="s_box" value="<?php if(isset($tempSession['s_box'])) { echo $tempSession['s_box']; }?>" size="60" maxlength="10" onkeyup="if (/[^a-zA-Z0-9]/g.test(this.value)) this.value = this.value.replace(/[^a-zA-Z0-9]/g,'')">
										</div>
										<div class="col-xs-12 col-sm-6 margin-xs-t-s">
											<label for="edit-country"><?php echo __('Pays : Belgique') ?></label>
										</div>
									</div>
									<?php if($bposthide == 0){ ?>
									<div class="row col-xs-12 col-sm-6 form-item form-item-gender form-type-radio radio pull-left">
										<label for="c_delivery_address_3" class="bpost_lable">
										<input type="radio" id="c_delivery_address_3" name="c_delivery_address" <?php if (isset($tempSession['c_delivery_address']) && $tempSession['c_delivery_address'] == 3): echo "checked"; endif;  ?> value="3" class="form-radio"><span class="pull-left"><?php echo __('Utiliser un point de collecte bpost') ?></span>
										<a type="button" data-toggle="tooltip" data-placement="right" title="" data-original-title="<?php echo __("Retirez votre paquet vous-même dans un point d'enlèvement bpost (endéans les 15 jours) ou dans un distributeur de paquets bpost (endéans les 5 jours).") ?>" class="orange visible-lg visible-md visible-sm bposta_desktop"> ?</a>
										<a type="button" data-toggle="tooltip" data-placement="left" title="" data-original-title="<?php echo __("Retirez votre paquet vous-même dans un point d'enlèvement bpost (endéans les 15 jours) ou dans un distributeur de paquets bpost (endéans les 5 jours).") ?>" class="orange visible-xs bposta_mobile"> ?</a>
										</label>
										<div for="c_delivery_address_bpost" generated="true" class="mage-error <?php if($tempSession['customerPostalLocation'] ==''):echo ""; else: echo "disable_div"; endif;?>" id="c_delivery_address_bpost-error" style="display: none;"><?php echo __("Veuillez choisir un point de collecte pour votre livraison.") ?></div>
									</div>

									<div class="clearfix"></div>
									<div id="bpost" class="row margin-xs-b-m padding-xs-l-n padding-sm-l-m if <?php if(isset($tempSession['c_delivery_address']) && $tempSession['c_delivery_address'] == 3): echo ""; else: echo "disable_div"; endif; ?>">
										<div class="col-xs-12 col-sm-6">
											<a id="bpost-button" class="btn btn-default margin-xs-t-n <?php if($tempSession['customerPostalLocation'] == ''):echo ""; else: echo "disable_div"; endif;?>" onclick="openchangepopup()" ><?php echo __('Choisir un point de collecte'); ?></a>
											<p id="bpost-address" class="<?php if($tempSession['customerPostalLocation'] !=''):echo ""; else: echo "disable_div"; endif;?> margin-xs-t-s">
											</p>
										</div>
									</div>
									<?php } else{ $tempSession['customerPostalLocation'] == '';   } ?>
								</div>
							</div>
						</div>
<?php
     endif;

?>				
				<div class="main-container shippingaddressbottom bundle-hide <?php if(isset($tempSession['nationality']) && $tempSession['nationality'] != 'belgian') { echo 'disable_div'; }?>">

 <div class="container">
	 <div class="row disable_div">
		<div class="col-xs-12">
			<div id="code_div">
				<div class="col-xs-12 col-sm-6">
					<label for="edit-code-client"><?php echo __('N° de client *') ?><a type="button" data-toggle="tooltip" data-placement="right" title="<?php echo __("Vous trouverez votre numéro de client Orange sur la première page de votre facture. Ex : 1.9876543.") ?>" data-trigger="click" class="orange">?</a></label>
					<input class="form-control" type="text" id="client_code" autocomplete="client_code" name="client_code" value="" size="60" maxlength="50">
				</div>
				<div class="col-xs-12 col-sm-6 margin-xs-t-s margin-sm-t-n">
					<label for="edit-name-client"><?php echo __('Nom du client *') ?></label>
					<input class="form-control disabled" id="client_name" type="text" name="client_name" value="" size="60" maxlength="35">
				</div>
			</div>
		</div>
	 </div>
	<div class="">
		<div class="col-xs-12 col-sm-10">
			<h3><?php echo __('Prochaines étapes') ?></h3>
			<?php

			/*code starts here*/
			$allAttrName = array();
			foreach ($quoteitems as $item) {
			$attributeSetRepository = $attributeSet->get($item->getProduct()->getAttributeSetId());
			$attrName = $attributeSetRepository->getAttributeSetName();
			if($attrName == "Postpaid") {
				$allAttrName[] = "Postpaid";
			} else if($attrName == "Simcard") {
				$allAttrName[] = "Simcard";
			} else if($attrName == "IEW") {
				$allAttrName[] = "IEW";
			} else if($attrName == "handset") {
				$allAttrName[] = "handset";
			} else if($attrName == "Accessories") {
				$allAttrName[] = "Accessories";
			} else if($attrName == "Default") {
				if($item->getProductType() == 'bundle') {
					$ChildrenItems = $item->getChildren();
					if($ChildrenItems) {
						foreach($ChildrenItems as $childItem) {
							$productChild = $attributeSet->get($childItem->getProduct()->getAttributeSetId());
							$attributeSetChild = $productChild->getAttributeSetName();
							if($attributeSetChild == 'IEW') {
								$allAttrName[] = "IEW Subsidy";
							} else if($attributeSetChild == 'Postpaid') {
								$allAttrName[] = "Postpaid Subsidy";
							}
						}
					}
				}
			}
			}
			$allUniqueAttrName = array_unique($allAttrName);
			foreach ($allUniqueAttrName as $uniqueAttrName) {
				if($uniqueAttrName == "Postpaid") {
					echo $block->getLayout()->createBlock('Magento\Cms\Block\Block')->setBlockId('checkout_step_postpaid')->toHtml()."<br>";
				} else if($uniqueAttrName == "Simcard") {
					echo $block->getLayout()->createBlock('Magento\Cms\Block\Block')->setBlockId('checkout_step_simcard')->toHtml()."<br>";
				} else if($uniqueAttrName == "IEW") {
					echo $block->getLayout()->createBlock('Magento\Cms\Block\Block')->setBlockId('checkout_step_iew')->toHtml()."<br>";
				} else if($uniqueAttrName == "handset") {
					echo $block->getLayout()->createBlock('Magento\Cms\Block\Block')->setBlockId('checkout_step_handset')->toHtml()."<br>";
				} else if($uniqueAttrName == "Accessories") {
					echo $block->getLayout()->createBlock('Magento\Cms\Block\Block')->setBlockId('checkout_step_accessory')->toHtml()."<br>";
				} else if($uniqueAttrName == "IEW Subsidy") {
					echo $block->getLayout()->createBlock('Magento\Cms\Block\Block')->setBlockId('checkout_step_iew_subsidy')->toHtml()."<br>";
				} else if($uniqueAttrName == "Postpaid Subsidy") {
					echo $block->getLayout()->createBlock('Magento\Cms\Block\Block')->setBlockId('checkout_step_postpaid_subsidy')->toHtml()."<br>";
				}
			}
			/*code ends here*/
			?>
			<h3 class="margin-xs-t-m"><?php echo __('Offres et conditions') ?></h3>
			<label class="" for="edit-offer"><input type="checkbox" id="offer_subscription" name="offer_subscription" value="1" class="form-checkbox pull-left margin-xs-b-m" > <span class=""><?php echo __("Recevoir les offres intéressantes et les dernières nouvelles d'Orange") ?></span></label>
			<label class="" for="edit-conditions"><input type="checkbox" id="terms_condition" name="terms_condition" value="1" class="form-checkbox pull-left validation_check margin-xs-b-m"> <span class=""><?php echo __('Accepter les ') ?><a href="" class="orange" id="orange-conditions" target="_blank"><?php echo __('conditions générales de vente') ?> </a> <?php echo __("d'Orange") ?><?php echo "&nbsp;"?>*
			<div for="terms_condition" generated="true" class="mage-error" id="terms_condition-error" style="display: none;"><?php echo __('To finalize your order, please read and accept the general terms and conditions of Orange Belgium.');?></div>
			<div class="margin-xs-t-m margin-xs-b-m">
				<a class="btn btn-primary scoring" href="javascript:void(0);" id="step2"><?php echo __('Continuer') ?></a>
			</div>
		</div>
	</div>
 </div>
</div>
			</div>
			</div>
		</div>
	</div>
   	</div>
	</div>
</div>
<div class="test"></div>
<!--Adderss validation-->

<?php

   if(isset($tempSession ))
    {

	  $previousStep = $tempSession['step'];
 if(!isset($previousStep))
	{

	 $step3DivClass = "disable_div";

	}
	else if($previousStep == 'step2')
    {

	 $step3DivClass = "disable_div";


	}
	else if($previousStep == 'step3')
    {

	 $step3DivClass = "disable_div";

	}
	else
	{

	 $step3DivClass = "disable_div";

	}


}
else
{
	  $step3DivClass = "disable_div";

}

?>
<div id="step3_payment" class="row <?php if(isset($step3DivClass)) {  echo $step3DivClass; }?>">

</div>

 </form>
	</div>
<div class="col-xs-12 col-sm-8 col-md-8 padding-xs-b-m onepagetopcart" style='display:none;'>
<?php
$maxQty = false;
foreach($quoteitems as $childrenItem):
	$totalCartQty = $childrenItem->getQty() * 1;
	if($totalCartQty >1) {
		$maxQty = true;
	}
	if($childrenItem->getProductType() == 'virtual'):
		$quoteSubscriptionAmount = $childrenItem->getOriSubscriptionAmount();
	endif;
endforeach;
?>
<?php foreach ($quoteitems as $item) : ?>
<?php
/** @var $block \Magento\Checkout\Block\Cart\Item\Renderer */
$_item = $item;
$childrenItems = $_item->getChildren();
foreach($childrenItems as $childrenItem):
	if($childrenItem->getProductType() == 'virtual'):
		$quoteSubscriptionAmount = $childrenItem->getOriSubscriptionAmount();
	endif;
endforeach;
$product = $_item->getProduct();
$TypeId = $product->getTypeId();
$isVisibleProduct = $product->isVisibleInSiteVisibility();
/** @var \Magento\Msrp\Helper\Data $helper */
$helper = $this->helper('Magento\Msrp\Helper\Data');
$canApplyMsrp = $helper->isShowBeforeOrderConfirm($product) && $helper->isMinimalPriceLessMsrp($product);
$cartRender= $block->getLayout()->createBlock('Magento\Checkout\Block\Cart\Item\Renderer');
$crosSellCollection = $_item->getProduct()->getCrossSellProductCollection();

$VirtualTypeId = '';
?>
<?php if(!$maxQty): ?>
<div class='well-grey well-grey-padded margin-xs-t-m'>
<div class="row">
    <div class="col-xs-12 col-md-7">
        <h2 class="pull-left margin-xs-v-n margin-xs-t-s margin-xs-r-s">
            <?php if ($TypeId != 'bundle') {
				$_productIcon = $productObj->load($product->getId());  ?>
				<?php if ($customerType == 'SOHO') :
			   $prodImg = "soho-" .$_productIcon->getAttributeText('product_icon_image');
			   ?>
			   <?php else:
			   $prodImg = $_productIcon->getAttributeText('product_icon_image');
			   ?>
               <?php endif;?>
                <p class="oi oi-<?php echo $prodImg; ?>"></p>
                <?php } else { ?>
                    <?php
                    $crossChildren = $crossellObj->getVirtualChildrenProduct($product);

					?>
                    <?php foreach ($crossChildren as $childs) { ?>
                        <?php if ($customerType == 'SOHO') :
						   $iconImage = "soho-" .$childs->getAttributeText('product_icon_image');;
						   ?>
                        <?php else:
						$iconImage = $childs->getAttributeText('product_icon_image');?>
						<?php endif;?>
                        <?php $bundleSimpleImage = $imageBlock->getImage($childs, 'cart_page_product_thumbnail'); ?>

						<p class="oi oi-<?php echo $iconImage; ?>"></p>
                        <?php } ?>
                        <?php } ?>
                    </h2>

                            <?php if ($TypeId != 'bundle') { ?>
              <?php
			     $description_new = "";
		        $pdata = $om->create('Magento\Catalog\Model\Product')->load($item->getProduct()->getId());
                ?>
				<?php if ($customerType == 'SOHO'): ?>
					<?php   $description_new = $pdata->getShortDescriptionSoho();
						if($description_new == '') {
							$description_new = $pdata->getShortDescription();
						}
					?>
			      <?php else: ?>

                <?php  $description_new = $pdata->getShortDescription();    ?>
			  <?php endif; ?>
                             <h4 <?php if($description_new==''):?>class="checkout-subscription"<?php else: ?>class="checkout-subscription"<?php endif;?>><div> <?php echo $block->escapeHtml($pdata->getName()) ?></div>
							 <?php if($description_new): ?>
								<div class="short-desc">
                               <?php echo $description_new; ?>
                              </div>
							  <?php
								$prodId =  $item->getProduct()->getAttributeSetId();
								$attributeSetRepo = $attributeSet->get($prodId);
			                    $name = $attributeSetRepo->getAttributeSetName();
								?>
								<?php if(strtolower($name) == "iew"): ?>

												<p class="identity_num_text margintop7">
													<?php echo __("N° : nouveau numéro"); ?>
												</p>

											<?php endif; ?>

                                            <?php  if ($TypeId == 'virtual'  && strtolower($name) != "iew") { ?>
                                            <div class="virtual_new_number" style="display:none;"><?php echo __("nouveau numéro"); ?></div>
                                            <?php $tQty = $_item->getQty() * 1; ?>
                                             <?php $i=1;if($tQty ==1) { ?>
											   <p class="identity_num_text margintop7">
													<?php echo __("N° : "); ?> <span class="postpaid_<?php echo $item->getId()?>_<?php echo $i;?>" > <?php echo __("nouveau numéro"); ?></span>
												 </p>
                                             <?php } ?>
                                                                                   <?php } ?>
							  </h4>
							  <?php endif; ?>
                               <?php } else { ?>
                                    <?php
                                    $virtualChildren = $crossellObj->getVirtualChildrenProduct($product); ?>
                                    <?php foreach ($virtualChildren as $vChilds) { ?>
									<?php  $prodId =  $vChilds->getAttributeSetId();
                                                 $VirtualTypeId = $vChilds->getTypeId();
												 $attributeSetRepo = $attributeSet->get($prodId);
												 $name = $attributeSetRepo->getAttributeSetName();	?>
										<?php if ($customerType == 'SOHO'): ?>
                                    <?php $description = $vChilds->getShortDescriptionSoho();
										if($description ==''){
											$description = $vChilds->getShortDescription();
										}
									?>
			                           <?php else: ?>
                                      <?php $description = $vChilds->getShortDescription(); ?>
									<?php endif; ?>
                                      <h4 <?php if($description==''):?>class="checkout-subscription"<?php else: ?>class="checkout-subscription"<?php endif;?>> <div class="head_desc"> <?php echo $block->escapeHtml($vChilds->getName()); ?> </div>
									  	<div class="short-desc">
                                          <?php if ($customerType == 'SOHO'): ?>
                                          <?php
											if($vChilds->getShortDescriptionSoho() =='') {
												echo $vChilds->getShortDescription();
											} else {
												echo $vChilds->getShortDescriptionSoho();
											}
										  ?>
                                          <?php else: ?>
                                          <?php echo $vChilds->getShortDescription(); ?>
                                          <?php endif; ?>
                                        </div>
										<?php if(strtolower($name) == "iew"): ?>

												<p class="identity_num_text margintop7">
													<?php echo __("N° : nouveau numéro"); ?>
												</p>

											<?php endif; ?>
										<?php  if ($VirtualTypeId == 'virtual'  && strtolower($name) != "iew") { ?>
                                            <div class="virtual_new_number" style="display:none;"><?php echo __("nouveau numéro"); ?></div>
                                            <?php $tQty = $_item->getQty() * 1; ?>
                                             <?php $i=1;if($tQty ==1) { ?>
											   <p class="identity_num_text margintop7">
													<?php echo __("N° : "); ?> <span class="postpaid_<?php echo $item->getId()?>_<?php echo $i;?>" > <?php echo __("nouveau numéro"); ?></span>
												 </p>
                                             <?php } ?>
                                         <?php } ?>
										</h4>
                                        <?php } ?>
                                        <?php } ?>


                                <div class="clear"></div>
                            </div>
							  <div class="col-xs-12 col-md-5 padding-xs-b-s">
                                <?php
								$prodId =  $item->getProduct()->getAttributeSetId();
								$attributeSetRepo = $attributeSet->get($prodId);
			                    $name = $attributeSetRepo->getAttributeSetName();
								?>
                                <span class="new-price orange line-100percent">
                                   <?php if ($TypeId == 'virtual' ): ?>
                                    <?php
									$_product = $productObj->load($product->getId());
									$attr = $_product->getResource()->getAttribute('subscription_amount')->getFrontend()->getValue($_product);
									echo $productViewblock->getOrangePricingHtml($item->getOriSubscriptionAmount(),true,true,true,'checkout checkout-new-orange new-price orange');
									?>
                                   <?php elseif(($TypeId != 'bundle')&&($name=="Simcard")):?>
		                              <?php echo $productViewblock->getOrangePricingHtml($item->getPrice(),true,true,false,'checkout checkout-new-orange new-price orange simcard-cnt');?>
								   <?php elseif(($TypeId != 'bundle')&&($name!="Simcard")):?>
								        <?php echo $productViewblock->getOrangePricingHtml($item->getPrice(),true,true,false,'checkout checkout-new-orange new-price orange');?>
								   <?php else :?>
                                          <?php $VirtualTypeId = '';?>
                                           <?php foreach ($virtualChildren as $vChilds) : ?>
                                               <?php
                                                 $prodId =  $vChilds->getAttributeSetId();
                                                 $VirtualTypeId = $vChilds->getTypeId();
												 $attributeSetRepo = $attributeSet->get($prodId);
												 $name = $attributeSetRepo->getAttributeSetName();
												echo $productViewblock->getOrangePricingHtml($quoteSubscriptionAmount,true,true,true,'checkout checkout-new-orange new-price orange');
											   ?>
                                               <?php endforeach ?>
                                               <?php endif ?>
                                               <?php if ($TypeId == 'virtual') { ?>
                                                 <?php } ?></span>
                                            </div>
                                            <div class="clear"></div>
                                        </div>
										<?php if ($TypeId == 'bundle') { ?>
                                                    <div class="separator">
                                                        <div class="plus-box-grey">
                                                            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-xs-12 col-md-7">
                                                            <?php
                                                            $children = $crossellObj->getChildrenProduct($product); ?>
                                                            <h2 class="pull-left margin-xs-v-n margin-xs-t-s margin-xs-r-s">
                                                                <?php foreach ($children as $childs){ ?>
                                                                    <?php $producImageUrl = $block->getUrl('pub/media/catalog') . 'product' . $childs->getImage(); ?>
                                                                    <?php
                                                                    $iconImage = $childs->getAttributeText('product_icon_image');
                                                                    $productImage = $imageBlock->getImage($childs, 'cart_page_product_thumbnail'); ?>
                                                                     <p class="oi oi-<?php echo $iconImage; ?>"></p>
                                                                </h2>
                                                                <h4>
                                                                    <div class="head_desc"><?php echo $block->escapeHtml($childs->getName()); ?></div>
																	<div class="short-desc"><?php echo $block->escapeHtml($childs->getShortDescription()); ?></div>
                                                                </h4>
                                                                <div class="clear"></div>

                                                            </div>
                                                            <div class="col-xs-12 col-md-5 padding-xs-b-s text-vary">
                                                              <span class="new-price orange line-100percent">
																<?php
																echo $productViewblock->getOrangePricingHtml($item->getPrice(),true,true,false,'checkout checkout-new-orange new-price orange');
																?>
                                                            </span>
															<?php if($item->getPrice() < $discountFullTotalPrice): ?>
																<div class="short-descc"><p><?php echo __('à payer sur votre première facture') ?></p></div>
															<?php endif; ?>
                                                        </div>
                                                        <?php } ?>

                                                        <div class="clear"></div>

                                                    </div>
                                                    <?php } ?>
</div>
<?php else:?>
<div class='well-grey well-grey-padded well-grey-padded-no-bottom margin-xs-t-m'>
<div class="row quantity-box-1">
<div class="col-xs-12 col-md-2 quantity-box-2 hidden-xs hidden-sm custom-qty">
	<div class="grey-background">
		<?php if($store=="fr"):?><small class="quantity-label-fr"><?php else:?><small class="quantity-label"><?php endif;?><?php echo __("Quantité").$spaceColon; ?></small>
		<span class="margin-xs-v-n quantity-number font-24"><?php echo $_item->getQty() * 1; ?></span>
	</div>
</div>
<div class="col-xs-12 col-md-10 quantity-box-3">
<div class="row">
    <div class="col-xs-12 col-md-7">
        <h2 class="pull-left margin-xs-v-n margin-xs-t-s margin-xs-r-s">
            <?php if ($TypeId != 'bundle') {
                $_productIcon = $productObj->load($product->getId());  ?>
                <p class="oi oi-<?php echo $_productIcon->getAttributeText('product_icon_image'); ?>"></p>
                <?php } else { ?>
                    <?php
                    $crossChildren = $crossellObj->getVirtualChildrenProduct($product);
					?>
                    <?php foreach ($crossChildren as $childs) { ?>
                        <?php
						$iconImage = $childs->getAttributeText('product_icon_image');
                        $bundleSimpleImage = $imageBlock->getImage($childs, 'cart_page_product_thumbnail'); ?>

						<p class="oi oi-<?php echo $iconImage; ?>"></p>
                        <?php } ?>
                        <?php } ?>
                    </h2>

                            <?php if ($TypeId != 'bundle') { ?>
              <?php
			     $description_new = "";
		        $DescProductNew = $productObj->load($item->getProduct()->getId());
                ?>
				<?php if ($customerType == 'SOHO'): ?>
					<?php   $description_new = $DescProductNew->getShortDescriptionSoho();
						if($description_new =='') {
							$description_new = $DescProductNew->getShortDescription();
						}
					?>
			      <?php else: ?>

                <?php  $description_new = $DescProductNew->getShortDescription();    ?>
			  <?php endif; ?>
                             <h4 <?php if($description_new==''):?>class="checkout-subscription"<?php else: ?>class="checkout-subscription"<?php endif;?>><div class="head_desc"> <?php echo $block->escapeHtml($item->getProduct()->getName()) ?> </div>
							 <?php if($description_new): ?>
								<div class="short-desc">
                               <?php echo $description_new; ?>
                              </div>
							  <?php
								$prodId =  $item->getProduct()->getAttributeSetId();
								$attributeSetRepo = $attributeSet->get($prodId);
			                    $name = $attributeSetRepo->getAttributeSetName();
								?>
								<?php if(strtolower($name) == "iew"): ?>

												<p class="identity_num_text margintop7">
													<?php echo __("N° : nouveau numéro"); ?>
												</p>

											<?php endif; ?>
										<?php  if ($TypeId == 'virtual'  && strtolower($name) != "iew") { ?>
                                            <div class="virtual_new_number" style="display:none;"><?php echo __("nouveau numéro"); ?></div>
                                            <?php $tQty = $_item->getQty() * 1; ?>
                                             <?php $i=1;if($tQty ==1) { ?>
											   <p class="identity_num_text margintop7">
													<?php echo __("N° : "); ?> <span class="postpaid_<?php echo $item->getId()?>_<?php echo $i;?>" > <?php echo __("nouveau numéro"); ?></span>
												 </p>
                                             <?php } ?>
                                         <?php } ?>
							  </h4>
							  <?php endif; ?>
                               <?php } else { ?>
                                    <?php
                                    $virtualChildren = $crossellObj->getVirtualChildrenProduct($product); ?>
                                    <?php foreach ($virtualChildren as $vChilds) { ?>
									<?php
										 $prodId =  $vChilds->getAttributeSetId();

										 $VirtualTypeId = $vChilds->getTypeId();
										 $attributeSetRepo = $attributeSet->get($prodId);
										 $name = $attributeSetRepo->getAttributeSetName();
									?>
										<?php if ($customerType == 'SOHO'): ?>
                                    <?php $description = $vChilds->getShortDescriptionSoho();
										if($description =='') {
											$description = $vChilds->getShortDescription();
										}
									?>
			                           <?php else: ?>
                                      <?php $description = $vChilds->getShortDescription(); ?>
									<?php endif; ?>
                                      <h4 <?php if($description==''):?>class="checkout-subscription"<?php else: ?>class="checkout-subscription"<?php endif;?>> <div class="head_desc"> <?php echo $block->escapeHtml($vChilds->getName()); ?> </div>
									  	<div class="short-desc">
                                          <?php if ($customerType == 'SOHO'): ?>
                                          <?php
											if($vChilds->getShortDescriptionSoho() =='') {
												echo $vChilds->getShortDescription();
											} else {
												echo $vChilds->getShortDescriptionSoho();
											}
										  ?>
                                          <?php else: ?>
                                          <?php echo $vChilds->getShortDescription(); ?>
                                          <?php endif; ?>
                                        </div>
										<?php if(strtolower($name) == "iew"): ?>
												<p class="identity_num_text margintop7">
													<?php echo __("N° : nouveau numéro"); ?>
												</p>
											<?php endif; ?>
											<?php  if ($VirtualTypeId == 'virtual'  && strtolower($name) != "iew") { ?>
                                            <div class="virtual_new_number" style="display:none;"><?php echo __("nouveau numéro"); ?></div>
                                            <?php $tQty = $_item->getQty() * 1; ?>
                                             <?php $i=1;if($tQty ==1) { ?>
											   <p class="identity_num_text margintop7">
													<?php echo __("N° : "); ?> <span class="postpaid_<?php echo $item->getId()?>_<?php echo $i;?>" > <?php echo __("nouveau numéro"); ?></span>
												 </p>
                                             <?php } ?>
                                         <?php } ?>
										</h4>
                                        <?php } ?>
                                        <?php } ?>


                                <div class="clear"></div>
                            </div>
							  <div class="col-xs-12 col-md-5 padding-xs-b-s">
							   <?php
								$prodId =  $item->getProduct()->getAttributeSetId();
								$attributeSetRepo = $attributeSet->get($prodId);
			                    $name = $attributeSetRepo->getAttributeSetName();
								?>
                               <span class="new-price orange line-100percent">
                                   <?php if ($TypeId == 'virtual' ) : ?>
                                   <?php
									$_product = $productObj->load($product->getId());
									$attr = $_product->getResource()->getAttribute('subscription_amount')->getFrontend()->getValue($_product);
									echo $productViewblock->getOrangePricingHtml($item->getOriSubscriptionAmount(),true,true,true,'checkout checkout-new-orange new-price orange');
									?>
                                    <?php elseif(($TypeId != 'bundle')&&($name=="Simcard")):?>
									  <?php echo $productViewblock->getOrangePricingHtml($item->getPrice(),true,true,false,'checkout checkout-new-orange new-price orange simcard-cnt');?>

								    <?php elseif(($TypeId != 'bundle')&&($name!="Simcard")):?>
								        <?php echo $productViewblock->getOrangePricingHtml($item->getPrice(),true,true,false,'checkout checkout-new-orange new-price orange');?>
								    <?php else :?>
                                           <?php $VirtualTypeId = '';
										   foreach ($virtualChildren as $vChilds) : ?>
                                               <?php
                                                $prodId =  $vChilds->getAttributeSetId();

												 $VirtualTypeId = $vChilds->getTypeId();
												 $attributeSetRepo = $attributeSet->get($prodId);
												 $name = $attributeSetRepo->getAttributeSetName();
												echo $productViewblock->getOrangePricingHtml($quoteSubscriptionAmount,true,true,true,'checkout checkout-new-orange new-price orange');
											   ?>
                                               <?php endforeach ?>
                                               <?php endif ?>
                                               <?php if ($TypeId == 'virtual') { ?>
                                                 <?php } ?></span>
                                            </div>
                                            <div class="clear"></div>
                                        </div>
											<?php if ($TypeId == 'bundle') { ?>
                                                    <div class="separator">
                                                        <div class="plus-box-grey">
                                                            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-xs-12 col-md-7">
                                                            <?php
                                                            $children = $crossellObj->getChildrenProduct($product); ?>
                                                            <h2 class="pull-left margin-xs-v-n margin-xs-t-s margin-xs-r-s">
                                                                <?php foreach ($children as $childs){ ?>
                                                                    <?php $producImageUrl = $block->getUrl('pub/media/catalog') . 'product' . $childs->getImage(); ?>
                                                                    <?php
                                                                    $iconImage = $childs->getAttributeText('product_icon_image');
                                                                    $productImage = $imageBlock->getImage($childs, 'cart_page_product_thumbnail'); ?>
                                                                     <p class="oi oi-<?php echo $iconImage; ?>"></p>
                                                                </h2>
                                                                <h4>
                                                                    <div class="head_desc"><?php echo $block->escapeHtml($childs->getName()); ?></div>
																	<div class="short-desc"><?php echo $block->escapeHtml($childs->getShortDescription()); ?></div>
                                                                </h4>

                                                                <div class="clear"></div>

                                                            </div>
                                                            <div class="col-xs-12 col-md-5 padding-xs-b-s text-vary">
                                                              <span class="new-price orange line-100percent">
																<?php
																echo $productViewblock->getOrangePricingHtml($item->getPrice(),true,true,false,'checkout checkout-new-orange new-price orange');
																?>
                                                            </span>
															<?php if($item->getPrice() < $discountFullTotalPrice): ?>
																<div class="short-descc"><p><?php echo __('à payer sur votre première facture') ?></p></div>
															<?php endif; ?>
                                                        </div>
                                                        <?php } ?>

                                                        <div class="clear"></div>
                                                    </div>
                                                    <?php } ?>

</div>
<div class="col-xs-12 col-md-2 quantity-box-2 hidden-md">
		<div class="grey-background margin-xs-b-n margin-xs-t-s">
			<small class="quantity-label"><?php echo __("Quantité").$spaceColon; ?></small>
			<h4 class="margin-xs-v-n quantity-number"><?php echo $_item->getQty() * 1; ?></h4>
			</div>
	</div>
</div>
</div>
<?php endif;?>


													<?php endforeach;?>

</div>
<div class="cart_coupon_from" style="display:none">
		<?php
		$couponBlock = $block->getLayout()->createBlock('Amasty\Coupons\Block\Coupon');
		$couponCodes = $couponBlock->getCouponsCode();
		$orangeCouponHelper = $this->helper('Orange\Coupon\Helper\Data');
		if ($couponCodes):
		$html = '';

		foreach ($couponCodes as $couponCode):
			$coupon = $couponBlock->getCouponData($couponCode);
			$ruleId = $coupon->getRuleId();
			$rule =  $couponBlock->getRuleData($ruleId);
			$label = $couponBlock->getStoreLabel($ruleId,$storeID);
			$ruleDiscount = $orangeCouponHelper->getRuleDiscountAmount($ruleId);
			$ruleDiscountAmount =0;
			foreach($ruleDiscount as $ruleDsnt):
				$ruleDiscountAmount += $ruleDsnt->getTotalDiscountAmount() + $ruleDsnt->getTotalSubscriptionDiscountAmount();
			endforeach;
			$html .= '<div class="well-grey well-grey-padded margin-xs-v-m" style=""><div class="row"><div class="col-xs-12 col-md-8"><h2 class="pull-left margin-xs-b-n margin-xs-t-n margin-xs-r-s"><i class="oi oi-tag margin-xs-t-s"></i></h2><h4>'.$couponCode.'</h4><small>'.$label.'</small><div class="clear"></div></div><div class="col-xs-12 col-md-4 padding-xs-b-s"><span class="new-price orange line-100percent">'.$productViewblock->getOrangePricingHtml($ruleDiscountAmount, false, false, false, 'pdp total-pricee new-price orange',true).'</span></div></div></div>';
		endforeach;
		echo $html;
		endif;
		?>
	<div class="well-grey well-grey-padded margin-xs-v-m">
	<div class="row">
		<div class="col-xs-12 col-sm-8 col-md-9">
			<input class="form-control orange-promocode" autocomplete="off" type="text" name="coupon_code" placeholder="<?php /* @escapeNotVerified */ echo __('Code promo'); ?>">
		</div>
		<div class="col-xs-12 col-sm-4 col-md-3 margin-xs-t-s margin-sm-t-n">
			<button class="btn btn-primary orange-promocode-submit" name="coupon-submit"><?php /* @escapeNotVerified */ echo __('Valider'); ?></button>
		</div>
	</div>
	</div>
</div>

<div id="checkout" data-bind="scope:'checkout'" class="container checkout-container">
<?php if($checkstepstatfinal == 'final') { ?>
    <div id="checkout-loader" data-role="checkout-loader" class="loading-mask" data-mage-init='{"checkoutLoader": {}}'>
        <div class="loader">
            <img src="<?php /* @escapeNotVerified */ echo $block->getViewFileUrl('images/loader-1.gif'); ?>"
                 alt="<?php /* @escapeNotVerified */ echo __('Loading...'); ?>"
                 style="position: absolute;">
			<p class="please-wait-loaders"><?php echo __('Merci de patienter');?></p>
        </div>
    </div>
	<?php } ?>
    <!-- ko template: getTemplate() --><!-- /ko -->
    <script type="text/x-magento-init">
        {
            "#checkout": {
                "Magento_Ui/js/core/app": <?php /* @escapeNotVerified */ echo $block->getJsLayout();?>
            }
        }
    </script>

    <script>
        window.checkoutConfig = <?php /* @escapeNotVerified */ echo \Zend_Json::encode($block->getCheckoutConfig()); ?>;
		window.sohoDiscountAmount = <?php /* @escapeNotVerified */ echo $productViewblock->getSohoDiscountAmount(); ?>;
        // Create aliases for customer.js model from customer module
        window.isCustomerLoggedIn = window.checkoutConfig.isCustomerLoggedIn;
        window.customerData = window.checkoutConfig.customerData;
    </script>
</div>

<script type="text/javascript">
require(['jquery',
      'mage/template',
	  'mage/mage',
	  'js/dropdown'	,
	  'jquery/validate',
      'jquery/ui',
      'mage/translate',
	  'mage/validation',
	  'js/tooltipform',
	  'mage/calendar',
	  'js/maskedinput',
	  'js/checkout_new'], function ($) {
	  //<![CDATA[
		var translates = <?php
		echo \Zend_Json::encode(
				array(
					"This is a required field." => __("This is a required field."),
					"Please wait..." => __("Please wait..."),
					"Please use Proper Street Number." => __("Please use Proper Street Number."),
					"Zipcode & city doesn't exist" => __("Zipcode & city doesn't exist"),
					"You Must be 18+ years old." => __("You Must be 18+ years old"),
					"Street doesn't exist" => __("Street doesn't exist"),
					"City does not exist" => __("City does not exist"),
					'Vous avez annulé le code de coupon.' => __('Vous avez annulé le code de coupon.'),
					'Le code promo a été appliqué à votre commande.' => __('Le code promo a été appliqué à votre commande.'),
					"Please enter a valid email address (Ex: johndoe@domain.com)."=> __('Please enter a valid email address (Ex: johndoe@domain.com).'),
					"Please use letters only in this field."=> __('Please use letters only in this field.'),
					"Zipcode doesn't exist" => __("Zipcode doesn't exist"),
					"Please use number start with 045,046,047,048 and 049" => __("Please use number start with 045,046,047,048 and 049"),
					"Please enter a valid 10 digit mobile phone number."=> __("Please enter a valid 10 digit mobile phone number."),
					"No Payment method available." => __("No Payment method available."),
					"No Payment Methods" => __("No Payment Methods"),
					"No Payment Information Required" => __("No Payment Information Required"),
					"Please enter your current mobile phone number, consisting of 10 digits" => __("Please enter your current mobile phone number, consisting of 10 digits"),
					"Please enter your current SIM card number, consisting of 13, 18 or 19 digits depending on the operator" => __("Please enter your current SIM card number, consisting of 13, 18 or 19 digits depending on the operator"),
					"Please enter a valid 10 digit mobile phone number" => __("Please enter a valid 10 digit mobile phone number"),
					"Please verify that you have correctly entered the 12 digits of your ID number" => __("Please verify that you have correctly entered the 12 digits of your ID number"),
					"Please verify that you have correctly entered the 11 digits of your National ID number" => __("Please verify that you have correctly entered the 11 digits of your National ID number"),
					"Please enter your account number in the following format: BEXX XXXX XXXX XXXX" => __("Please enter your account number in the following format: BEXX XXXX XXXX XXXX"),
					"Please select an option." => __("Please select an option."),
					"You must enter a valid date of birth (dd / mm / yyyy) and be over 18 years of age"=> __("You must enter a valid date of birth (dd / mm / yyyy) and be over 18 years of age"),
					"This is a required fields." => __("This is a required fields."),
					"Please enters a valid email address (Ex: johndoe@domain.com)."=> __('Please enters a valid email address (Ex: johndoe@domain.com).'),
                    "Please enter a value greater than or equal to 2."=> __('Please enter a value greater than or equal to 2.'),
                    "Please enter at least 2 characters."=> __('Please enter at least 2 characters.'),
					"Please use only letter (a-z or A-Z) or numbers (0-9) in this field. No spaces or other characters are allowed."=> __('Please use only letter (a-z or A-Z) or numbers (0-9) in this field. No spaces or other characters are allowed.'),
					"Please enter at least 3 characters."=> __('Please enter at least 3 characters.'),
					"Please enter at least 3 characters newmessage."=> __('Please enter at least 3 characters newmessage.'),
					"Please enter first character should be a number."=>__('Please enter first character should be a number.'),
					"Please enter only 35 characters in first name and last name."=>__('Please enter only 35 characters in first name and last name.'),
					"Current SIM card number and operator not matched."=>__('Current SIM card number and operator not matched.'),
					"Please Enter valid month"=>__('Please Enter valid month'),
					"Please Enter valid date"=>__('Please Enter valid date'),
					"Please correct below invalid fields"=>__('Please correct below invalid fields'),
					"MNP Number is already used"=>__('MNP Number is already used'),
					"Please enter a valid mobile phone number for first step1."=>__('Please enter a valid mobile phone number for first step1.'),
					"Veuillez vérifier que vous avez correctement introduit votre numéro de titre de séjour (format B XXXXXXX XX)."=>__('Veuillez vérifier que vous avez correctement introduit votre numéro de titre de séjour (format B XXXXXXX XX).'),
					"Votre numéro de document d'identité n'est pas reconnu. Veuillez vérifier qu'il soit correct."=>__('Votre numéro de document d\'identité n\'est pas reconnu. Veuillez vérifier qu\'il soit correct.'),
					"Votre numéro de Registre national n'est pas reconnu. Veuillez vérifier qu'il soit correct."=>__('Votre numéro de Registre national n\'est pas reconnu. Veuillez vérifier qu\'il soit correct.'),
                    "To finalize your order, please read and accept the general terms and conditions of Orange Belgium."=>__('To finalize your order, please read and accept the general terms and conditions of Orange Belgium.'),
					"Le code promo %1 a ete applique."=>__("Le code promo %1 a ete applique."),
					"Le code promo %1 n'est pas valide."=>__("Le code promo %1 n'est pas valide."),
					"nouveau numéro"=>__("nouveau numéro"),
					"Please enter date of birth, then your register national ID will validate" =>__("Please enter date of birth, then your register national ID will validate")
				)
		);?>;
		$.mage.translate.add(translates);

/*Street Number Validation**/	 
$('[data-toggle="tooltip"]').tooltip();

/*Mask for Id card and National ID*/
$('#national_id_number').mask("000000 000 00",{placeholder:"______ ___ __"});

/* Defect 11123 - unmask field while input value Past*/
$('#id_number').on('paste', function() {
	$("#id_number").val('');
    $("#id_number").unmask();
	var idcardlength  = $("#id_number").val();
	setTimeout(function () {
	getval = $('#id_number').val();
	$('#id_number').val('');
	$('#id_number').val(getval);
    }, 200);
});

$("#id_number").keypress(function() {
	var idselect  = document.getElementById('id_number');
	if(CheckSelected(idselect)){
		$("#id_number").val('');
		$("#id_number").unmask();
	}
});

$("#id_number").keyup(function() {
	var idselect  = document.getElementById('id_number');
	if(CheckSelected(idselect)){
		$("#id_number").val('');
		$("#id_number").unmask();
	}

	var idcardlength  = $(this).val();
	var idcardlengthC = idcardlength.substr(0, 1);
	if((idcardlength.length == 1) && (idcardlengthC.toUpperCase() == 'B')) {
		$('#id_number').mask("B 0000000 00");
	} else if (idcardlength.length == 1 && (parseInt(idcardlengthC) == 5)) {
		$('#id_number').mask("000-0000000-00");
	} else if((idcardlength.length == 0)) {
		$('#id_number').unmask();
	}

	if((idcardlength.length != 0)) {
		if((idcardlengthC.toUpperCase() == 'B')) {
			$('#id_number').mask("B 0000000 00");
		} else if (parseInt(idcardlengthC) == 5) {
			$('#id_number').mask("500-0000000-00");
		}
	}
});

/* Defect 11123 - check input value selected*/
function CheckSelected(input) {
    if (typeof input.selectionStart == "number") {
        return input.selectionStart == 0 && input.selectionEnd == input.value.length;
    } else if (typeof document.selection != "undefined") {
        input.focus();
        return document.selection.createRange().text == input.value;
    }
}

/* Blur Event for Id Card Number and Residence Number */
$("#id_number").on("blur", function () {
	var idcardlength  = $(this).val();
	var idcardlengthC = idcardlength.substr(0, 1);
	if(idcardlength.length == 0) {
		$(checkout_form).validation();
		$.validator.validateElement($("#id_number"));
		$('#id_number').unmask();
		$("#residence_error").hide();
		$("#id_number_new_error").hide();
	} else {
		if((idcardlengthC.toUpperCase() == 'B')) {
			$('#id_number').mask("B 0000000 00");
			var value = idcardlength.replace(/\s/g, "");
			var number = parseInt(value.substring(1, 10));
			if (value.length < 10) {
				$("#residence_error").show();
				$('#id_number').addClass('mage-error');
				$("#id_number_new_error").hide();
				$("#id_number-error").hide();
			} else {
				$("#id_number-error").hide();
				$("#residence_error").hide();
				$('#id_number').removeClass('mage-error');
				$("#id_number_new_error").hide();
			}
		} else if (parseInt(idcardlengthC) == 5) {
			$('#id_number').mask("500-0000000-00");
			var value = idcardlength.replace(/-/g, "");
			var numbr = parseInt(value);
			if ((value.length) == 12 && numbr > 0) {
				var check_digit = value.substr(-2);
				var number = value.substring(0, 10);
				var result = number % 97;
				if(result == parseInt(check_digit) || result == 0 ) {
					$("#id_number_new_error").hide();
					$("#residence_error").hide();
					$('#id_number').removeClass('mage-error');
					$("#id_number-error").hide();
				} else {
					$("#id_number_new_error").show();
					$('#id_number').addClass('mage-error');
					$("#residence_error").hide();
					$("#id_number-error").hide();
				}
			} else {
				$("#id_number_new_error").show();
				$('#id_number').addClass('mage-error');
				$("#residence_error").hide();
				$("#id_number-error").hide();
			}
		}
	}
});

var options =  {
  placeholder: "BE__ ____ ____ ____",
  onKeyPress: function(cep, event, currentField, options){
    if (cep.length < 2) {  $("#first-accountnumber").val('BE'); }
	if (cep.length == 19) {
	$('[data-role="pannel"]').trigger('show.checkoutLoader');
		var session_url = $("#session_url").val();
                $.ajax({
                    url: session_url,
                    data: {accountnumber: $("input:text[name='account_number']").val()},
                    type: 'POST',
                    dataType: 'json',
					showLoader: true,
                    context: $('#step2'),
					success: function (result) {
                        $('#first-accountnumber').trigger('blur');
                        }
                });
	}
	},
  };
/*Commenting Below line for Nation id CR*/  
//$('#residence_number').mask("B 0000000 00",{placeholder:"B _______ __"});
$('#cu_ex_invoice_cust_number').mask("1.0000000000000000000",{placeholder:"1."});
var options2 =  {
  onComplete: function(cep) {

  },
  onKeyPress: function(cep, event, currentField, options){

  },
  onChange: function(cep){

  },
  onInvalid: function(val, e, f, invalid, options){
    var error = invalid[0];

  }
};
$('#cust_telephone').mask("0000/00 00 00", {placeholder: "____/__ __ __"});
$('#first-accountnumber').mask("BE00 0000 0000 0000", options);

$('.design_te_existing_number').mask("0000/00 00 00", {placeholder: "____/__ __ __"});

/* 1802 National ID Register Project */
$.validator.addMethod(
'id-number', function (value) {
	$("#id_number_new_error").hide();
	$("#residence_error").hide();
	var idcardnumC = value.substr(0, 1);
	if((idcardnumC.toUpperCase() == 'B')) {
		var idcardnum = value.replace(/\s/g, "");
		var number = parseInt(idcardnum.substring(1, 10));
		if (idcardnum.length < 10) {
			return false;
		}
	} else {
		var idcardnum = value.replace(/-/g, "");
		var numbr = parseInt(idcardnum);
		if ((idcardnum.length) < 12) {
			return false;
		} else if ((idcardnum.length) == 12 && numbr > 0) {
			var check_digit = idcardnum.substr(-2);
			var number = idcardnum.substring(0, 10);
			var result = number % 97;
			if(result == parseInt(check_digit) || result == 0 ) {
				return true;
			} else {
				return false;
			}
		} else {
			return false;
		}
	}
	return true;
}, $.mage.__('Please verify that you have correctly entered the 12 digits of your ID number'));
/* 1802 National ID Register Project */

$.validator.addMethod(
'validate-residence', function (value) {
	var residenceval = value.replace(/\s/g,'');
	if (residenceval.length < 10) {
		return false;
	}
	return true;
}, $.mage.__('Votre numéro de document d\'identité n\'est pas reconnu. Veuillez vérifier qu\'il soit correct.'));

$.validator.addMethod(
'validate-streetnumber', function (value) {
var slicevalue = value.substring(0, 1);
 return /^[A-Za-z0-9]*$/.test(slicevalue);
}, $.mage.__('Please use Proper Street Number.'));


$.validator.addMethod(
'validate-namefiled', function (value) {
 return /^[ <?php echo $specialCharacter; ?>]*$/.test(value);
}, $.mage.__('Please use letters only in this field.'));

$.validator.addMethod(
'validate-field', function (value) {
 return /^[a-zA-Z-]+$/.test(value);
}, $.mage.__('Please use letters only in this field.'));

$.validator.addMethod(
'validate-punctuation', function (value) {
 return /^[ A-Za-z_0-9'.-]*$/.test(value);
}, $.mage.__('Please use only letters (a-z or A-Z) or numbers (0-9) or Punctuation.'));


$.validator.addMethod(
'validate-orangenumber', function (value) {
    var slicevalue = value.slice(0,3);
    var orangeFrontNumber = ["045", "046", "047", "048","049"];
    var finalVlaue = orangeFrontNumber.indexOf(slicevalue);
    if (finalVlaue < 0) {
		return false;
    }
return true;

}, $.mage.__('Please enter a valid 10 digit mobile phone number.'));

$.validator.addMethod(
'validate-orangenumber-step1', function (value) {
    var slicevalue = value.slice(0,3);
    var orangeFrontNumber = ["045", "046", "047", "048","049"];
    var finalVlaue = orangeFrontNumber.indexOf(slicevalue);
    if (finalVlaue < 0) {
		return false;
    }
return true;

}, $.mage.__('Please enter a valid mobile phone number for first step1.'));

$.validator.addMethod(
'validate-contactnumber', function (value) {
    var replacedValue = value.replace(/[\. ,:_/]+/g, "");
    if (replacedValue.length < 10) {
		return false;
	}
return true;
}, $.mage.__('Please enter a valid 10 digit mobile phone number.'));

$.validator.addMethod(
'validate-orangecontactnumber', function (value) {
    var slicevalue = value.slice(0,3);
    var orangeFrontNumber = ["045", "046", "047", "048","049"];
    var finalVlaue = orangeFrontNumber.indexOf(slicevalue);
    if (finalVlaue < 0) {
		return false;
    }
return true;
}, $.mage.__('Please enter a valid 10 digit mobile phone number.'));

$.validator.addMethod(
'validate-street-valid', function (value) {
    var slicevalue = value.slice(0,1);
    if($.isNumeric(slicevalue)){
        return true;
    }else{
        return false;
    }
}, $.mage.__('Please enter first character should be a number.'));



$.validator.addMethod(
'validate-orangenumber-total', function (value) {
    var replacedValue = value.replace(/[\. ,:_/]+/g, "");
    if (replacedValue.length < 10) {
		return false;
	}
return true;
}, $.mage.__('Please enter your current mobile phone number, consisting of 10 digits'));

$.validator.addMethod(
'validate-contactno', function (value) {
    var replacedValue = value.replace(/[\. ,:_/]+/g, "");
    if (replacedValue.length < 10) {
		return false;
	}
return true;
}, $.mage.__('Please enter a valid 10 digit mobile phone number.'));

$.validator.addMethod(
'simcard-number', function (value) {
    if (value.length < 13) {

		return false;
	}
return true;
}, $.mage.__('Please enter your current SIM card number, consisting of 13, 18 or 19 digits depending on the operator'));

$.validator.addMethod(
'contact-number', function (value) {
    if (value.length < 10) {
		return false;
	}
return true;
}, $.mage.__('Please enter a valid 10 digit mobile phone number'));


//Start National Id implementation
$.validator.addMethod(
'dob-required', function (value) {
	var dob = $("#c_dob").val();
    if (dob == '') {
		$("#c_dob").focus();
		return false;
	}
return true;
}, $.mage.__('Please enter date of birth, then your register national ID will validate'));

$.validator.addMethod(
'validate-nid', function (value) {
	var nid = $("#national_id_number").val();
	if ( nid != '') {
		var value = nid.replace(/ /g, "");
	    var dob = $("#c_dob").val();
	    var dob_s  = dob.split('/');
	    var dob_yy = parseInt(dob_s[2]);

		if ( (value > 0) && (dob_yy != NaN) && (value.length) == 11) {
			// Extract last 2 digits
			var check_digit = value.substr(-2);
			// Collect first 9 digits
			var number = value.substring(0, 9);
			// New logic implemented in else part for National ID register number validation based on the birth year.
			if (dob_yy < 2000) {
				var modulo_number = number - (parseInt(number / 97) * 97);
				var check_value = 97 - modulo_number;
				if ((check_value == check_digit) || check_value == 0 || check_value == 97) {
					$('#national_id_number').removeClass('mage-error');
					$('#national_id_number-error').hide();
				} else {
					$('#national_id_number').addClass('mage-error');
					if ($('#national_id_number-error').length == 0) {
						$("div#national_id_number_div .margin-xs-t-s").append("<div for='national_id_number' generated='true' class='mage-error' id='national_id_number-error' style='display: block;'></div>");
					}
					$('#national_id_number-error').html($.mage.__('Votre numéro de Registre national n\'est pas reconnu. Veuillez vérifier qu\'il soit correct.'));
					$('#national_id_number-error').show();
				}
			} else {
				number = parseInt('2' + number);
				var modulo_number = number % 97;
				var check_value = 97 - modulo_number;
				if (check_value == check_digit) {
					$('#national_id_number').removeClass('mage-error');
					$('#national_id_number-error').hide();
				} else {
					$('#national_id_number').addClass('mage-error');
					if ($('#national_id_number-error').length == 0) {
						$("div#national_id_number_div .margin-xs-t-s").append("<div for='national_id_number' generated='true' class='mage-error' id='national_id_number-error' style='display: block;'></div>");
					}
					$('#national_id_number-error').html($.mage.__('Votre numéro de Registre national n\'est pas reconnu. Veuillez vérifier qu\'il soit correct.'));
					$('#national_id_number-error').show();
				}
			}
		} else {
			$('#national_id_number').addClass('mage-error');
			if ($('#national_id_number-error').length == 0) {
				$("div#national_id_number_div .margin-xs-t-s").append("<div for='national_id_number' generated='true' class='mage-error' id='national_id_number-error' style='display: block;'></div>");
			}
			$('#national_id_number-error').html($.mage.__('Votre numéro de Registre national n\'est pas reconnu. Veuillez vérifier qu\'il soit correct.'));
			$('#national_id_number-error').show();
		}
	}
	return true;
});

$.validator.addMethod(
'national-id-number', function (value) {
	var value = value.replace(/ /g, "");
    var dob = $("#c_dob").val();
    var dob_s  = dob.split('/');
    var dob_yy = parseInt(dob_s[2]);

	if ( (value > 0) && (dob_yy != NaN) && (value.length) == 11) {
		// Extract last 2 digits
		var check_digit = value.substr(-2);
		// Collect first 9 digits
		var number = value.substring(0, 9);
		// New logic implemented in else part for National ID register number validation based on the birth year.
		if (dob_yy < 2000) {
			var modulo_number = number - (parseInt(number / 97) * 97);
			var check_value = 97 - modulo_number;
			if ((check_value == check_digit) || check_value == 0 || check_value == 97) {
				return true;
			} else {
				return false;
			}
		} else {
			number = parseInt('2' + number);
			var modulo_number = number % 97;
			var check_value = 97 - modulo_number;
			if (check_value == check_digit) {
				return true;
			} else {
				return false;
			}
		}
	} else {
		return false;
	}
	return true;
}, $.mage.__('Votre numéro de Registre national n\'est pas reconnu. Veuillez vérifier qu\'il soit correct.'));
//End National Id implementation

$.validator.addMethod(
'validate-select-newrule', function (value) {
   return ((value !== "none") && (value != null) && (value.length !== 0));
}, $.mage.__('Please select an option.'));

//DOB Validation
	$.validator.addMethod(
	'dob-date-validation', function (value) {
		var c_dob_v    = value;
		var c_dob_s    = c_dob_v.split('/');
		var day     = c_dob_s[0];
		var month  =  c_dob_s[1];
		var year   =  c_dob_s[2];
		var age    =  18;
		var mydate = new Date();
		mydate.setFullYear(year, month-1, day);
		var currdate = new Date();
		var minYear = currdate.getFullYear() - 100;
		currdate.setFullYear(currdate.getFullYear() - age);
		if(year < minYear) {
			return false;
		}
		return (currdate - mydate < 0 ? false : true);
	}, $.mage.__('You must enter a valid date of birth (dd / mm / yyyy) and be over 18 years of age'));

	$.validator.addMethod(
	'dob-prepaid-validation', function (value) {
		var c_dob_v    = value;
		var c_dob_s    = c_dob_v.split('/');
		var day     = c_dob_s[0];
		var month  =  c_dob_s[1];
		var year   =  c_dob_s[2];
		var val = month+"/"+day+"/"+year;
		var now = new Date();
		var myDate = new Date(val);
		if(myDate > now) {
			return false;
		}
		return true;
	}, $.mage.__('Please Enter valid date'));

	$.validator.addMethod(
		'validate-dob-date', function (dob) {
		var dd    = dob.split('/')[0];
		var mm    = dob.split('/')[1];
		var yy	  = dob.split('/')[2];
		if(dd < 1)
		{
			return false;
		}
		// Create list of days of a month [assume there is no leap year by default]
		var ListofDays = [31,28,31,30,31,30,31,31,30,31,30,31];
		if (mm==1 || mm>2)
		{
			if (dd>ListofDays[mm-1])
			{
				return false;
			}
		}
		if (mm==2)
		{
			var lyear = false;
			if ( (!(yy % 4) && yy % 100) || !(yy % 400))
			{
				lyear = true;
			}
			if ((lyear==false) && (dd>=29))
			{
				return false;
			}
			if ((lyear==true) && (dd>29))
			{
				return false;
			}
		}
		return true;
	}, $.mage.__('Please Enter valid date'));

	$.validator.addMethod(
		'validate-dob-month', function (dob) {
		var v    = dob.split('/')[1];
		if(v < 1 || v > 12){
			return false;
		}
		return true;
	}, $.mage.__('Please Enter valid month'));

	$.validator.addMethod(
		'validate-dobpostpaid-date', function (dob) {
		var dd    = dob.split('/')[0];
		var mm    = dob.split('/')[1];
		var yy	  = dob.split('/')[2];
		if(dd < 1)
		{
			return false;
		}
		// Create list of days of a month [assume there is no leap year by default]
		var ListofDays = [31,28,31,30,31,30,31,31,30,31,30,31];
		if (mm==1 || mm>2)
		{
			if (dd>ListofDays[mm-1])
			{
				return false;
			}
		}
		if (mm==2)
		{
			var lyear = false;
			if ( (!(yy % 4) && yy % 100) || !(yy % 400))
			{
				lyear = true;
			}
			if ((lyear==false) && (dd>=29))
			{
				return false;
			}
			if ((lyear==true) && (dd>29))
			{
				return false;
			}
		}
		return true;
	}, $.mage.__('You must enter a valid date of birth (dd / mm / yyyy) and be over 18 years of age'));

	$.validator.addMethod(
		'validate-dobpostpaid-month', function (dob) {
		var v    = dob.split('/')[1];
		if(v < 1 || v > 12){
			return false;
		}
		return true;
	}, $.mage.__('You must enter a valid date of birth (dd / mm / yyyy) and be over 18 years of age'));
//EOF DOB Validation


$.validator.addMethod(
'custom-required', function (value) {
return !$.mage.isEmpty(value);
 }, $.mage.__('This is a required fields.'));

 $.validator.addMethod(
'min-lenth-validation', function (value) {
    var replacedValue = value.replace(/[\. ,:_/]+/g, "");
    if (replacedValue.length < 2) {
		return false;
	}
return true;
}, $.mage.__('Please enter at least 2 characters.'));

 $.validator.addMethod(
'min-lenth-validation-three', function (value) {
    var replacedValue = value.replace(/[\. ,:_/]+/g, "");
    if (replacedValue.length < 3) {
		return false;
	}
return true;
}, $.mage.__('Please enter at least 3 characters.'));

$.validator.addMethod(
'min-lenth-validation-newmessage', function (value) {
    var replacedValue = value.replace(/[\. ,:_/]+/g, "");
    if (replacedValue.length < 3) {
		return false;
	}
return true;
}, $.mage.__('Please enter at least 3 characters newmessage.'));

$.validator.addMethod(
'first-name', function (value) {
 var fname = parseInt(value.length);
 var lname = parseInt($('#last_name').val().length);
 var count = fname + lname;
    if (count > 35) {
		return false;
	}
return true;
}, $.mage.__('Please enter only 35 characters in first name and last name.'));

$.validator.addMethod(
'last-name', function (value) {
 var fname = parseInt(value.length);
 var lname = parseInt($('#first_name').val().length);
 var count = fname + lname;
    if (count > 35) {
		return false;
	}
return true;
}, $.mage.__('Please enter only 35 characters in first name and last name.'));

$.validator.addMethod(
's_firstname', function (value) {
 var fname = parseInt(value.length);
 var lname = parseInt($('#s_name').val().length);
 var count = fname + lname;
    if (count > 35) {
		return false;
	}
return true;
}, $.mage.__('Please enter only 35 characters in first name and last name.'));

$.validator.addMethod(
's_name', function (value) {
 var fname = parseInt(value.length);
 var lname = parseInt($('#s_firstname').val().length);
 var count = fname + lname;
    if (count > 35) {
		return false;
	}
return true;
}, $.mage.__('Please enter only 35 characters in first name and last name.'));

$.validator.addMethod(
'holders-name', function (value,element) {
 var name = $(element).attr('name');
 var holdersId = name.split("-");
 var fname = parseInt($('#holders_name_'+ holdersId[1]).val().length);
 var lname = parseInt($('#holder_name_'+ holdersId[1]).val().length);
 var count = fname + lname;
    if (count > 35) {
		return false;
	}
return true;
}, $.mage.__('Please enter only 35 characters in first name and last name.'));

$.validator.addMethod(
'cu_ex_invoice_cust_surname', function (value) {
 var fname = parseInt(value.length);
 var lname = parseInt($('#cu_ex_invoice_cust_firstname').val().length);
 var count = fname + lname;
    if (count > 35) {
		return false;
	}
return true;
}, $.mage.__('Please enter only 35 characters in first name and last name.'));

$.validator.addMethod(
'cu_ex_invoice_cust_firstname', function (value) {
 var fname = parseInt(value.length);
 var lname = parseInt($('#cu_ex_invoice_cust_surname').val().length);
 var count = fname + lname;
    if (count > 35) {
		return false;
	}
return true;
}, $.mage.__('Please enter only 35 characters in first name and last name.'));

$.validator.addMethod(
'iew_first_name', function (value) {
 var fname = parseInt(value.length);
 var lname = parseInt($('.iew_last_name').val().length);
 var count = fname + lname;
    if (count > 35) {
		return false;
	}
return true;
}, $.mage.__('Please enter only 35 characters in first name and last name.'));

$.validator.addMethod(
'iew_last_name', function (value) {
 var fname = parseInt(value.length);
 var lname = parseInt($('.iew_first_name').val().length);
 var count = fname + lname;
    if (count > 35) {
		return false;
	}
return true;
}, $.mage.__('Please enter only 35 characters in first name and last name.'));

$.validator.addMethod(
'validate-novalidation', function (value) {
 return /^[ <?php echo $specialCharacter; ?>]*$/.test(value);
}, $.mage.__('Please use letters only in this field.'));
$.validator.addMethod(
'validate-slash', function (value) {
if (value.indexOf("\\") > -1 || value.indexOf("^") > -1 || value.indexOf("_") > -1 || value.indexOf("|") > -1 || value.indexOf("}") > -1 || value.indexOf("{") > -1 || value.indexOf("[") > -1 || value.indexOf("]") > -1){
	return false;
}else{
	return true
}
}, $.mage.__('Please use letters only in this field.'));

 $.validator.addMethod(
'validate-new-email', function (value) {
	$('#email').val($('#email').val().trim());
	var emailId = $('#email').val().trim();
   return $.mage.isEmptyNoTrim(emailId) || /^([a-z0-9,!\#\$%&'\*\+\/=\?\^_`\{\|\}~-]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z0-9,!\#\$%&'\*\+\/=\?\^_`\{\|\}~-]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*@([a-z0-9-]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z0-9-]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*\.(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]){2,})$/i.test($.trim(emailId));
}, $.mage.__('Please enters a valid email address (Ex: johndoe@domain.com).'));

$.validator.addMethod(
'validate-new-alphanum', function (value) {
   return $.mage.isEmptyNoTrim(value) || /^[a-zA-Z0-9]+$/.test(value);
}, $.mage.__('Please use only letter (a-z or A-Z) or numbers (0-9) in this field. No spaces or other characters are allowed.'));

$.validator.addMethod(
'restriction-postpaid-number', function (value, element) {
   var countofvalue = 0;
   var finalVlaue = 0;
   $('.design_te_existing_number').each(function(){
	   if ($(this).val()) {
			if ($(this).val() == value) {
				var id = $(this).attr('name');
				var designsimid = id.split("-");
				if ($("#design_te_existing_number_final_validation_"+designsimid[1]).val() > 0) {
					finalVlaue = $("#design_te_existing_number_final_validation_"+designsimid[1]).val();
				}
			    countofvalue = countofvalue + 1
			}
	   }
	});
	if (countofvalue > 1) {
	    var finalvalidationId = $(element).attr('name');
		var finalvalidationsimId = finalvalidationId.split("-");
		$("#design_te_existing_number_final_validation_"+finalvalidationsimId[1]).val(finalVlaue);
		return false;
	} else {
		return true;
	}
}, $.mage.__("MNP Number is already used"));

$.validator.addMethod(
'vat-number-min-max-lenth-validation', function (value) {
    if (value.length > 50) {
		return false;
	}
return true;
}, $.mage.__('<?php echo __("Wrong format entered")?>'));
/*
@TODO - After 1802 NID release, need to remove below method. It is override above method
mod 97 number validation
$.validator.addMethod(
'id-number-mod97', function (value) {
    var value = value.replace(/-/g, "");
	if ((value.length) == 12) {
		var check_digit = value.substr(-2);
		var number = value.substring(0, 10);
		var result = number % 97;
		if(result == parseInt(check_digit) || result == 0  ) {
			return true;
		} else {
			return false;
		}
	}
	return true;
}, $.mage.__('Votre numéro de document d\'identité n\'est pas reconnu. Veuillez vérifier qu\'il soit correct.'));*/
/* end mod 97 number validation  */

$('#vat_number').mask("BE00000000000000000000000000000000000000000000000000",{placeholder:""});

	var MAGE_STORE_ID = '<?php echo $storeManager->getStore()->getCode();?>';
	if (MAGE_STORE_ID == 'nl') {
                               var url='https://www.orange.be/nl/algemene-voorwaarden';
							   var store_url='https://e-services.business.orange.be/medias/conditions/nl/Herroepingsrecht_NL.pdf';
                    } else {
                         var url='https://www.orange.be/fr/conditions-generales';
						 var store_url='https://e-services.business.orange.be/medias/conditions/fr/Retractation_FR.pdf';

                    }
					$('#orange-conditions').attr('href',url);
					$('#orange-condition').attr('href',store_url);
		if (MAGE_STORE_ID == 'nl') {
			$('#c_dob').mask("00/00/0000", {placeholder: "DD/MM/JJJJ",clearIfNotMatch: true});
			$('#cu_ex_invoice_cust_dob').mask("00/00/0000", {placeholder: "DD/MM/JJJJ",clearIfNotMatch: true});
			$('#cu_discount_f_cust_dob').mask("00/00/0000", {placeholder: "DD/MM/JJJJ",clearIfNotMatch: true});
		}
		else {
			$('#c_dob').mask("00/00/0000", {placeholder: "JJ/MM/AAAA",clearIfNotMatch: true});
			$('#cu_ex_invoice_cust_dob').mask("00/00/0000", {placeholder: "JJ/MM/AAAA",clearIfNotMatch: true});
			$('#cu_discount_f_cust_dob').mask("00/00/0000", {placeholder: "JJ/MM/AAAA",clearIfNotMatch: true});
		}

		var minYear='-100';
        var maxYear=new Date();
       	var year = new Date().getFullYear()-18;
        var currentDay = maxYear.getDate();
        var currentMonth = maxYear.getMonth()+1;

		if (MAGE_STORE_ID == 'nl') {
		$.datepicker.regional['nl'] = {
    currentText: 'Huidige', // set today text
    monthNames: ['Januari','Februari','Maart','April','Mei','Juni',
    'Juli','Augustus','September','Oktober','November','December'], // set month names
    monthNamesShort: ['Jan','Feb','Mrt','Apr','Mei','Jun','Jul','Aug','Sep','Okt','Nov','Dec'], // set short month names
    dayNames: ['Zondag','Maandag','Dinsdag','Woensdag','Donderdag','Vrijdag','Zaterdag'], // set days names
    dayNamesShort: ['Zo','Ma','Di','Wo','Do','Vr','Za'], // set short day names
    dayNamesMin: ['Zo','Ma','Di','Wo','Do','Vr','Za'], // set more short days names
    dateFormat: 'dd/mm/yy' // set format date
};

$.datepicker.setDefaults($.datepicker.regional['nl']);

		$("#c_dob").datepicker({
			changeMonth: true,
			changeYear: true,
			maxDate: new Date(),
			yearRange:minYear+':'+ maxYear,
			dateFormat: "dd/mm/yy",
			defaultDate: currentDay+'/'+currentMonth+'/'+year,
			onChangeMonthYear: function (year, month, inst) {
				$(this).val($.datepicker.formatDate('dd/mm/yy', new Date(year, month-1, 1)));
			}
		});
		$("#cu_ex_invoice_cust_dob").datepicker({
			maxDate: new Date(),
			yearRange: "-100:+0",
			dateFormat: 'dd/mm/yy',
			changeMonth: true,
			changeYear: true,
			onChangeMonthYear: function (year, month, inst) {
				$(this).val($.datepicker.formatDate('dd/mm/yy', new Date(year, month-1, 1)));
			}
		});
		$("#cu_discount_f_cust_dob").datepicker({
			maxDate: new Date(),
			yearRange: "-100:+0",
			dateFormat: 'dd/mm/yy',
			changeMonth: true,
			changeYear: true,
			onChangeMonthYear: function (year, month, inst) {
				$(this).val($.datepicker.formatDate('dd/mm/yy', new Date(year, month-1, 1)));
			}
		});
}
else
{

$.datepicker.regional['fr'] = {
    currentText: 'Courant', // set today text
    monthNames: ['Janvier','Février','Mars','Avril','Mai','Juin',
    'Juillet','Août','Septembre','Octobre','Novembre','Décembre'], // set month names
    monthNamesShort: ['Janv.','Févr.','Mars','Avr.','Mai','Juin','Juill.','Août','Sept.','Oct.','Nov.','Déc.'], // set short month names
    dayNames: ['Dimanche','Lundi','Mardi','Mercredi','Jeudi','Vendredi','Samedi'], // set days names
    dayNamesShort: ['Dim','Lun','Mar','Mer','Jeu','Ven','Sam'], // set short day names
    dayNamesMin: ['Di','Lu','Ma','Me','Je','Ve','Sa'], // set more short days names
    dateFormat: 'dd/mm/yy' // set format date
};

$.datepicker.setDefaults($.datepicker.regional['fr']);

		$("#c_dob").datepicker({
		  changeMonth: true,
          changeYear: true,
		  maxDate: new Date(),
          yearRange:minYear+':'+ maxYear,
          dateFormat: "dd/mm/yy",
          defaultDate: currentDay+'/'+currentMonth+'/'+year,
          onChangeMonthYear: function (year, month, inst) {
				$(this).val($.datepicker.formatDate('dd/mm/yy', new Date(year, month-1, 1)));
			}
		});
		$("#cu_ex_invoice_cust_dob").datepicker({
			maxDate: new Date(),
			yearRange: "-100:+0",
			dateFormat: 'dd/mm/yy',
			changeMonth: true,
			changeYear: true,
			onChangeMonthYear: function (year, month, inst) {
				$(this).val($.datepicker.formatDate('dd/mm/yy', new Date(year, month-1, 1)));
			}
		});
		$("#cu_discount_f_cust_dob").datepicker({
			maxDate: new Date(),
			yearRange: "-100:+0",
			dateFormat: 'dd/mm/yy',
			changeMonth: true,
			changeYear: true,
			onChangeMonthYear: function (year, month, inst) {
				$(this).val($.datepicker.formatDate('dd/mm/yy', new Date(year, month-1, 1)));
			}
		});

}
//]]>

});
</script>
<?php if (isset($tempSession['c_delivery_address']) && $tempSession['c_delivery_address'] == 3 && !$res):
if($customerPostalLocation && $customerStreet && $customerPostalCode &&  $customerCity):
?>
<?php if($lang=="fr"):?>
<?php $address = "Vous avez choisi" ;
$title = "Modifier le point de collecte";?>
<?php else:?>
<?php $address = "Je koos voor";
$title = "Afhaalpunt wijzigen";?>
<?php endif;?>
<?php
$tempSession['customerPostalLocation']=$customerPostalLocation;
$tempSession['customerStreet']=$customerStreet;
$tempSession['customerStreetNumber']=$customerStreetNumber;
$tempSession['customerPostalCode']=$customerPostalCode;
$tempSession['customerCity']=$customerCity;
$tempSession['customerRcCode']=$customerRcCode;
if(isset($pugoKeepMeInformedViaNotificationType))
{
$tempSession['pugoKeepMeInformedViaNotificationType']=$pugoKeepMeInformedViaNotificationType;
}
else
{
$tempSession['pugoKeepMeInformedViaNotificationType']="";
}
$tempSession['customerPhoneNumber']=$customerPhoneNumber;
$address .= ":<br>".$tempSession['customerPostalLocation'].", ".$tempSession['customerStreet']." ".$tempSession['customerStreetNumber'].", ".$tempSession['customerPostalCode']." ".$tempSession['customerCity']."<br>";
$address .= "<a id ='bpost-change-button' onclick ='openchangepopup()' class='orange cursor'>$title</a>";
?>

        <script type="text/javascript">
                if(window.location == window.parent.location){
            document.getElementById("bpost-address").innerHTML="<?php echo $address; ?>";
                document.getElementById("bpost").classList.remove("disable_div");
                document.getElementById("bpost-address").classList.remove("disable_div");
                document.getElementById("bpost-button").style.display = 'none';
                document.getElementById("c_delivery_address_bpost-error").style.display = 'none';
                document.getElementById("customerPostalLocation").value='<?php echo $tempSession['customerPostalLocation']; ?>';
                document.getElementById("customerStreet").value='<?php echo $tempSession['customerStreet']; ?>';
                document.getElementById("customerStreetNumber").value='<?php echo $tempSession['customerStreetNumber']; ?>';
                document.getElementById("customerPostalCode").value='<?php echo $tempSession['customerPostalCode']; ?>';
                document.getElementById("customerRcCode").value='<?php echo $tempSession['customerRcCode']; ?>';
                document.getElementById("pugoKeepMeInformedViaNotificationType").value='<?php echo $tempSession['pugoKeepMeInformedViaNotificationType']; ?>';
                document.getElementById("customerPhoneNumber").value='<?php echo $tempSession['customerPhoneNumber']; ?>';
                document.getElementById("customerCity").value='<?php echo $tempSession['customerCity']; ?>';
                document.getElementById("deliveryMethod").value='<?php echo $tempSession['deliveryMethod']; ?>';
                document.getElementById("isdeliveryMethod").value='<?php echo $tempSession['isdeliveryMethod']; ?>';
                document.getElementById("customerFirstName").value='<?php echo $tempSession['customerFirstName']; ?>';
                document.getElementById("customerLastName").value='<?php echo $tempSession['customerLastName']; ?>';
                document.getElementById("customerEmail").value='<?php echo $tempSession['customerEmail']; ?>';
         }else{
                parent.document.getElementById("bpost-address").innerHTML="<?php echo $address; ?>";
                parent.document.getElementById("customerPostalLocation").value='<?php echo $tempSession['customerPostalLocation']; ?>';
                parent.document.getElementById("customerStreet").value='<?php echo $tempSession['customerStreet']; ?>';
                parent.document.getElementById("customerStreetNumber").value='<?php echo $tempSession['customerStreetNumber']; ?>';
                parent.document.getElementById("customerPostalCode").value='<?php echo $tempSession['customerPostalCode']; ?>';
                parent.document.getElementById("customerRcCode").value='<?php echo $tempSession['customerRcCode']; ?>';
                parent.document.getElementById("pugoKeepMeInformedViaNotificationType").value='<?php echo $tempSession['pugoKeepMeInformedViaNotificationType']; ?>';
                parent.document.getElementById("customerPhoneNumber").value='<?php echo $tempSession['customerPhoneNumber']; ?>';
                parent.document.getElementById("customerCity").value='<?php echo $tempSession['customerCity']; ?>';
                parent.document.getElementById("deliveryMethod").value='<?php echo $tempSession['deliveryMethod']; ?>';
                parent.document.getElementById("isdeliveryMethod").value='<?php echo $tempSession['isdeliveryMethod']; ?>';
                parent.document.getElementById("customerFirstName").value='<?php echo $tempSession['customerFirstName']; ?>';
                parent.document.getElementById("customerLastName").value='<?php echo $tempSession['customerLastName']; ?>';
                parent.document.getElementById("customerEmail").value='<?php echo $tempSession['customerEmail']; ?>';
         }

        </script>

<?php
endif;
endif; ?>
<script type="text/javascript">

function openchangepopup() {
	var accountId = "<?php echo $accountId?>";
	var orderReference = "<?php echo $orderReference?>";
	var orderTotalPrice = "<?php echo $orderTotalPrice?>";
	var lang = "<?php echo $lang?>";
	var returnUrl = "<?php echo $currentUrl?>";
	var checksum = "<?php echo $hash?>";
	var customerFirstName = document.getElementById("first_name").value;
	var customerLastName = document.getElementById("last_name").value;
	var customerStreet = document.getElementById("b_street").value;
	var customerStreetNumber = document.getElementById("b_number").value;
	var customerCity = document.getElementById("b_city").value;
	var customerPostalCode = document.getElementById("b_postcode_city").value;
	var customerEmail = document.getElementById("email").value;
	var customerPhoneNumber = document.getElementById("cust_telephone").value;
		SHM.open({
			integrationType: 'POPUP',
			popupWidth: 1024, //optional
			popupHeight: 768, //optional
			parameters: {
			accountId: accountId,
			orderReference: orderReference,
			orderTotalPrice: orderTotalPrice,
			lang: lang,
			customerFirstName: customerFirstName,
			customerLastName: customerLastName,
			customerStreet: customerStreet,
			customerStreetNumber: customerStreetNumber,
			customerCity: customerCity,
			customerPostalCode: customerPostalCode,
			customerEmail: customerEmail,
			customerPhoneNumber: customerPhoneNumber,
			customerCountry: 'BE',
			confirmUrl: returnUrl,
			cancelUrl: returnUrl,
			checksum : checksum
			}
		});
}
</script>
<script type="text/javascript" >
      require([
        'jquery',
      ], function ($) {
          $(window).on('resize',  function ()  {
            if ($(window).width()  < 468) {
              $('.smallscreen').show();
              $('.largescreen').hide();
            } else {
              $('.smallscreen').hide();
              $('.largescreen').show();
            }
          }).trigger('resize');
      });

 </script>
<?php if(count($iwequoteitems) == count($payItems) || $quote->getGrandTotal() < 1): ?>
	<!-- Hide Payment when only postpaid and IEW items exists in cart -->
	<style type="text/css">
		#checkout-payment-method-load { display:none }
	</style>
<?php endif; ?>
<?php if (!empty($tealiumStatus)) : ?>
<script type="text/javascript">
	require([
    'jquery',
  ], function ($) {
    $(document).ready(function () {
      if ($("#number_tab").hasClass("disable_div") || $('#step2_tab').hasClass("active")) {
        // Personal Details Tab.
        var tealium_data = $('input[name="tealium_values"]').val();
        var d = $.parseJSON(tealium_data);
        d.page_name = "checkout personal details";
        d.checkout_step = "personal_details";
        utag.view(d);
      } else if($('#step1_tab').hasClass("active")) {
      	// Number Tab.
      	var tealium_data = $('input[name="tealium_values"]').val();
    	  var d = $.parseJSON(tealium_data);
    	  d.page_name = "checkout number";
    	  d.checkout_step = "number";
        var totalpostpaidValue = $("#totalvirtualproduct").val();
        if (totalpostpaidValue.indexOf(',') != -1) {
            var res = totalpostpaidValue.split(",");
        } else {
            res = [totalpostpaidValue];
        }
        var tealium_number_type = {};
        for (var i = 0; i < res.length; i++) {
          var number_type = $("input[name='design_sim_number-" + res[i] + "']:checked").val();
          tealium_number_type[i] = (number_type == 1) ? 'existing' : 'new';
        }
        var num_type = [];
        for (var n in tealium_number_type) {
          num_type.push(tealium_number_type[n]);
        }
        d.number_type = num_type;
        utag.view(d);
      } else {
      	// Payment Detail Tab.
      	var tealium_data = $('input[name="tealium_values"]').val();
    	  var d = $.parseJSON(tealium_data);
    	  d.page_name = "checkout payment details";
    	  d.checkout_step = "payment_details";
    	  utag.view(d);
      }
    });
  });
</script>
<?php endif; ?>
